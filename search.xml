<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Android抢红包</title>
    <url>/2020/12/25/android-grabs-red-envelopes/</url>
    <content><![CDATA[<ul>
<li>本文原理是利用<strong>Android无障碍服务</strong>实现的自动抢红包功能</li>
</ul>
<p>自动抢红包功能是一个服务实现的，继承自<code>AccessibilityService</code>，然后在服务里面做一些相应的操作。</p>
<p>首先 <code>AndroidManifest.xml</code> 文件中，把所有的<code>&lt;activity&gt;&lt;/activity&gt;</code>节点全部删除掉，然后创建一个<code>&lt;service&gt;&lt;/service&gt;</code>节点，配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.RobMoneyService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:permission</span>=<span class="string">&quot;android.permission.BIND_ACCESSIBILITY_SERVICE&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.accessibilityservice.AccessibilityService&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;android.accessibilityservice&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:resource</span>=<span class="string">&quot;@xml/accessibility&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们看到，其中引用了xml文件夹下的accessibility文件，这个文件是配置你的后台服务是注册了那个应用，比如你想抢微信红包，你就可以根据下面的样式写自己的accessibility.xml文件了</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">accessibility-service</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:accessibilityEventTypes</span>=<span class="string">&quot;typeNotificationStateChanged|typeWindowStateChanged&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:accessibilityFeedbackType</span>=<span class="string">&quot;feedbackGeneric&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:accessibilityFlags</span>=<span class="string">&quot;flagDefault&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:canRetrieveWindowContent</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:description</span>=<span class="string">&quot;@string/desc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:notificationTimeout</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:packageNames</span>=<span class="string">&quot;com.tencent.mm&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>里面有许多属性，那么<code>accessibilityEventTypes</code>是设置事件相应类型的，<code>accessibilityFeedbackType</code>是设置回馈给用户的方式的，有震动和语音播报等。<code>canRetrieveWindowContent</code>表示你的服务能否获取到窗口中的内容，参数是boolean值，另外一些就见名知意了，不再赘述。</p>
<p>接下来就要重写我们的服务类了，在继承<code>AccessibilityService</code>之后，需要重写<code>onAccessibilityEvent(AccessibilityEvent accessibilityEvent)</code> 和<code>onInterrupt()</code>两个方法，由名字我们就可以知道，后一个是服务中断时使用，这里我们用不到，主要看第一个方法，参数列表里面就一个参数，是一个<code>AccessibilityEvent</code></p>
<p>类型的参数，那么我们可以通过这一个对象获得事件类型，再由事件类型判断接下来需要做什么样的工作。</p>
<p>我么知道，在锁屏的时候，有红包发过来，通知栏会有提示，那么我们就通过通知栏的提示来打开抢红包界面，我们可以这样写：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> eventType = accessibilityEvent.getEventType();</span><br><span class="line"><span class="keyword">switch</span> (eventType) &#123;</span><br><span class="line">    <span class="keyword">case</span> AccessibilityEvent.TYPE_NOTIFICATION_STATE_CHANGED:</span><br><span class="line"><span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>通过switch过滤不同的事件，这里我们就监听了通知栏改变时的事件。</p>
<p>那么微信发来红包之后，在通知栏都会有**[微信红包]**这个字样，我们就利用他判断是不是微信红包，如果有这个字样，我们就打开通知进入抢红包界面，实现代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> AccessibilityEvent.TYPE_NOTIFICATION_STATE_CHANGED:</span><br><span class="line">    <span class="comment">//检测通知栏是否有  [微信红包]   字样</span></span><br><span class="line">    List&lt;CharSequence&gt; texts = accessibilityEvent.getText();</span><br><span class="line">    <span class="keyword">if</span> (!texts.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (CharSequence text : texts) &#123;</span><br><span class="line">            String content = text.toString();</span><br><span class="line">            Log.i(<span class="string">&quot;demo&quot;</span>, <span class="string">&quot;text:&quot;</span> + content);</span><br><span class="line">            <span class="keyword">if</span> (content.contains(<span class="string">&quot;[微信红包]&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">//模拟打开通知栏消息</span></span><br><span class="line">                <span class="keyword">if</span> (accessibilityEvent.getParcelableData() != <span class="keyword">null</span></span><br><span class="line">                        &amp;&amp; accessibilityEvent.getParcelableData() <span class="keyword">instanceof</span> Notification) &#123;</span><br><span class="line">                    Notification notification = (Notification) accessibilityEvent.getParcelableData();</span><br><span class="line">                    PendingIntent pendingIntent = notification.contentIntent;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        pendingIntent.send();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (PendingIntent.CanceledException e) &#123;</span><br><span class="line">                        e.printStackTrace();                    </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>通过<code>pendingIntent</code>的<code>send()</code>方法，打开界面。</p>
<p>接下来就开始打开红包了。但是，控件的内容和描述并不是一定存在的，这时我们可以通过id来获得控件，并添加点击。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openPacket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AccessibilityNodeInfo nodeInfo = getRootInActiveWindow();</span><br><span class="line">    <span class="keyword">if</span> (nodeInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">    AccessibilityNodeInfo nodeInfosById = findNodeInfosById(nodeInfo, <span class="string">&quot;com.tencent.mm:id/ba_&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (nodeInfosById !=<span class="keyword">null</span>) &#123;</span><br><span class="line">            nodeInfosById.performAction(AccessibilityNodeInfo.ACTION_CLICK);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，红包就打开了。</p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>FFmpeg笔记</title>
    <url>/2020/12/25/ffmpeg-note/</url>
    <content><![CDATA[<h1 id="Mac-Linux下编译ffmpeg"><a href="#Mac-Linux下编译ffmpeg" class="headerlink" title="Mac/Linux下编译ffmpeg"></a>Mac/Linux下编译ffmpeg</h1><p><code>./configure --prefix=/usr/local/ffmpeg --enable-debug=3 --disable-static --enable-shared --enable-libfdk-aac --enable-gpl --enable-nonfree</code><br>参数含义：</p>
<blockquote>
<p> –prefix 指定安装路径<br> –enable-debug=3 打开调试模式，级别是3<br> –disable-static 关闭静态库<br> –enable-share 打开动态库</p>
</blockquote>
<p>执行完会产生编译脚本make file</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make -j 4</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>参数含义：</p>
<blockquote>
<p>-j 表示同时有多个CPU并发进行<br>最后安装到 <strong>–prefix</strong>指定的路径</p>
</blockquote>
<h1 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h1><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* atgv[])</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译命令：<br><code> gcc/clang -g -o HelloWorld HelloWorld.c</code><br>参数含义：</p>
<blockquote>
<p>gcc Linux下的命令<br>clang Mac下的命令<br>-g debug模式<br>-o 要输出文件的名字，这里是HelloWorld<br>xxx.c 源代码<br>执行命令：<br><code> ./HelloWorld</code></p>
</blockquote>
<h1 id="命令方式采集音频"><a href="#命令方式采集音频" class="headerlink" title="命令方式采集音频"></a>命令方式采集音频</h1><p>Mac系统<br><code> ffmpeg -f avfoundation -i :0 out.wav</code><br>Linux系统<br><code> ffmpeg -f asla -i hw:0 out.wav</code></p>
<h1 id="播放音频"><a href="#播放音频" class="headerlink" title="播放音频"></a>播放音频</h1><p><code> ffplay -ar 44100 -ac 2 -f f32le audio.pcm</code></p>
<h1 id="使用ffmpeg生成aac"><a href="#使用ffmpeg生成aac" class="headerlink" title="使用ffmpeg生成aac"></a>使用ffmpeg生成aac</h1><p><code> ffmpeg -i xxx.mp4 -vn -c:a libfdk_aac -ar 44100 -channels 2 -profile:a aac_he_v2 xxx.aac</code><br>参数含义：</p>
<blockquote>
<p>-i 输入的文件<br>-vn v代表video，n代表没有video，vn可以将视频过滤掉<br>-c:a c代表编码器，a代表音频编码器<br>-ar 音频采样率<br>-channels 代表通道数<br>-profile:a 对编码器libfdk_aac设置参数，:a是对音频的编码</p>
</blockquote>
<p>缺少库安装：<br><code> brew reinstall ffmpeg --with-sdl2 --with-fdk-aac --with-fontconfig</code></p>
<p><code> brew install --with-sdl2 --with-fdk-aac --with-fontconfig --with-frei0r --with-game-music-emu --with-libass --with-libbs2b --with-libcaca --with-libgsm --with-libmodplug --with-librsvg --with-libsoxr --with-libssh --with-libvidstab --with-libvorbis --with-libvpx --with-opencore-amr --with-openh264 --with-openjpeg --with-openssl --with-opus --with-rtmpdump --with-rubberband --with-sdl2 --with-snapp --with-speex --with-srt --with-tesseract --with-theora --with-tools --with-two-lame --with-wavpack --with-webp --with-x265 --with-xz --with-zeromq --with-zimg --with-chromaprint --with-libbluray --with-snappy  --with-freetype</code></p>
<p><img src="/2020/12/25/ffmpeg-note/%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8%E5%8E%9F%E7%90%86.png" alt="视频播放器原理"></p>
<h1 id="Windows-build-下载"><a href="#Windows-build-下载" class="headerlink" title="Windows build 下载"></a><a href="ffmpeg-4.3.2-2021-02-27-full_build.7z">Windows build 下载</a></h1><h1 id="剪切视频（长度）"><a href="#剪切视频（长度）" class="headerlink" title="剪切视频（长度）"></a>剪切视频（长度）</h1><p><code> ffmpeg -ss 990 -i input.mp4 -t 50 output.mp4</code></p>
<blockquote>
<p>-ss 开始的秒数<br>-t 截取时长<br>-s 调整分辨率</p>
</blockquote>
<h1 id="剪切视频-尺寸、长度"><a href="#剪切视频-尺寸、长度" class="headerlink" title="剪切视频 (尺寸、长度)"></a>剪切视频 (尺寸、长度)</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input -vf crop=w:h:x:y -ss start_time -t duration output</span><br></pre></td></tr></table></figure>

<table>
    <tr>
        <th align="center" width="20%">Syntax</th>
        <th align="center">crop=ow[:oh[:x[:y[:keep_aspect]]]]</th> 
    </tr >
    <tr>
        <th colspan="2" align="center">Avaliable variables in expressions for <u>ow</u> and <u>oh</u> parameters</th>
    </tr>
    <tr>
        <td align="center">x, y</td>
        <td>computed values for x (number of pixels from top left corner horizontally) and y (number of pixels vertically), they are evaluated for every frame, default values of <b>x</b> is (iw -ow)/2, default value of <b>y</b> is (ih - oh)/2</td>
    </tr>
    <tr>
        <td align="center">in_w, iw</td>
        <td>input width</td>
    </tr>
    <tr>
        <td align="center">in_h, ih</td>
        <td>input height</td>
    </tr>
    <tr>
        <td align="center">out_w, ow</td>
        <td>output(cropped) width, default value = iw</td>
    </tr>
    <tr>
        <td align="center">out_h, oh</td>
        <td>output(cropped) heigth, default value = ih</td>
    </tr>
    <tr>
        <td align="center">a</td>
        <td>aspect ratio, same as iw/ih</td>
    </tr>
    <tr>
        <td align="center">sar</td>
        <td>input same aspect ratio</td>
    </tr>
    <tr>
        <td align="center">dar</td>
        <td>input display aspect ratio, equals to the expression a*sar</td>
    </tr>
    <tr>
        <td align="center">hsub, vsub</td>
        <td>horizontal and vertical chroma subsample values, for the pixel format yuv422p the value of hsub is 2 and vsub is 1</td>
    </tr>
    <tr>
        <td align="center">n</td>
        <td>number of input frame, starting from 0</td>
    </tr>
    <tr>
        <td align="center">pos</td>
        <td>position in the file of the input frame, NAN if unknown</td>
    </tr>
    <tr>
        <td align="center">t</td>
        <td>timestamp expressed in seconds, NAN if the input timestamp is unknown</td>
    </tr>
</table>

<ul>
<li>Example:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">PS E:\Download&gt; ffmpeg -i .\权力的游戏.第一季.第1集.Game.of.Thrones.S01E01.HK.BD-1080p.X264.AAC.CHS.ENG-UUMp4.mp4 -vf crop=600:800:iw/6:ih/6 -ss 300 -t 60 out.mp4</span><br><span class="line">ffmpeg version 4.3.2-2021-02-27-full_build-www.gyan.dev Copyright (c) 2000-2021 the FFmpeg developers</span><br><span class="line">  built with gcc 10.2.0 (Rev6, Built by MSYS2 project)</span><br><span class="line">  configuration: --enable-gpl --enable-version3 --enable-static --disable-w32threads --disable-autodetect --enable-fontconfig --enable-iconv --enable-gnutls --enable-libxml2 --enable-gmp --enable-lzma --enable-libsnappy --enable-zlib --enable-libsrt --enable-libssh --enable-libzmq --enable-avisynth --enable-libbluray --enable-libcaca --enable-sdl2 --enable-libdav1d --enable-libzvbi --enable-librav1e --enable-libwebp --enable-libx264 --enable-libx265 --enable-libxvid --enable-libaom --enable-libopenjpeg --enable-libvpx --enable-libass --enable-frei0r --enable-libfreetype --enable-libfribidi --enable-libvidstab --enable-libvmaf --enable-libzimg --enable-amf --enable-cuda-llvm --enable-cuvid --enable-ffnvcodec --enable-nvdec --enable-nvenc --enable-d3d11va --enable-dxva2 --enable-libmfx --enable-libcdio --enable-libgme --enable-libmodplug --enable-libopenmpt --enable-libopencore-amrwb --enable-libmp3lame --enable-libshine --enable-libtheora --enable-libtwolame --enable-libvo-amrwbenc --enable-libilbc --enable-libgsm --enable-libopencore-amrnb --enable-libopus --enable-libspeex --enable-libvorbis --enable-ladspa --enable-libbs2b --enable-libflite --enable-libmysofa --enable-librubberband --enable-libsoxr --enable-chromaprint</span><br><span class="line">  libavutil      56. 51.100 / 56. 51.100</span><br><span class="line">  libavcodec     58. 91.100 / 58. 91.100</span><br><span class="line">  libavformat    58. 45.100 / 58. 45.100</span><br><span class="line">  libavdevice    58. 10.100 / 58. 10.100</span><br><span class="line">  libavfilter     7. 85.100 /  7. 85.100</span><br><span class="line">  libswscale      5.  7.100 /  5.  7.100</span><br><span class="line">  libswresample   3.  7.100 /  3.  7.100</span><br><span class="line">  libpostproc    55.  7.100 / 55.  7.100</span><br><span class="line">Input <span class="comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from &#x27;.\权力的游戏.第一季.第1集.Game.of.Thrones.S01E01.HK.BD-1080p.X264.AAC.CHS.ENG-UUMp4.mp4&#x27;:</span></span><br><span class="line">  Metadata:</span><br><span class="line">    major_brand     : mp42</span><br><span class="line">    minor_version   : 1</span><br><span class="line">    compatible_brands: isommp423gp5</span><br><span class="line">    creation_time   : 2019-05-13T16:22:44.000000Z</span><br><span class="line">    encoder         : My MP4Box GUI 0.6.0.6 &lt;http://my-mp4box-gui.zymichost.com&gt;</span><br><span class="line">  Duration: 01:01:37.17, start: 0.000000, bitrate: 2586 kb/s</span><br><span class="line">    Stream <span class="comment">#0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 1920x1080 [SAR 1:1 DAR 16:9], 2485 kb/s, 23.98 fps, 23.98 tbr, 24k tbn, 47.95 tbc (default)</span></span><br><span class="line">    Metadata:</span><br><span class="line">      creation_time   : 2019-05-08T18:52:18.000000Z</span><br><span class="line">      handler_name    : ȨfµÄÓÎϷ.µÚһ�¾.µÚ1�¯.Game.of.Thrones.S01E01.HK.BD-1080p.X264.AAC.CHS.ENG-UUMp4.mp4</span><br><span class="line">      encoder         : AVC Coding</span><br><span class="line">    Stream <span class="comment">#0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 97 kb/s (default)</span></span><br><span class="line">    Metadata:</span><br><span class="line">      creation_time   : 2019-05-13T16:23:09.000000Z</span><br><span class="line">      handler_name    : Game.of.Thrones.S01E01.HK.Blu-ray.1080p.Remux.H264.DTS-HD.MA.5.1.aac</span><br><span class="line">    Stream <span class="comment">#0:2(und): Data: none (mp4s / 0x7334706D), 0 kb/s (default)</span></span><br><span class="line">    Metadata:</span><br><span class="line">      creation_time   : 2019-05-13T16:23:11.000000Z</span><br><span class="line">      handler_name    : GPAC MPEG-4 OD Handler</span><br><span class="line">    Stream <span class="comment">#0:3(und): Data: none (mp4s / 0x7334706D), 0 kb/s (default)</span></span><br><span class="line">    Metadata:</span><br><span class="line">      creation_time   : 2019-05-13T16:23:11.000000Z</span><br><span class="line">      handler_name    : GPAC MPEG-4 Scene Description Handler</span><br><span class="line">File <span class="string">&#x27;out.mp4&#x27;</span> already exists. Overwrite? [y/N] y</span><br><span class="line">Stream mapping:</span><br><span class="line">  Stream <span class="comment">#0:0 -&gt; #0:0 (h264 (native) -&gt; h264 (libx264))</span></span><br><span class="line">  Stream <span class="comment">#0:1 -&gt; #0:1 (aac (native) -&gt; aac (native))</span></span><br><span class="line">Press [q] to stop, [?] <span class="keyword">for</span> <span class="built_in">help</span></span><br><span class="line">[libx264 @ 00000155b6ac5980] using SAR=1/1</span><br><span class="line">[libx264 @ 00000155b6ac5980] using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2</span><br><span class="line">[libx264 @ 00000155b6ac5980] profile High, level 3.1, 4:2:0, 8-bit</span><br><span class="line">[libx264 @ 00000155b6ac5980] 264 - core 161 r3048 b86ae3c - H.264/MPEG-4 AVC codec - Copyleft 2003-2021 - http://www.videolan.org/x264.html - options: cabac=1 ref=3 deblock=1:0:0 analyse=0x3:0x113 me=hex subme=7 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=1 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=6 lookahead_threads=1 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=2 keyint=250 keyint_min=23 scenecut=40 intra_refresh=0 rc_lookahead=40 rc=crf mbtree=1 crf=23.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00</span><br><span class="line">Output <span class="comment">#0, mp4, to &#x27;out.mp4&#x27;:</span></span><br><span class="line">  Metadata:</span><br><span class="line">    major_brand     : mp42</span><br><span class="line">    minor_version   : 1</span><br><span class="line">    compatible_brands: isommp423gp5</span><br><span class="line">    encoder         : Lavf58.45.100</span><br><span class="line">    Stream <span class="comment">#0:0(und): Video: h264 (libx264) (avc1 / 0x31637661), yuv420p, 600x800 [SAR 1:1 DAR 3:4], q=-1--1, 23.98 fps, 24k tbn, 23.98 tbc (default)</span></span><br><span class="line">    Metadata:</span><br><span class="line">      creation_time   : 2019-05-08T18:52:18.000000Z</span><br><span class="line">      handler_name    : ȨfµÄÓÎϷ.µÚһ�¾.µÚ1�¯.Game.of.Thrones.S01E01.HK.BD-1080p.X264.AAC.CHS.ENG-UUMp4.mp4</span><br><span class="line">      encoder         : Lavc58.91.100 libx264</span><br><span class="line">    Side data:</span><br><span class="line">      cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: N/A</span><br><span class="line">    Stream <span class="comment">#0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 128 kb/s (default)</span></span><br><span class="line">    Metadata:</span><br><span class="line">      creation_time   : 2019-05-13T16:23:09.000000Z</span><br><span class="line">      handler_name    : Game.of.Thrones.S01E01.HK.Blu-ray.1080p.Remux.H264.DTS-HD.MA.5.1.aac</span><br><span class="line">      encoder         : Lavc58.91.100 aac</span><br><span class="line">frame= 1439 fps= 48 q=-1.0 Lsize=    5577kB time=00:01:00.01 bitrate= 761.3kbits/s speed=1.99x</span><br><span class="line">video:4594kB audio:942kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.744073%</span><br><span class="line">[libx264 @ 00000155b6ac5980] frame I:19    Avg QP:18.65  size: 26467</span><br><span class="line">[libx264 @ 00000155b6ac5980] frame P:480   Avg QP:20.83  size:  5503</span><br><span class="line">[libx264 @ 00000155b6ac5980] frame B:940   Avg QP:22.86  size:  1658</span><br><span class="line">[libx264 @ 00000155b6ac5980] consecutive B-frames:  9.5%  8.6%  4.6% 77.3%</span><br><span class="line">[libx264 @ 00000155b6ac5980] mb I  I16..4: 13.6% 77.6%  8.8%</span><br><span class="line">[libx264 @ 00000155b6ac5980] mb P  I16..4:  6.2% 12.2%  0.4%  P16..4: 41.1%  8.5%  5.4%  0.0%  0.0%    skip:26.2%</span><br><span class="line">[libx264 @ 00000155b6ac5980] mb B  I16..4:  0.7%  0.7%  0.0%  B16..8: 36.9%  1.7%  0.2%  direct: 1.0%  skip:58.7%  L0:45.0% L1:53.6% BI: 1.4%</span><br><span class="line">[libx264 @ 00000155b6ac5980] 8x8 transform intra:65.0% inter:88.4%</span><br><span class="line">[libx264 @ 00000155b6ac5980] coded y,uvDC,uvAC intra: 35.4% 42.5% 4.1% inter: 9.1% 13.9% 0.0%</span><br><span class="line">[libx264 @ 00000155b6ac5980] i16 v,h,dc,p: 38% 23% 16% 24%</span><br><span class="line">[libx264 @ 00000155b6ac5980] i8 v,h,dc,ddl,ddr,vr,hd,vl,hu: 22% 18% 37%  4%  4%  4%  4%  4%  4%</span><br><span class="line">[libx264 @ 00000155b6ac5980] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 22% 19% 18%  6%  9%  7%  8%  5%  5%</span><br><span class="line">[libx264 @ 00000155b6ac5980] i8c dc,h,v,p: 64% 16% 19%  1%</span><br><span class="line">[libx264 @ 00000155b6ac5980] Weighted P-Frames: Y:0.4% UV:0.4%</span><br><span class="line">[libx264 @ 00000155b6ac5980] ref P L0: 69.3%  9.9% 15.6%  5.2%  0.0%</span><br><span class="line">[libx264 @ 00000155b6ac5980] ref B L0: 88.0%  9.7%  2.2%</span><br><span class="line">[libx264 @ 00000155b6ac5980] ref B L1: 96.9%  3.1%</span><br><span class="line">[libx264 @ 00000155b6ac5980] kb/s:626.89</span><br><span class="line">[aac @ 00000155b6abfb40] Qavg: 163.868</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>FFmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>下载JDK和配置环境变量</title>
    <url>/2020/12/28/download-jdk-and-configure-environment-variables/</url>
    <content><![CDATA[<h2 id="下载JDK"><a href="#下载JDK" class="headerlink" title="下载JDK"></a>下载JDK</h2><p>去<a href="https://www.oracle.com/index.html">Oracel官网</a>下载最新版本的JDK并安装</p>
<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><h3 id="Windows-10环境"><a href="#Windows-10环境" class="headerlink" title="Windows 10环境"></a>Windows 10环境</h3><p>右键 <strong>此电脑 -&gt; 属性 -&gt; 高级系统设置 -&gt; 环境变量</strong></p>
<p><img src="/2020/12/28/download-jdk-and-configure-environment-variables/img1.png" alt="此电脑"></p>
<p><img src="/2020/12/28/download-jdk-and-configure-environment-variables/img2.png" alt="属性"></p>
<p><img src="/2020/12/28/download-jdk-and-configure-environment-variables/img3.png" alt="高级系统设置"></p>
<p><img src="/2020/12/28/download-jdk-and-configure-environment-variables/img4.png" alt="环境变量"></p>
<p>在环境变量弹窗，新建<strong>JAVA_HOME</strong>变量</p>
<blockquote>
<p>变量名：JAVA_HOME<br>变量值：电脑上JDK安装的绝对路径</p>
</blockquote>
<p><img src="/2020/12/28/download-jdk-and-configure-environment-variables/img5.png" alt="编辑系统变量"></p>
<p>如果存在 <strong>CLASSPATH</strong> 变量，选中点击 <strong>编辑</strong>。</p>
<p>如果没有，点击 <strong>新建…</strong> 。</p>
<blockquote>
<p>变量名：CLASSPATH<br>变量值：.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;</p>
</blockquote>
<p>由于 win10 的不同，当选中 <strong>Path</strong> 变量的时候，系统会很方便的把所有不同路径都分开了，不会像 win7 或者 win8 那样连在一起。</p>
<p>新建两条路径：</p>
<blockquote>
<p>%JAVA_HOME%\bin<br>%JAVA_HOME%\jre\bin</p>
</blockquote>
<p><img src="/2020/12/28/download-jdk-and-configure-environment-variables/img6.png" alt="编辑环境变量"></p>
<p>打开cmd，输入<code>java -version</code>显示版本号说明配置成功了</p>
<p><img src="/2020/12/28/download-jdk-and-configure-environment-variables/img7.png" alt="Java版本"></p>
<h3 id="Mac环境"><a href="#Mac环境" class="headerlink" title="Mac环境"></a>Mac环境</h3><p>在<code>~/.bash_profile</code>或<code>~/.zprofile</code>里指定<code>JAVA_HOME</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export JAVA_HOME=`/usr/libexec/java_home -v 15`</span><br></pre></td></tr></table></figure>

<p>然后，把<code>JAVA_HOME</code>的<code>bin</code>目录附加到系统环境变量<code>PATH</code>上。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>打开终端，输入<code>java -version</code>显示版本号说明配置成功了</p>
<p><img src="/2020/12/28/download-jdk-and-configure-environment-variables/img8.png" alt="Java版本"></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>终端命令</title>
    <url>/2021/01/04/terminal-command/</url>
    <content><![CDATA[<h2 id="Java-JDK"><a href="#Java-JDK" class="headerlink" title="Java JDK"></a>Java JDK</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 【获取签名文件信息】</span><br><span class="line">// 1. key的路径</span><br><span class="line">// 2. 库的密码</span><br><span class="line">keytool -list -v -keystore %1 -storepass %2</span><br></pre></td></tr></table></figure>
<h2 id="Android-SDK"><a href="#Android-SDK" class="headerlink" title="Android SDK"></a>Android SDK</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 【签名】</span><br><span class="line">// 1. key的路径</span><br><span class="line">// 2. 库的密码</span><br><span class="line">// 3. key的密码</span><br><span class="line">// 4. 签名后输出的文件名</span><br><span class="line">// 5. 需要签名的原文件</span><br><span class="line">// 6. key的别名</span><br><span class="line">jarsigner -keystore %1 -storepass %2 -keypass %3 -sigfile CERT -signedjar %4 %5 %6 -verbose -certs</span><br></pre></td></tr></table></figure>


<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 配置个人名字和邮箱</span><br><span class="line">git config --global user.name &quot;$&#123;name&#125;&quot;</span><br><span class="line">git config --global user.email &quot;$&#123;email&#125;&quot;</span><br><span class="line"></span><br><span class="line">// 克隆公共仓库代码</span><br><span class="line">git clone https://github.com/$&#123;username&#125;/xxx.git</span><br><span class="line">// 克隆私密仓库代码</span><br><span class="line">git clone https://$&#123;username&#125;:$&#123;password&#125;@github.com/$&#123;username&#125;/xxx.git</span><br><span class="line"></span><br><span class="line">// 查看所有分支</span><br><span class="line">git branch -a</span><br><span class="line">// 检出分支/切换分支</span><br><span class="line">git checkout $&#123;branch_name&#125;</span><br><span class="line">// 查看当前Git状态</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line">// 提交代码</span><br><span class="line">git stash </span><br><span class="line">git fetch</span><br><span class="line">git rebase</span><br><span class="line">git stash pop</span><br><span class="line">git add .</span><br><span class="line">git commit -m &#x27;xxx&#x27;</span><br><span class="line">git push</span><br><span class="line"></span><br><span class="line">// 查看远程仓库</span><br><span class="line">git remote -v</span><br><span class="line">// 添加远程仓库</span><br><span class="line">git add remote $&#123;remote_name&#125; https://github.com/$&#123;username&#125;/xxx.git</span><br><span class="line">// 推送到默认仓库</span><br><span class="line">git push</span><br><span class="line">// 推送到指定仓库</span><br><span class="line">git push $&#123;remote_name&#125;</span><br><span class="line"></span><br><span class="line">// 修改http.postBuffer大小 (error: unable to rewind rpc post data - try increasing http.postBuffer)</span><br><span class="line">git config --global http.postBuffer 524288000</span><br><span class="line"></span><br><span class="line">// 列出tag</span><br><span class="line">git tag</span><br><span class="line">// 过滤tag</span><br><span class="line">git tag -l “v1.0*”</span><br><span class="line">// 创建tag</span><br><span class="line">git tag v1.0.0</span><br><span class="line">// 创建带备注的tag</span><br><span class="line">git tag -a v1.0.0 -m “版本1.0.0”</span><br><span class="line">// 查看tag信息</span><br><span class="line">git show v1.0.0</span><br><span class="line">// 给指定的commit加tag</span><br><span class="line">git tag -a v1.0.0 908f7b13 -m “版本1.0.0”</span><br><span class="line">// 将单个tag推送到远程</span><br><span class="line">git push [$&#123;remote_name&#125;] v1.0.0</span><br><span class="line">// 推送所有tag</span><br><span class="line">git push [$&#123;remote_name&#125;] --tags</span><br><span class="line">// 删除本地tag</span><br><span class="line">git tag -d v1.0.0</span><br><span class="line">// 删除远程tag</span><br><span class="line">git push [$&#123;remote_name&#125;] :refs/tags/v1.0.0</span><br><span class="line"></span><br><span class="line">// 清除缓存</span><br><span class="line">git rm -r --cached .</span><br></pre></td></tr></table></figure>

<h2 id="VI-命令"><a href="#VI-命令" class="headerlink" title="VI 命令"></a>VI 命令</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ctrl+u：向文件首翻半屏；</span><br><span class="line">Ctrl+d：向文件尾翻半屏；</span><br><span class="line">Ctrl+f：向文件尾翻一屏；</span><br><span class="line">Ctrl+b：向文件首翻一屏；</span><br><span class="line">Esc：从编辑模式切换到命令模式；</span><br><span class="line">ZZ：命令模式下保存当前文件所做的修改后退出vi；</span><br><span class="line">:行号：光标跳转到指定行的行首；</span><br><span class="line">:$：光标跳转到最后一行的行首；</span><br><span class="line">x或X：删除一个字符，x删除光标后的，而X删除光标前的；</span><br><span class="line">D：删除从当前光标到光标所在行尾的全部字符；</span><br><span class="line">dd：删除光标行正行内容；</span><br><span class="line">ndd：删除当前行及其后n-1行；</span><br><span class="line">nyy：将当前行及其下n行的内容保存到寄存器？中，其中？为一个字母，n为一个数字；</span><br><span class="line">p：粘贴文本操作，用于将缓存区的内容粘贴到当前光标所在位置的下方；</span><br><span class="line">P：粘贴文本操作，用于将缓存区的内容粘贴到当前光标所在位置的上方；</span><br><span class="line">/字符串：文本查找操作，用于从当前光标所在位置开始向文件尾部查找指定字符串的内容，查找的字符串会被加亮显示；</span><br><span class="line">？name：文本查找操作，用于从当前光标所在位置开始向文件头部查找指定字符串的内容，查找的字符串会被加亮显示；</span><br><span class="line">a，bs/F/T：替换文本操作，用于在第a行到第b行之间，将F字符串换成T字符串。其中，“s/”表示进行替换操作；</span><br><span class="line">a：在当前字符后添加文本；</span><br><span class="line">A：在行末添加文本；</span><br><span class="line">i：在当前字符前插入文本；</span><br><span class="line">I：在行首插入文本；</span><br><span class="line">o：在当前行后面插入一空行；</span><br><span class="line">O：在当前行前面插入一空行；</span><br><span class="line">:wq：在命令模式下，执行存盘退出操作；</span><br><span class="line">:w：在命令模式下，执行存盘操作；</span><br><span class="line">:w！：在命令模式下，执行强制存盘操作；</span><br><span class="line">:q：在命令模式下，执行退出vi操作；</span><br><span class="line">:q！：在命令模式下，执行强制退出vi操作；</span><br><span class="line">:e文件名：在命令模式下，打开并编辑指定名称的文件；</span><br><span class="line">:n：在命令模式下，如果同时打开多个文件，则继续编辑下一个文件；</span><br><span class="line">:f：在命令模式下，用于显示当前的文件名、光标所在行的行号以及显示比例；</span><br><span class="line">:set number：在命令模式下，用于在最左端显示行号；</span><br><span class="line">:set nonumber：在命令模式下，用于在最左端不显示行号；</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Terminal</tag>
      </tags>
  </entry>
  <entry>
    <title>Flutter Question</title>
    <url>/2021/01/18/flutter-question/</url>
    <content><![CDATA[<p>安装完flutter环境，执行<code>flutter doctor</code>命令，检查flutter开发工具链。</p>
<p><img src="/2021/01/18/flutter-question/flutter_doctor_terminal.png" alt="flutter doctor"></p>
<p>按照提示安装对应插件即可，但在Android Studio 4.1以上版本，插件目录更换，导致之前在Android Studio版本里面安装到饿插件找不到。</p>
<p>老版本插件目录：<code>/Library/Application\ Support/AndroidStudio4.1</code></p>
<p>新版本插件目录：<code>/Library/Application Support/Google/AndroidStudio4.1/plugins</code></p>
<p>flutter使用的老版本Android Studio插件目录查找插件，产生错误，虽然目前bug已经修复，但是还没有release出来。</p>
<p>我发现解决方法有两种：</p>
<p>第一种如网上所说，在终端执行<code>ln -s ~/Library/Application\ Support/Google/AndroidStudio4.1/plugins ~/Library/Application\ Support/AndroidStudio4.1</code>，在新的插件目录下创建之前插件目录的软连接，通过软连接找到插件。</p>
<p>第二种切换flutter sdk的分支到dev（dev分支已经修复此bug）。</p>
]]></content>
      <categories>
        <category>Question</category>
      </categories>
      <tags>
        <tag>flutter</tag>
      </tags>
  </entry>
  <entry>
    <title>Kotlin的lambda表达式</title>
    <url>/2021/01/18/kotlin-lambda-expression/</url>
    <content><![CDATA[<p><strong>在lambda表达式，只支持单抽象方法模型，即设计的接口里面只有一个抽象的方法，才符合lambda表达式的规则，多个回调方法不支持。</strong></p>
<ul>
<li><p>1、用Java代码实现一个接口的回调。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mView.setEventListener(<span class="keyword">new</span> EventListener()&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Data data)</span></span>&#123;</span><br><span class="line">     <span class="comment">//TODO</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>2、在Kotlin中的实现一个接口的回调,不使用lambda表达式(这种方式非常适用于kotlin中对于一个接口中含有多个回调方法)。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">mView.setEventListener(<span class="keyword">object</span>: EventListener&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> void onSuccess(Data <span class="keyword">data</span>)&#123;</span><br><span class="line">      <span class="comment">//TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>3、如果在Kotlin中的对于<strong>接口只有一个回调的方法</strong>，就符合使用lambda函数，我们可以把以上代码简化成这样。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">mView.setEventListener(&#123;</span><br><span class="line">   <span class="keyword">data</span>: Data -&gt;</span><br><span class="line">      <span class="comment">//TODO</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者可以直接省略Data,借助kotlin的智能类型推导</span></span><br><span class="line"></span><br><span class="line">mView.setEventListener(&#123;</span><br><span class="line">   <span class="keyword">data</span> -&gt;</span><br><span class="line">   <span class="comment">//TODO</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>4、如果以上代码中的<strong>data参数没有使用</strong>到的话，可以直接把data去掉</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">mView.setEventListener(&#123;</span><br><span class="line">  <span class="comment">//TODO</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>5、以上代码还可以做个调整，由于setEventListener函数<strong>最后一个参数是一个函数</strong>的话，可以直接把括号的实现提到圆括号外面</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">mView.setEventListener()&#123;</span><br><span class="line">   <span class="comment">//TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>6、由于setEventListener这个函数<strong>只有一个参数</strong>，可以直接省略圆括号</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">mView.setEventListener&#123;</span><br><span class="line">  <span class="comment">//TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>【转载】关于QQ读取Chrome历史记录的澄清</title>
    <url>/2021/01/25/clarification-of-qq-reading-chrome-history/</url>
    <content><![CDATA[<p><a href="https://bbs.pediy.com/thread-265359.htm">原文链接</a></p>
<p>今天看到群里有同学发了一篇v2ex上的<a href="https://www.v2ex.com/t/745030">帖子</a>，说QQ会读取Chrome的历史记录，被火绒自定义规则拦截了，本来我是不信的，但是他说他复现了，而且是QQ登录10分钟后才会去访问。</p>
<p>这我就想去验证下了，开虚拟机装QQ、Chrome，然后打开Process Monitor开始等。规则简单的过滤下。</p>
<p><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_DJ94X9WVG4MBTWR.png" alt="img"><br>果然看到了读取AppData\Local\Google\Chrome\User Data\Default\History等目录的操作。</p>
<p><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_W68XZTFJANKMN69.png" alt="img"><br>而且时间也是恰到好处的十分钟。</p>
<p><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_FWD8MPBYN2VRD3G.png" alt="img"><br>这是实锤了QQ和Chrome过不去啊，这我可不信，把规则去掉，重新翻了一下才发现果然是冤枉QQ了啊。</p>
<p><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_AGXY96FE877JTJU.png" alt="img"><br>受害人之多令人震惊，仔细一看，这玩意是遍历了Appdata\Local\下的所有文件夹，然后加上User Data\Default\History去读啊。User Data\Default\History是谷歌系浏览器（火狐等浏览器不熟，不清楚目录如何）默认的历史纪录存放位置，Chrome中枪也就很正常了。</p>
<p>然后就该研究研究QQ为啥要这么干了，读取到的浏览器历史记录又拿来干啥了呢？</p>
<p>挂上x32dbg，动态调试找到位置。</p>
<p><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_C2KUMY3YXHM4B37.png" alt="img"><br>然后去IDA里直接反编译出来，如下（位置在AppUtil.dll中 .text:510EFB98 附近）</p>
<p><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_5HHXWXCZHYAZ4RH.png" alt="img"><br>这一段的逻辑还是很好看懂的，先读取各种 User Data\Default\History 文件，读到了就复制到Temp目录下的temphis.db。回去看下Procmom，果然没错。</p>
<p><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_3CRMBX6H9ENTZ6B.png" alt="img"><br>再之后的操作就简单了，SQLite读取数据库，然后“select url from urls”，这是在干什么大家都懂哈。后面就不接着讲了，有兴趣的可以自己接着看。</p>
<p>结论，QQ并不是特意读取Chrome的历史记录的，而是会试图读取电脑里所有谷歌系浏览器的历史记录并提取链接，确认会中招的浏览器包括但不限于Chrome、Chromium、360极速、360安全、猎豹、2345等浏览器。</p>
<p>晚上来编辑一下，刚才去试了下TIM，果然经典重现，而且比QQ还离谱，不多说直接上图。</p>
<p><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_W44WFBHCYKMC3PX.png" alt="图片描述"><br><img src="/2021/01/25/clarification-of-qq-reading-chrome-history/873391_FY3MV2SM35XPDR2.png" alt="img"></p>
]]></content>
      <categories>
        <category>互联网动态</category>
      </categories>
  </entry>
  <entry>
    <title>Windows VScode 配置 C++ 环境</title>
    <url>/2021/01/28/windows-vscode-configures-the-cpp-environment/</url>
    <content><![CDATA[<p><strong>Windows 安装 MinGW-w64</strong></p>
<ol>
<li><p><a href="http://mingw-w64.org/doku.php/download">官网下载地址</a></p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img0.png" alt="mingw-w64"></p>
<p>Windows点击 <strong><a href="http://mingw-w64.org/doku.php/download/mingw-builds">MingW-W64-builds</a></strong> 选项下载</p>
</li>
<li><p>下载后安装</p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img4.png" alt="安装"></p>
</li>
<li><p>安装过程，下载文件</p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img5.png" alt="安装过程"></p>
<p>在国内下载过程非常慢，我下载了两天，最终失败。所以直接去下载安装包了。</p>
</li>
<li><p>下载安装包 <a href="mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0.7z" title="mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0.7z">mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0.7z</a></p>
</li>
<li><p>解压文件到本地目录并复制<code>bin</code>的路径</p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img2.png" alt="本地目录"></p>
</li>
<li><p>将路径添加到环境变量</p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img1.png" alt="添加到环境变量"></p>
</li>
<li><p>在命令行检查环境变量是否配置成功</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc --version</span><br><span class="line">g++ --version</span><br><span class="line">gdb --version</span><br></pre></td></tr></table></figure>

<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img3.png" alt="命令行"></p>
</li>
</ol>
<p><strong>VSCode 配置C++</strong></p>
<ol>
<li><p>vscode 安装C++插件，在vscode插件中搜索<code>C++</code></p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img6.png" alt="安装C++插件"></p>
</li>
<li><p>配置编译器</p>
<p>按快捷键<code>Ctrl+Shift+P</code>调出命令面板，输入<code>C/C++</code>，选择<code>Edit Configurations(UI)</code>进入配置。</p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img7.png" alt="快捷进入C++配置"></p>
<p> <img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img8.png" alt="配置页面面板"></p>
<p> 配置两个选项：</p>
</li>
</ol>
<ul>
<li><p>编译器路径</p>
</li>
<li><p>IntelliSense 模式</p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img9.png" alt="编译器路径"></p>
<p>  <img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img10.png" alt="IntelliSense 模式"></p>
<p>  配置完成后，此时在侧边栏可以发现多了一个<code>.vscode</code>文件夹，并且里面有一个<code>c_cpp_properties.json</code>文件，内容如下，说明上述配置成功。</p>
  <details>
  <summary><font color='blue'>点我展开 c_cpp_properties.json</font></summary>

  <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Win32&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;includePath&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;$&#123;workspaceFolder&#125;/**&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;defines&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;_DEBUG&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UNICODE&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_UNICODE&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;compilerPath&quot;</span>: <span class="string">&quot;D:/Program Files (x86)/mingw-w64/mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0/mingw64/bin/g++.exe&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cStandard&quot;</span>: <span class="string">&quot;gnu17&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cppStandard&quot;</span>: <span class="string">&quot;gnu++14&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;intelliSenseMode&quot;</span>: <span class="string">&quot;gcc-x64&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  </details></li>
</ul>
<ol start="4">
<li><p>现在可以通过 Ctrl + &lt; + ` 快捷键打开内置终端并进行编译运行了。</p>
<p> <img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img11.png" alt="终端运行程序"></p>
</li>
<li><p>配置构建任务</p>
<p>使用vscode的默认构建任务工具，调用<code>g++</code>编译器，编译源代码，创建可执行文件。</p>
<p>同样，按快捷键<code>Ctrl+Shift+P</code>调出命令面板，输入<code>tasks</code>，选择<code>Tasks:Configure Default Build Task</code></p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img12.png" alt="命令面板"></p>
<p>再选择<code>C/C++: g++.exe build active file</code>，会出现一个<code>tasks.json</code>配置文件：</p>
 <details>
 <summary><font color='blue'>点我展开 tasks.json</font></summary>

 <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;2.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;tasks&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;cppbuild&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;label&quot;</span>: <span class="string">&quot;C/C++: g++.exe build active file&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;D:/Program Files (x86)/mingw-w64/mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0/mingw64/bin/g++.exe&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;args&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;-g&quot;</span>,</span><br><span class="line">                <span class="string">&quot;$&#123;file&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;-o&quot;</span>,</span><br><span class="line">                <span class="string">&quot;$&#123;fileDirname&#125;\\$&#123;fileBasenameNoExtension&#125;.exe&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;options&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;cwd&quot;</span>: <span class="string">&quot;D:/Program Files (x86)/mingw-w64/mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0/mingw64/bin&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;problemMatcher&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;$gcc&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;group&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;kind&quot;</span>: <span class="string">&quot;build&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;isDefault&quot;</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;detail&quot;</span>: <span class="string">&quot;compiler: \&quot;D:/Program Files (x86)/mingw-w64/mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0/mingw64/bin/g++.exe\&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 </details></li>
<li><p>配置调试设置</p>
<p>点击菜单<code>运行-&gt;启动调试</code></p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img13.png" alt="菜单"></p>
<p>选择<code>C++(GDB/LLDB)</code></p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img14.png" alt="C++(GDB/LLDB)"></p>
<p>在选择<code>g++.exe - 生成和调试活动文件</code></p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img15.png"></p>
<p>会在<code>.vscode</code>文件夹里面生成一个<code>launch.json</code>文件</p>
 <details>
 <summary><font color='blue'>点我展开 launch.json</font></summary>

 <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用 IntelliSense 了解相关属性。 </span></span><br><span class="line">    <span class="comment">// 悬停以查看现有属性的描述。</span></span><br><span class="line">    <span class="comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;g++.exe - 生成和调试活动文件&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;cppdbg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;program&quot;</span>: <span class="string">&quot;$&#123;fileDirname&#125;\\$&#123;fileBasenameNoExtension&#125;.exe&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;args&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span>: <span class="string">&quot;D:/Program Files (x86)/mingw-w64/mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0/mingw64/bin&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;environment&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span>: <span class="string">&quot;gdb&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;miDebuggerPath&quot;</span>: <span class="string">&quot;D:\\Program Files (x86)\\mingw-w64\\mingw64-x86_64-8.1.0-release-posix-seh-rt_v6-rev0\\mingw64\\bin\\gdb.exe&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;为 gdb 启用整齐打印&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;-enable-pretty-printing&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;preLaunchTask&quot;</span>: <span class="string">&quot;C/C++: g++.exe build active file&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 </details>

<p> 然后，可以点击右下角<code>添加配置...</code>按钮，添加相应配置</p>
<p> <img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img17.png" alt="launch.json配置"></p>
<p> 或者复制别人的配置进来。</p>
</li>
</ol>
<p>至此，<code>.vscode</code>文件夹下共有三个文件<code>c_cpp_properties.json</code>、<code>launch.json</code>、<code>tasks.json</code>。</p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img16.png" alt=".vscode"></p>
<blockquote>
<p>手动创建这三个文件，将上述相应内容复制进去，也可以完成相应配置。</p>
</blockquote>
<p>现在可以按<code>F5</code>调试一下<code>hello.cpp</code>试试</p>
<p><img src="/2021/01/28/windows-vscode-configures-the-cpp-environment/img18.png" alt="调试"></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装Flutter开发环境</title>
    <url>/2021/02/19/linux-install-flutter-development-environment/</url>
    <content><![CDATA[<p><a href="https://flutter.dev/docs/development/tools/sdk/releases?tab=linux">转到下载页</a></p>
<blockquote>
<p>在Windows电脑上通过ssh连接局域网内Linux打包服务器，在命令行安装flutter开发环境</p>
</blockquote>
<h2 id="获取Flutter-SDK"><a href="#获取Flutter-SDK" class="headerlink" title="获取Flutter SDK"></a>获取Flutter SDK</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget https://storage.googleapis.com/flutter_infra/releases/stable/linux/flutter_linux_1.22.5-stable.tar.xz</span><br></pre></td></tr></table></figure>

<p><img src="/2021/02/19/linux-install-flutter-development-environment/img1.png" alt="下载flutterSDK"></p>
<h2 id="将文件解压到合适目录下"><a href="#将文件解压到合适目录下" class="headerlink" title="将文件解压到合适目录下"></a>将文件解压到合适目录下</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar xf flutter_linux_1.22.5-stable.tar.xz</span><br></pre></td></tr></table></figure>

<p><img src="/2021/02/19/linux-install-flutter-development-environment/img2.png" alt="解压"></p>
<p>如果你不想安装安装包的补丁，你可以跳过步骤 1 或步骤 2，直接获取 Github 上 Flutter 仓库 的源码并执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/flutter/flutter.git</span><br></pre></td></tr></table></figure>

<p>你也可以按你的需要切换分支或者tag。例如，你可以使用 stable 版本的分支：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/flutter/flutter.git -b stable --depth 1</span><br></pre></td></tr></table></figure>

<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><ul>
<li>编辑<code>.profile</code>文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi .profile</span><br></pre></td></tr></table></figure>

<ul>
<li>添加以下行并</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn //国内用户需要设置</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn //国内用户需要设置</span><br><span class="line">export PATH=[flutter dir]/flutter/bin:$PATH</span><br></pre></td></tr></table></figure>

<p><img src="/2021/02/19/linux-install-flutter-development-environment/img3.png" alt="环境变量"></p>
<ul>
<li>运行<code>source .profile</code>使得环境变量生效</li>
</ul>
<h2 id="执行命令初始化环境"><a href="#执行命令初始化环境" class="headerlink" title="执行命令初始化环境"></a>执行命令初始化环境</h2><ul>
<li><p>运行flutter自动下载dart SDK<br><img src="/2021/02/19/linux-install-flutter-development-environment/img4.png" alt="初始化环境"></p>
</li>
<li><p>运行<code>flutter doctor</code>检查工具链<br><img src="/2021/02/19/linux-install-flutter-development-environment/img5.png" alt="检查工具链"></p>
</li>
<li><p>运行<code>flutter doctor --android-licenses</code>同意相关协议<br><img src="/2021/02/19/linux-install-flutter-development-environment/img6.png" alt="相关协议"></p>
</li>
</ul>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>flutter</tag>
      </tags>
  </entry>
  <entry>
    <title>2021 Happy New Year</title>
    <url>/2021/02/12/happy-new-year/</url>
    <content><![CDATA[<p>2021，30而立，年除日，吃自己下的饺子。</p>
<ul>
<li><p>猪肉香菇馅的饺子<br><img src="/2021/02/12/happy-new-year/IMG_2452.jpeg" alt="猪肉香菇馅的饺子"></p>
</li>
<li><p>崂山啤酒<br><img src="/2021/02/12/happy-new-year/IMG_2455.jpeg" alt="崂山啤酒"></p>
</li>
</ul>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
  </entry>
  <entry>
    <title>Jekins构建Android项目</title>
    <url>/2021/02/24/jekins-build-android-project/</url>
    <content><![CDATA[<ul>
<li><p>构建面板<br><img src="/2021/02/24/jekins-build-android-project/img1.png" alt="img1"></p>
</li>
<li><p>属性配置<br><img src="/2021/02/24/jekins-build-android-project/img2.jpeg" alt="img2"><br><img src="/2021/02/24/jekins-build-android-project/img3.jpeg" alt="img3"><br><img src="/2021/02/24/jekins-build-android-project/img4.jpeg" alt="img4"></p>
</li>
<li><p>gradle task任务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">app:clean</span><br><span class="line">app:assemble$&#123;PRODUCT_FLAVORS&#125;$&#123;BUILD_TYPE&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>构建完成，复制apk包到tomcat配置的公开目录下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp /home/androidserver/.jenkins/workspace/Android/app/build/outputs/apk/$&#123;PRODUCT_FLAVORS&#125;/$&#123;BUILD_TYPE&#125;/$&#123;APP_NAME&#125;-$&#123;PRODUCT_FLAVORS&#125;-$&#123;BUILD_TYPE&#125;-$&#123;APP_BUILD_TIME&#125;.apk /home/androidserver/Public/mmmiddle/$&#123;APP_NAME&#125;-$&#123;PRODUCT_FLAVORS&#125;-$&#123;BUILD_TYPE&#125;-$&#123;APP_BUILD_TIME&#125;.apk</span><br></pre></td></tr></table></figure></li>
<li><p>钉钉消息配置，发送tomcat公开目录下的新apk文件地址</p>
<blockquote>
<p><a href="http://192.168.2.98:8080/public/mmmiddle/$%7BAPP_NAME%7D-$%7BPRODUCT_FLAVORS%7D-$%7BBUILD_TYPE%7D-$%7BAPP_BUILD_TIME%7D.apk">http://192.168.2.98:8080/public/mmmiddle/${APP_NAME}-${PRODUCT_FLAVORS}-${BUILD_TYPE}-${APP_BUILD_TIME}.apk</a></p>
<p>${DESCRIPTION}</p>
</blockquote>
</li>
<li><p>钉钉消息样式<br><img src="/2021/02/24/jekins-build-android-project/img6.png" alt="钉钉消息样式"></p>
</li>
</ul>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p><img src="/2021/02/24/jekins-build-android-project/img5.jpeg" alt="安装的插件"></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>jekins</tag>
      </tags>
  </entry>
  <entry>
    <title>Jekins构建Flutter项目</title>
    <url>/2021/02/24/jekins-build-flutter-project/</url>
    <content><![CDATA[<ul>
<li><p>构建面板<br><img src="/2021/02/24/jekins-build-flutter-project/img1.png" alt="img1"></p>
</li>
<li><p>构建命令</p>
<blockquote>
<p>以登录方式执行bash命令，进入项目目录下，清除flutter缓存，构建对应服务器的Android apk，构建完成，将apk复制到tomcat公开目录下，发送钉钉消息。其他同Android项目构建</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/sh -l</span><br><span class="line">cd ~/.jenkins/workspace/Flutter</span><br><span class="line">flutter clean</span><br><span class="line">flutter build apk --obfuscate --split-debug-info=/Flutter/build --target lib/main_$&#123;FLAVOR_NAME&#125;.dart</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>jekins</tag>
      </tags>
  </entry>
  <entry>
    <title>禅道项目管理软件部署</title>
    <url>/2021/03/09/zentao-project-management-software-deployment/</url>
    <content><![CDATA[<blockquote>
<p>Windows连接远程Linux部署项目管理软件</p>
</blockquote>
<p><a href="ZenTaoPMS.12.5.3.zbox_64.tar.gz">禅道软件包</a></p>
<ul>
<li><p>复制安装包到远程Linux</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">scp E:\Download\ZenTaoPMS.12.5.3.zbox_64.tar.gz androidserver@10.10.2.98:/home/androidserver/Desktop</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/09/zentao-project-management-software-deployment/img1.png"></p>
</li>
<li><p>解压到<code>opt</code>目录下</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -xzf ZenTaoPMS.12.5.3.zbox_64.tar.gz -C /opt</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/09/zentao-project-management-software-deployment/img2.png"></p>
</li>
<li><p>修改禅道自带apache、mysql端口</p>
<ol>
<li><p>修改禅道自带的apache端口：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/opt/zbox/zbox -ap 9000</span><br></pre></td></tr></table></figure></li>
<li><p>修改禅道自带的mysql端口：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/opt/zbox/zbox -mp 9001</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img src="/2021/03/09/zentao-project-management-software-deployment/img3.png"></p>
</li>
<li><p>启动禅道服务</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/opt/zbox/zbox start</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/09/zentao-project-management-software-deployment/img5.png"></p>
</li>
<li><p>关闭禅道</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/opt/zbox/zbox stop</span><br></pre></td></tr></table></figure></li>
<li><p>重启禅道</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/opt/zbox/zbox restart</span><br></pre></td></tr></table></figure></li>
<li><p>浏览器访问<code>http://10.10.2.98:9000/zentao/</code>，管理员登录的默认账号和密码：<code>admin</code>、<code>123456</code></p>
<p><img src="/2021/03/09/zentao-project-management-software-deployment/img4.png"></p>
</li>
</ul>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
  </entry>
  <entry>
    <title>线性伸缩圆角矩形indicator</title>
    <url>/2021/03/27/linear-telescopic-fillet-rectangle-indicator/</url>
    <content><![CDATA[<p>UI给了一个轮播图的交互<br><img src="/2021/03/27/linear-telescopic-fillet-rectangle-indicator/UI.png" alt="UI"></p>
<p>网上找了一圈，没有很合适的轮子，趁周末自己写了一下</p>
<p>UI显示是ViewPager + Indicator，那么，Indicator和ViewPager的联动，就用比较流行的<a href="https://github.com/hackware1993/MagicIndicator">MagicIndicator</a>去处理，主要关心的是怎样自己定义一个符合UI设计的Indicator</p>
<p>需求是，当向左滑动ViewPager的时候，当前逐渐Indicator变小，下一个逐渐Indicator变大，切换完成之后效果类似两个Indicator交换位置。</p>
<p>效果如下<br><img src="/2021/03/27/linear-telescopic-fillet-rectangle-indicator/scale-linear-rounded-rectangle-navigator.gif" alt="最终效果"></p>
<details>
<summary><font color='blue'>点我展开代码</font></summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint;</span><br><span class="line"><span class="keyword">import</span> android.graphics.PointF;</span><br><span class="line"><span class="keyword">import</span> android.graphics.RectF;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.util.SparseArray;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewConfiguration;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.Interpolator;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.LinearInterpolator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.lucode.hackware.magicindicator.NavigatorHelper;</span><br><span class="line"><span class="keyword">import</span> net.lucode.hackware.magicindicator.abs.IPagerNavigator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 线性伸缩圆角矩形indicator</span></span><br><span class="line"><span class="comment"> * Created by laujiangtao on 2021/3/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScaleLinearRoundedRectangleNavigator</span> <span class="keyword">extends</span> <span class="title">View</span> <span class="keyword">implements</span> <span class="title">IPagerNavigator</span>, <span class="title">NavigatorHelper</span>.<span class="title">OnNavigatorScrollListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRadius;<span class="comment">//小圆点半径</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mNormalCircleColor = Color.LTGRAY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mSelectedCircleColor = Color.GRAY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCircleSpacing;<span class="comment">//圆点之间的空隙</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCircleCount;<span class="comment">//indicator个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRectWidth;<span class="comment">//圆角矩形宽，看作横向伸缩的圆</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Paint mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">    <span class="comment">//存放各个圆心位置</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;PointF&gt; mCirclePoints = <span class="keyword">new</span> ArrayList&lt;PointF&gt;();</span><br><span class="line">    <span class="comment">//稀疏数组存放各个圆的半径</span></span><br><span class="line">    <span class="keyword">private</span> SparseArray&lt;Float&gt; mCircleRadiusArray = <span class="keyword">new</span> SparseArray&lt;Float&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 事件回调</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mTouchable;</span><br><span class="line">    <span class="keyword">private</span> ScaleLinearRoundedRectangleNavigator.OnCircleClickListener mCircleClickListener;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mDownX;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mDownY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTouchSlop;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否跟随手指滑动</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mFollowTouch = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> NavigatorHelper mNavigatorHelper = <span class="keyword">new</span> NavigatorHelper();</span><br><span class="line">    <span class="comment">//使用线性插补器</span></span><br><span class="line">    <span class="keyword">private</span> Interpolator mStartInterpolator = <span class="keyword">new</span> LinearInterpolator();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScaleLinearRoundedRectangleNavigator</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mTouchSlop = ViewConfiguration.get(context).getScaledTouchSlop();</span><br><span class="line">        mRadius = UIUtil.dip2px(context, <span class="number">3</span>);</span><br><span class="line">        mCircleSpacing = UIUtil.dip2px(context, <span class="number">18</span>);</span><br><span class="line">        mRectWidth = UIUtil.dip2px(context, <span class="number">30</span>);</span><br><span class="line">        mNavigatorHelper.setNavigatorScrollListener(<span class="keyword">this</span>);</span><br><span class="line">        mNavigatorHelper.setSkimOver(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        setMeasuredDimension(measureWidth(widthMeasureSpec), measureHeight(heightMeasureSpec));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">measureWidth</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> mode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> width = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">                result = width;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class="line">                <span class="keyword">if</span> (mCircleCount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    result = getPaddingLeft() + getPaddingRight();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//一个圆角矩形的横向宽 + (n-1)*小圆直径 + (n-1)*圆之间的空隙 + 左右边距</span></span><br><span class="line">                    result = mRectWidth + (mCircleCount - <span class="number">1</span>) * mRadius * <span class="number">2</span> + (mCircleCount - <span class="number">1</span>) * mCircleSpacing + getPaddingLeft() + getPaddingRight();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">measureHeight</span><span class="params">(<span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> mode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> height = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">                result = height;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class="line">                <span class="comment">//小圆的直径 + 上下边距</span></span><br><span class="line">                result = mRadius * <span class="number">2</span> + getPaddingTop() + getPaddingBottom();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//遍历画每个位置上的View</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = mCirclePoints.size(); i &lt; j; i++) &#123;</span><br><span class="line">            <span class="comment">//获取圆心位置</span></span><br><span class="line">            PointF point = mCirclePoints.get(i);</span><br><span class="line">            <span class="comment">//从稀疏数组中获取当前位置圆的半径</span></span><br><span class="line">            <span class="keyword">float</span> radius = mCircleRadiusArray.get(i, (<span class="keyword">float</span>) mRadius);</span><br><span class="line">            <span class="comment">//颜色渐变处理</span></span><br><span class="line">            mPaint.setColor(eval((radius - mRadius) / (mRectWidth / <span class="number">2</span> - mRadius), mNormalCircleColor, mSelectedCircleColor));</span><br><span class="line">            <span class="meta">@SuppressLint(&quot;DrawAllocation&quot;)</span></span><br><span class="line">            RectF rectF = <span class="keyword">new</span> RectF();</span><br><span class="line">            <span class="keyword">if</span> (radius == (<span class="keyword">float</span>) mRadius || Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">                <span class="comment">//如果是小圆或者当前SDK小于Android5，直接画小圆</span></span><br><span class="line">                rectF.left = point.x - mRadius;</span><br><span class="line">                rectF.right = point.x + mRadius;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//宽度渐变，算法同颜色渐变</span></span><br><span class="line">                <span class="comment">//权重：当前变化量与最大变化量之比 =&gt; (radius - mRadius) / (mRectWidth / 2 - mRadius)</span></span><br><span class="line">                <span class="comment">//当前变化位置 =&gt; 权重 * 横向变化量 =&gt; 权重 *（结束宽度 - 开始宽度）=&gt; weight * (end - start)</span></span><br><span class="line">                <span class="comment">//从小圆变为圆角矩形，那么半径从 mRadius 变为（mRectWidth / 2），即开始半径为 mRadius，结束时半径为（mRectWidth / 2）</span></span><br><span class="line">                <span class="comment">//左边变化之后位置为 最大变化位置 - mRadius</span></span><br><span class="line">                <span class="comment">//右边变化之后位置为 最大变化位置 + mRadius</span></span><br><span class="line">                <span class="keyword">int</span> ff = -mRadius + (<span class="keyword">int</span>) ((radius - mRadius) / (mRectWidth / <span class="number">2</span> - mRadius) * (mRadius - mRectWidth / <span class="number">2</span>));</span><br><span class="line">                rectF.left = point.x - ff;</span><br><span class="line">                rectF.right = point.x + ff;</span><br><span class="line">            &#125;</span><br><span class="line">            rectF.top = point.y - mRadius;</span><br><span class="line">            rectF.bottom = point.y + mRadius;</span><br><span class="line">            canvas.drawRoundRect(rectF, radius, radius, mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">prepareCirclePoints</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mCirclePoints.clear();</span><br><span class="line">        <span class="keyword">if</span> (mCircleCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> y = Math.round(getHeight() / <span class="number">2.0f</span>);</span><br><span class="line">            <span class="comment">//圆心间距 =&gt; 一个小圆 + 圆的间隙</span></span><br><span class="line">            <span class="keyword">int</span> centerSpacing = mRadius * <span class="number">2</span> + mCircleSpacing;</span><br><span class="line">            <span class="comment">//开始是圆心位置 =&gt; 左间距 + 圆角矩形宽的一半</span></span><br><span class="line">            <span class="keyword">int</span> startX = getPaddingLeft() + mRectWidth / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mCircleCount; i++) &#123;</span><br><span class="line">                PointF pointF = <span class="keyword">new</span> PointF(startX, y);</span><br><span class="line">                mCirclePoints.add(pointF);</span><br><span class="line">                startX += centerSpacing;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> x = event.getX();</span><br><span class="line">        <span class="keyword">float</span> y = event.getY();</span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                <span class="keyword">if</span> (mTouchable) &#123;</span><br><span class="line">                    mDownX = x;</span><br><span class="line">                    mDownY = y;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                <span class="keyword">if</span> (mCircleClickListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (Math.abs(x - mDownX) &lt;= mTouchSlop &amp;&amp; Math.abs(y - mDownY) &lt;= mTouchSlop) &#123;</span><br><span class="line">                        <span class="keyword">float</span> max = Float.MAX_VALUE;</span><br><span class="line">                        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mCirclePoints.size(); i++) &#123;</span><br><span class="line">                            PointF pointF = mCirclePoints.get(i);</span><br><span class="line">                            <span class="keyword">float</span> offset = Math.abs(pointF.x - x);</span><br><span class="line">                            <span class="keyword">if</span> (offset &lt; max) &#123;</span><br><span class="line">                                max = offset;</span><br><span class="line">                                index = i;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        mCircleClickListener.onClick(index);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrolled</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">float</span> positionOffset, <span class="keyword">int</span> positionOffsetPixels)</span> </span>&#123;</span><br><span class="line">        mNavigatorHelper.onPageScrolled(position, positionOffset, positionOffsetPixels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        mNavigatorHelper.onPageSelected(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrollStateChanged</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</span><br><span class="line">        mNavigatorHelper.onPageScrollStateChanged(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">        prepareCirclePoints();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyDataSetChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        prepareCirclePoints();</span><br><span class="line">        requestLayout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttachToMagicIndicator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDetachFromMagicIndicator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMinRadius</span><span class="params">(<span class="keyword">int</span> minRadius)</span> </span>&#123;</span><br><span class="line">        mRadius = minRadius;</span><br><span class="line">        prepareCirclePoints();</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNormalCircleColor</span><span class="params">(<span class="keyword">int</span> normalCircleColor)</span> </span>&#123;</span><br><span class="line">        mNormalCircleColor = normalCircleColor;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSelectedCircleColor</span><span class="params">(<span class="keyword">int</span> selectedCircleColor)</span> </span>&#123;</span><br><span class="line">        mSelectedCircleColor = selectedCircleColor;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCircleSpacing</span><span class="params">(<span class="keyword">int</span> circleSpacing)</span> </span>&#123;</span><br><span class="line">        mCircleSpacing = circleSpacing;</span><br><span class="line">        prepareCirclePoints();</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRectWidth</span><span class="params">(<span class="keyword">int</span> rectWidth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mRectWidth = rectWidth;</span><br><span class="line">        prepareCirclePoints();</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStartInterpolator</span><span class="params">(Interpolator startInterpolator)</span> </span>&#123;</span><br><span class="line">        mStartInterpolator = startInterpolator;</span><br><span class="line">        <span class="keyword">if</span> (mStartInterpolator == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mStartInterpolator = <span class="keyword">new</span> LinearInterpolator();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCircleCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        mCircleCount = count;  <span class="comment">// 此处不调用invalidate，让外部调用notifyDataSetChanged</span></span><br><span class="line">        mNavigatorHelper.setTotalCount(mCircleCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTouchable</span><span class="params">(<span class="keyword">boolean</span> touchable)</span> </span>&#123;</span><br><span class="line">        mTouchable = touchable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFollowTouch</span><span class="params">(<span class="keyword">boolean</span> followTouch)</span> </span>&#123;</span><br><span class="line">        mFollowTouch = followTouch;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSkimOver</span><span class="params">(<span class="keyword">boolean</span> skimOver)</span> </span>&#123;</span><br><span class="line">        mNavigatorHelper.setSkimOver(skimOver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCircleClickListener</span><span class="params">(OnCircleClickListener circleClickListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!mTouchable) &#123;</span><br><span class="line">            mTouchable = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mCircleClickListener = circleClickListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEnter</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> totalCount, <span class="keyword">float</span> enterPercent, <span class="keyword">boolean</span> leftToRight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mFollowTouch) &#123;</span><br><span class="line">            <span class="comment">//进入时，半径从小变大，mRadius =&gt; mRectWidth / 2</span></span><br><span class="line">            <span class="comment">//mStartInterpolator.getInterpolation(enterPercent) 即为权重</span></span><br><span class="line">            <span class="keyword">float</span> radius = mRadius + (mRectWidth / <span class="number">2</span> - mRadius) * mStartInterpolator.getInterpolation(enterPercent);</span><br><span class="line">            mCircleRadiusArray.put(index, radius);</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLeave</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> totalCount, <span class="keyword">float</span> leavePercent, <span class="keyword">boolean</span> leftToRight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mFollowTouch) &#123;</span><br><span class="line">            <span class="comment">//离开时，半径从大变小，mRectWidth / 2 =&gt; mRadius</span></span><br><span class="line">            <span class="keyword">float</span> radius = mRectWidth / <span class="number">2</span> - (mRectWidth / <span class="number">2</span> - mRadius) * mStartInterpolator.getInterpolation(leavePercent);</span><br><span class="line">            mCircleRadiusArray.put(index, radius);</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSelected</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> totalCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!mFollowTouch) &#123;</span><br><span class="line">            mCircleRadiusArray.put(index, (<span class="keyword">float</span>) mRectWidth / <span class="number">2</span>);</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDeselected</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> totalCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!mFollowTouch) &#123;</span><br><span class="line">            mCircleRadiusArray.put(index, (<span class="keyword">float</span>) mRadius);</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnCircleClickListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">eval</span><span class="params">(<span class="keyword">float</span> fraction, <span class="keyword">int</span> startValue, <span class="keyword">int</span> endValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> startA = (startValue &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="keyword">int</span> startR = (startValue &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="keyword">int</span> startG = (startValue &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="keyword">int</span> startB = startValue &amp; <span class="number">0xff</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> endA = (endValue &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="keyword">int</span> endR = (endValue &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="keyword">int</span> endG = (endValue &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="keyword">int</span> endB = endValue &amp; <span class="number">0xff</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> currentA = (startA + (<span class="keyword">int</span>) (fraction * (endA - startA))) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">        <span class="keyword">int</span> currentR = (startR + (<span class="keyword">int</span>) (fraction * (endR - startR))) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">int</span> currentG = (startG + (<span class="keyword">int</span>) (fraction * (endG - startG))) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">int</span> currentB = startB + (<span class="keyword">int</span>) (fraction * (endB - startB));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> currentA | currentR | currentG | currentB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">dip2px</span><span class="params">(Context context, <span class="keyword">double</span> dpValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> density = context.getResources().getDisplayMetrics().density;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (dpValue * density + <span class="number">0.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>自定义View</tag>
      </tags>
  </entry>
  <entry>
    <title>Android自动任务探索</title>
    <url>/2021/05/19/android-auto-task/</url>
    <content><![CDATA[<p>若要手机自动执行任务，首要做的就是保活自己的app，避免被系统把进程杀掉。</p>
<p>网络上有许多app保活方式，也有许多靠谱的操作，更多的则是不寻常的路子，而且还不稳定，容易被系统回收资源。</p>
<p>下面列出三种自己探索过的app保活方式</p>
<h3 id="方案一：通知保活"><a href="#方案一：通知保活" class="headerlink" title="方案一：通知保活"></a>方案一：通知保活</h3><p>在通知栏创建一个常驻通知，创建的时候将自己应用的上下文传入，目前个中音乐app就是用这种方式实现长时间驻留后台的，Google官方也推荐这种方式。</p>
<p>定义执行任务的服务，在服务开启的时候显示通知栏的通知保活</p>
<details>
<summary><font color='blue'>点我展开</font></summary>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.*</span><br><span class="line"><span class="keyword">import</span> android.content.Context</span><br><span class="line"><span class="keyword">import</span> android.content.Intent</span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> android.os.Build</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> cn.ljt.clock.<span class="keyword">open</span></span><br><span class="line"><span class="keyword">import</span> cn.ljt.clock.playAudio</span><br><span class="line"><span class="keyword">import</span> com.tencent.mmkv.MMKV</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat</span><br><span class="line"><span class="keyword">import</span> java.util.*</span><br><span class="line"><span class="keyword">import</span> kotlin.concurrent.fixedRateTimer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotificationService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> channelId: String = <span class="string">&quot;ChannelId&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> timer: Timer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line">        startTimer()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>)</span></span>: IBinder? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartCommand</span><span class="params">(intent: <span class="type">Intent</span>?, flags: <span class="type">Int</span>, startId: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> notificationManager =</span><br><span class="line">            getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">            <span class="keyword">val</span> channel = NotificationChannel(</span><br><span class="line">                channelId,</span><br><span class="line">                packageName + <span class="string">&quot;打卡&quot;</span>,</span><br><span class="line">                NotificationManager.IMPORTANCE_LOW</span><br><span class="line">            )</span><br><span class="line">            notificationManager.createNotificationChannel(channel)</span><br><span class="line">        &#125;</span><br><span class="line">        startForeground(<span class="number">1</span>, getNotification())</span><br><span class="line">        <span class="keyword">return</span> START_STICKY</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getNotification</span><span class="params">()</span></span>: Notification &#123;</span><br><span class="line">        <span class="keyword">val</span> contentIntent = Intent()</span><br><span class="line">        contentIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)</span><br><span class="line">        contentIntent.action = <span class="string">&quot;android.settings.APPLICATION_DETAILS_SETTINGS&quot;</span></span><br><span class="line">        contentIntent.<span class="keyword">data</span> = Uri.fromParts(<span class="string">&quot;package&quot;</span>, packageName, <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">val</span> builder: Notification.Builder = Notification.Builder(<span class="keyword">this</span>)</span><br><span class="line">            .setSmallIcon(android.R.mipmap.sym_def_app_icon)</span><br><span class="line">            .setContentIntent(PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, contentIntent, <span class="number">0</span>))</span><br><span class="line">            .setContentTitle(<span class="string">&quot;\&quot;<span class="variable">$packageName</span>\&quot;正在运行&quot;</span>)</span><br><span class="line">            .setContentText(<span class="string">&quot;触摸即可了解详情或停止应用&quot;</span>)</span><br><span class="line">        <span class="comment">//设置Notification的ChannelID,否则不能正常显示</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">            builder.setChannelId(channelId)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.build()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        stopTimer()</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            stopForeground(STOP_FOREGROUND_REMOVE)</span><br><span class="line">        &#125;</span><br><span class="line">        stopForeground(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">startTimer</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        timer = fixedRateTimer(<span class="string">&quot;&quot;</span>, <span class="literal">false</span>, <span class="number">0</span>, period * <span class="number">1000</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> 根据条件执行任务</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                Log.i(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;<span class="variable">$e</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">stopTimer</span><span class="params">()</span></span> &#123;</span><br><span class="line">        timer.cancel()</span><br><span class="line">        Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;stopTimer&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="方案二：闹钟唤醒"><a href="#方案二：闹钟唤醒" class="headerlink" title="方案二：闹钟唤醒"></a>方案二：闹钟唤醒</h3><p>实现方式时到点发送一个<code>PendingIntent</code>，自己应用声明一个对应的receiver，在receiver中处理事件。</p>
<ol>
<li><code>AndroidManifest.xml</code>文件添加receiver</li>
</ol>
<details>
<summary><font color='blue'>点我展开</font></summary>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.ui.alarm.AlarmReceiver&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

</details>

<ol start="2">
<li>定义receiver类</li>
</ol>
<details>
<summary><font color='blue'>点我展开</font></summary>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlarmReceiver</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>, intent: <span class="type">Intent</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (intent.action.equals(<span class="string">&quot;<span class="subst">$&#123;context.packageName&#125;</span>.alarm&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> 根据条件执行任务</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<ol start="3">
<li>定义闹钟并开启</li>
</ol>
<details>
<summary><font color='blue'>点我展开</font></summary>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> intent = Intent(<span class="string">&quot;<span class="variable">$packageName</span>.alarm&quot;</span>)</span><br><span class="line">intent.setClass(<span class="keyword">this</span>, AlarmReceiver::<span class="keyword">class</span>.java)</span><br><span class="line"><span class="keyword">val</span> pi = PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, intent, <span class="number">0</span>) <span class="comment">//设置一个PendingIntent对象，发送广播</span></span><br><span class="line"><span class="keyword">val</span> alarmManager = getSystemService(ALARM_SERVICE) <span class="keyword">as</span> AlarmManager <span class="comment">//获取AlarmManager对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &gt;= android.os.Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">    <span class="keyword">val</span> nextAlarmClock = alarmManager.nextAlarmClock</span><br><span class="line">    <span class="keyword">if</span> (nextAlarmClock != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> showIntent = nextAlarmClock.showIntent</span><br><span class="line">        <span class="keyword">val</span> triggerTime = nextAlarmClock.triggerTime</span><br><span class="line">        Log.i(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;init: <span class="variable">$showIntent</span>&quot;</span>)</span><br><span class="line">        Log.i(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;init: <span class="variable">$triggerTime</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//AlarmManager.ELAPSED_REALTIME: 闹钟在手机睡眠状态下不可用，该状态下闹钟使用相对时间（相对于系统启动开始），状态值为3; </span></span><br><span class="line"><span class="comment">//AlarmManager.ELAPSED_REALTIME_WAKEUP: 闹钟在睡眠状态下会唤醒系统并执行提示功能，该状态下闹钟也使用相对时间，状态值为2； </span></span><br><span class="line"><span class="comment">//AlarmManager.RTC: 闹钟在睡眠状态下不可用，该状态下闹钟使用绝对时间，即当前系统时间，状态值为1； </span></span><br><span class="line"><span class="comment">//AlarmManager.RTC_WAKEUP: 表示闹钟在睡眠状态下会唤醒系统并执行提示功能，该状态下闹钟使用绝对时间，状态值为0; </span></span><br><span class="line"><span class="comment">//AlarmManager.POWER_OFF_WAKEUP: 表示闹钟在手机关机状态下也能正常进行提示功能，所以是5个状态中用的最多的状态之一，该状态下闹钟也是用绝对时间，状态值为4；不过本状态好像受SDK版本影响，某些版本并不支持；</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重复执行，倒数第二参数为间隔时间,单位为毫秒</span></span><br><span class="line">alarmManager.setRepeating(AlarmManager.RTC_WAKEUP, calendar.timeInMillis, intervalMillis * <span class="number">1000</span>, pi)</span><br><span class="line"></span><br><span class="line"><span class="comment">//时间到时，执行PendingIntent，只执行一次</span></span><br><span class="line">alarmManager[AlarmManager.RTC_WAKEUP, calendar.timeInMillis] = pi</span><br></pre></td></tr></table></figure>

</details>

<h3 id="方案三：屏保保活"><a href="#方案三：屏保保活" class="headerlink" title="方案三：屏保保活"></a>方案三：屏保保活</h3><p>系统的屏保是一个特殊的service，可以设置屏保的UI，在屏保显示的过程中，app一直存活。同样屏保消失的时候，service也会被销毁。</p>
<ol>
<li><code>AndroidManifest.xml</code> 中添加屏保服务，一定要添加<code>android.permission.BIND_DREAM_SERVICE</code>权限</li>
</ol>
<details>
<summary><font color='blue'>点我展开</font></summary>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.service.MyDream&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:permission</span>=<span class="string">&quot;android.permission.BIND_DREAM_SERVICE&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.service.dreams.DreamService&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;android.service.dream&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:resource</span>=<span class="string">&quot;@xml/my_dream&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>

</details>

<ol start="2">
<li>meta-data指向的资源文件里面声明了屏保的设置页面</li>
</ol>
<details>
<summary><font color='blue'>点我展开</font></summary>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dream</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:settingsActivity</span>=<span class="string">&quot;cn.ljt.clock.ui.dreamsetting.MyDreamActivity&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

</details>

<ol start="3">
<li>屏保服务对应的实体类，继承<code>DreamService</code>，并设置屏保的UI</li>
</ol>
<details>
<summary><font color='blue'>点我展开</font></summary>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context</span><br><span class="line"><span class="keyword">import</span> android.os.SystemClock</span><br><span class="line"><span class="keyword">import</span> android.service.dreams.DreamService</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> cn.ljt.clock.R</span><br><span class="line"><span class="keyword">import</span> com.tencent.mmkv.MMKV</span><br><span class="line"><span class="keyword">import</span> java.util.*</span><br><span class="line"><span class="keyword">import</span> kotlin.concurrent.fixedRateTimer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDream</span> : <span class="type">DreamService</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> TAG: String? = MyDream::<span class="keyword">class</span>.java.name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> boolean: <span class="built_in">Boolean</span>? = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> timer: Timer</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化设置，在这里可以调用 setContentView()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onAttachedToWindow</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttachedToWindow()</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onAttachedToWindow: &quot;</span>)</span><br><span class="line">        <span class="comment">// Exit dream upon user touch</span></span><br><span class="line">        isInteractive = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// Hide system UI</span></span><br><span class="line">        isFullscreen = <span class="literal">true</span></span><br><span class="line">        <span class="comment">//设置为false会降低屏幕亮度</span></span><br><span class="line">        isScreenBright = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// Set the dream layout</span></span><br><span class="line">        setContentView(R.layout.my_day_dream)</span><br><span class="line">        boolean = MMKV.defaultMMKV()?.getBoolean(<span class="string">&quot;dream_task_enable&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在这里回收前面调用的资源（比如 handlers 和 listeners）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDetachedFromWindow()</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onDetachedFromWindow: &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 互动屏保已经启动，这里可以开始播放动画或者其他操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDreamingStarted</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDreamingStarted()</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onDreamingStarted: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (boolean == <span class="literal">true</span>) &#123;</span><br><span class="line">            startTimer()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在停止 onDreamingStarted() 里启动的东西</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDreamingStopped</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDreamingStopped()</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onDreamingStopped: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (boolean == <span class="literal">true</span>) &#123;</span><br><span class="line">            stopTimer()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">startTimer</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        timer = fixedRateTimer(<span class="string">&quot;fixedRateTimer&quot;</span>, <span class="literal">true</span>, period * <span class="number">1000</span>, period * <span class="number">1000</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> 根据条件执行任务</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                Log.i(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;<span class="variable">$e</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">stopTimer</span><span class="params">()</span></span> &#123;</span><br><span class="line">        timer.cancel()</span><br><span class="line">        Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;stopTimer&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="避开屏幕锁"><a href="#避开屏幕锁" class="headerlink" title="避开屏幕锁"></a>避开屏幕锁</h3><p>以上方法可以保活，但是屏幕锁定之后无法开锁。</p>
<p>尝试多种方式，在高版本的手机上，依然无法自动解锁。</p>
<p>在上述三种方案中，第三种屏保的方式可以阻止手机进入锁屏状态，故从它入手。</p>
<p>正常状态下，屏保开启后，轻触屏幕，屏保会自动退出并点亮屏幕。</p>
<p>所以，只需执行代码，模拟轻触屏保的动作即可。</p>
<p>以下提供三种方式，在屏保开启后，试图唤醒页面</p>
<ul>
<li>调用<code>View</code>的<code>performClick()</code>方法(失败)</li>
<li>调用<code>DreamService</code>的<code>wakeUp()</code>方法(失败)</li>
<li>模拟屏幕点击(成功)</li>
</ul>
<details>
<summary><font color='blue'>点我展开</font></summary>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">click</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> inst = Instrumentation()</span><br><span class="line">    inst.sendPointerSync(</span><br><span class="line">        MotionEvent.obtain(</span><br><span class="line">            SystemClock.uptimeMillis(),</span><br><span class="line">            SystemClock.uptimeMillis(),</span><br><span class="line">            MotionEvent.ACTION_DOWN,</span><br><span class="line">            <span class="number">240f</span>,</span><br><span class="line">            <span class="number">400f</span>,</span><br><span class="line">            <span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    inst.sendPointerSync(</span><br><span class="line">        MotionEvent.obtain(</span><br><span class="line">            SystemClock.uptimeMillis(),</span><br><span class="line">            SystemClock.uptimeMillis(),</span><br><span class="line">            MotionEvent.ACTION_UP,</span><br><span class="line">            <span class="number">240f</span>,</span><br><span class="line">            <span class="number">400f</span>,</span><br><span class="line">            <span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>仿butterknife注解</title>
    <url>/2021/09/05/my-butter-knife/</url>
    <content><![CDATA[<p>1、声明变量上面的注解，约束注解使用范围<br>2、添加注解保留级别为运行时，使得注解能被JVM或其他使用反射机制的代码所读取和使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@interface</span> BindView &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> -1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、创建注解类，传入当前activity，后续会使用到activity里面的findviewbyid方法<br>2、获取到activity里面的所有变量属性并遍历（注解消耗性能就在这里）<br>3、判断变量属性上面是否存在上面声明的注解<br>4、如果存在则取出注解并获取注解里面的值<br>5、获取到findViewById方法，通过反射给属性赋值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InjectView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">inject</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == activity) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        Class&lt;? extends Activity&gt; activityClass = activity.getClass();</span><br><span class="line">        Field[] declaredFields = activityClass.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : declaredFields) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(BindView.class)) &#123;</span><br><span class="line">                BindView bindView = field.getAnnotation(BindView.class);</span><br><span class="line">                <span class="keyword">int</span> value = bindView.value();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Method findViewById = activityClass.getMethod(<span class="string">&quot;findViewById&quot;</span>, <span class="keyword">int</span>.class);</span><br><span class="line">                    findViewById.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    Object view = findViewById.invoke(activity, value);</span><br><span class="line">                    field.set(activity, view);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Tue Dec 29 2020 08:35:44 GMT+0800 (中国标准时间)</title>
    <url>/2020/12/29/index/</url>
    <content><![CDATA[<ul>
<li>2020-12-29</li>
</ul>
<p>半睡半醒一整夜，<br>早上醒来还不到6点，<br>透过缝隙可见天已微亮，随手照了一张。<br><img src="./IMG_2222.jpeg" width="400"/></p>
<p>三点钟，朋友圈就有下雪的动态了，估计白天在朋友圈能看各地雪景。</p>
<p>上班路上：<br><video src="./IMG_2223.MOV" width="400" controls="controls"></video></p>
<p>在办公区：<br><video src="./IMG_2224.MOV" controls="controls"></video></p>
<hr>
<ul>
<li>2020-12-30</li>
</ul>
<p>昨天在朋友圈等了一天也没个像样的雪景，自己来一个<br><video src="./7961e53e11f75e86c544fa8cc51f6d.mp4" controls="controls"></video></p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>随手拍</tag>
      </tags>
  </entry>
  <entry>
    <title>【转载】配置方法数超过 64K 的应用</title>
    <url>/2020/12/25/configure-apps-with-more-than-64k-methods/</url>
    <content><![CDATA[<p>随着 Android 平台的持续成长，Android 应用的大小也在增加。当您的应用及其引用的库达到特定大小时，您会遇到构建错误，指明您的应用已达到 Android 应用构建架构的极限。早期版本的构建系统按如下方式报告这一错误：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Conversion to Dalvik format failed:</span><br><span class="line">Unable to execute dex: method ID not in [0, 0xffff]: 65536</span><br></pre></td></tr></table></figure>

<p>较新版本的 Android 构建系统虽然显示的错误不同，但指示的是同一问题：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">trouble writing output:</span><br><span class="line">Too many field references: 131000; max is 65536.</span><br><span class="line">You may try using --multi-dex option.</span><br></pre></td></tr></table></figure>

<p>这些错误状况都会显示下面这个数字：65,536。这个数字很重要，因为它代表的是单个 Dalvik Executable (DEX) 字节码文件内的代码可调用的引用总数。本页介绍如何通过启用被称为 Dalvik 可执行文件分包的应用配置来越过这一限制，使您的应用能够构建并读取 Dalvik 可执行文件分包 DEX 文件。</p>
<h2 id="关于-64K-引用限制"><a href="#关于-64K-引用限制" class="headerlink" title="关于 64K 引用限制"></a>关于 64K 引用限制</h2><p>Android 应用 (APK) 文件包含 <a href="https://source.android.com/devices/tech/dalvik/">Dalvik</a> Executable (DEX) 文件形式的可执行字节码文件，其中包含用来运行您的应用的已编译代码。Dalvik Executable 规范将可在单个 DEX 文件内可引用的方法总数限制在 65,536，其中包括 Android 框架方法、库方法以及您自己代码中的方法。在计算机科学领域内，术语<a href="https://en.wikipedia.org/wiki/Kilo-"><em>千（简称 K）</em></a>表示 1024（或 2^10）。由于 65,536 等于 64 X 1024，因此这一限制也称为“64K 引用限制”。</p>
<h3 id="Android-5-0-之前版本的-Dalvik-可执行文件分包支持"><a href="#Android-5-0-之前版本的-Dalvik-可执行文件分包支持" class="headerlink" title="Android 5.0 之前版本的 Dalvik 可执行文件分包支持"></a>Android 5.0 之前版本的 Dalvik 可执行文件分包支持</h3><p>Android 5.0（API 级别 21）之前的平台版本使用 Dalvik 运行时来执行应用代码。默认情况下，Dalvik 限制应用的每个 APK 只能使用单个 <code>classes.dex</code> 字节码文件。要想绕过这一限制，您可以使用 <a href="https://developer.android.com/tools/support-library/features.html#multidex">Dalvik 可执行文件分包支持库</a>，它会成为您的应用主要 DEX 文件的一部分，然后管理对其他 DEX 文件及其所包含代码的访问。</p>
<blockquote>
<p><strong>注</strong>：如果您的项目配置时所面向的 Dalvik 可执行文件分包使用的是 <code>minSdkVersion 20</code> 或更低版本，并且您将其部署到运行 Android 4.4（API 级别 20）或更低版本的目标设备上，则 Android Studio 会停用 <a href="https://developer.android.com/tools/building/building-studio.html#instant-run">Instant Run</a>。</p>
</blockquote>
<h3 id="Android-5-0-及更高版本的-Dalvik-可执行文件分包支持"><a href="#Android-5-0-及更高版本的-Dalvik-可执行文件分包支持" class="headerlink" title="Android 5.0 及更高版本的 Dalvik 可执行文件分包支持"></a>Android 5.0 及更高版本的 Dalvik 可执行文件分包支持</h3><p>Android 5.0（API 级别 21）及更高版本使用名为 ART 的运行时，后者原生支持从 APK 文件加载多个 DEX 文件。ART 在应用安装时执行预编译，扫描 classesN.dex 文件，并将它们编译成单个 .oat 文件，供 Android 设备执行。因此，如果您的 minSdkVersion 为 21 或更高值，则不需要 Dalvik 可执行文件分包支持库。</p>
<p>如需了解有关 Android 5.0 运行时的详细信息，请参阅 <a href="https://source.android.com/devices/tech/dalvik/art.html">ART 和 Dalvik</a>。</p>
<blockquote>
<p><strong>注</strong>：如果将应用的 <code>minSdkVersion</code> 设置为 21 或更高值，使用 <a href="https://developer.android.com/tools/building/building-studio.html#instant-run">Instant Run</a> 时，Android Studio 会自动将应用配置为进行 Dalvik 可执行文件分包。由于 Instant Run 仅适用于调试版本的应用，您仍需配置发布构建进行 Dalvik 可执行文件分包，以规避 64K 限制。</p>
</blockquote>
<h2 id="规避-64K-限制"><a href="#规避-64K-限制" class="headerlink" title="规避 64K 限制"></a>规避 64K 限制</h2><p>在将您的应用配置为支持使用 64K 或更多方法引用之前，您应该采取措施减少应用代码调用的引用总数，包括由您的应用代码或包含的库定义的方法。下列策略可帮助您避免达到 DEX 引用限制：</p>
<ul>
<li>  <strong>检查您的应用的直接和传递依赖项</strong> - 确保您在应用中使用任何庞大依赖库所带来的好处大于为应用添加大量代码所带来的弊端。一种常见的反面模式是，仅仅为了使用几个实用方法就在应用中加入非常庞大的库。减少您的应用代码依赖项往往能够帮助您规避 dex 引用限制。</li>
<li>  <strong>通过 ProGuard 移除未使用的代码</strong> - 为您的版本构建<a href="https://developer.android.com/studio/build/shrink-code.html">启用代码压缩</a>以运行 ProGuard。启用压缩可确保您交付的 APK 不含有未使用的代码。</li>
</ul>
<p>使用这些技巧使您不必在应用中启用 Dalvik 可执行文件分包，同时还会减小 APK 的总体大小。</p>
<h2 id="配置您的应用进行-Dalvik-可执行文件分包"><a href="#配置您的应用进行-Dalvik-可执行文件分包" class="headerlink" title="配置您的应用进行 Dalvik 可执行文件分包"></a>配置您的应用进行 Dalvik 可执行文件分包</h2><p>将您的应用项目设置为使用 Dalvik 可执行文件分包配置需要对您的应用项目进行以下修改，具体取决于应用支持的最低 Android 版本。</p>
<p>如果您的 minSdkVersion 设置为 21 或更高值，您只需在模块级 build.gradle 文件中将 multiDexEnabled 设置为 true，如此处所示：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        ...</span><br><span class="line">        minSdkVersion <span class="number">21</span> </span><br><span class="line">        targetSdkVersion <span class="number">28</span></span><br><span class="line">        multiDexEnabled <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，如果您的 <code>minSdkVersion</code> 设置为 20 或更低值，则您必须按如下方式使用 <a href="https://developer.android.com/tools/support-library/features.html#multidex">Dalvik 可执行文件分包支持库</a>：</p>
<ul>
<li>修改模块级 build.gradle 文件以启用 Dalvik 可执行文件分包，并将 Dalvik 可执行文件分包库添加为依赖项，如此处所示：</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        ...</span><br><span class="line">        minSdkVersion <span class="number">15</span> </span><br><span class="line">        targetSdkVersion <span class="number">28</span></span><br><span class="line">        multiDexEnabled <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">  compile <span class="string">&#x27;com.android.support:multidex:1.0.3&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>根据是否要替换 <a href="https://developer.android.com/reference/android/app/Application.html"><code>Application</code></a> 类，执行以下操作之一：</li>
</ul>
<ol>
<li>如果您<em>没有</em>替换 <a href="https://developer.android.com/reference/android/app/Application.html"><code>Application</code></a> 类，请编辑清单文件，按如下方式设置 <code>&lt;application&gt;</code> 标记中的 <code>android:name</code>：</li>
</ol>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.example.myapp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;android.support.multidex.MultiDexApplication&quot;</span> &gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>如果您替换了 <a href="https://developer.android.com/reference/android/app/Application.html"><code>Application</code></a> 类，请按如下方式对其进行更改以扩展 <a href="https://developer.android.com/reference/android/support/multidex/MultiDexApplication.html"><code>MultiDexApplication</code></a>（如果可能）：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">MultiDexApplication</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>或者，如果您替换了 <a href="https://developer.android.com/reference/android/app/Application.html"><code>Application</code></a> 类，但无法更改基本类，则可以改为替换 <a href="https://developer.android.com/reference/android/content/ContextWrapper.html#attachBaseContext(android.content.Context)"><code>attachBaseContext()</code></a> 方法并调用 <a href="https://developer.android.com/reference/android/support/multidex/MultiDex.html#install(android.content.Context)"><code>MultiDex.install(this)</code></a> 来启用 Dalvik 可执行文件分包：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">SomeOtherApplication</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">attachBaseContext</span><span class="params">(Context base)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">super</span>.attachBaseContext(base);</span><br><span class="line">     MultiDex.install(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构建应用后，Android 构建工具会根据需要构建主 DEX 文件 (classes.dex) 和辅助 DEX 文件（classes2.dex 和 classes3.dex 等）。然后，构建系统会将所有 DEX 文件打包到您的 APK 中。</p>
<p>运行时，Dalvik 可执行文件分包 API 使用特殊的类加载器来搜索适用于您的方法的所有 DEX 文件（而不是仅在主 classes.dex 文件中搜索）。</p>
<h3 id="Dalvik-可执行文件分包支持库的局限性"><a href="#Dalvik-可执行文件分包支持库的局限性" class="headerlink" title="Dalvik 可执行文件分包支持库的局限性"></a>Dalvik 可执行文件分包支持库的局限性</h3><p>Dalvik 可执行文件分包支持库具有一些已知的局限性，将其纳入您的应用构建配置之中时，您应该注意这些局限性并进行针对性的测试：</p>
<ul>
<li>  启动期间在设备数据分区中安装 DEX 文件的过程相当复杂，如果辅助 DEX 文件较大，可能会导致应用无响应 (ANR) 错误。在此情况下，您应该<a href="https://developer.android.com/studio/build/shrink-code.html">通过 ProGuard 应用代码压缩</a>以尽量减小 DEX 文件的大小，并移除未使用的那部分代码。</li>
<li>  由于存在 Dalvik linearAlloc 错误（问题 <a href="http://b.android.com/22586">22586</a>），使用 Dalvik 可执行文件分包的应用可能无法在运行的平台版本早于 Android 4.0（API 级别 14）的设备上启动。如果您的目标 API 级别低于 14，请务必针对这些版本的平台进行测试，因为您的应用可能会在启动时或加载特定类群时出现问题。代码压缩可以减少甚至有可能消除这些潜在问题。</li>
<li>  由于存在 Dalvik linearAlloc 限制（问题 <a href="http://b.android.com/78035">78035</a>），因此，如果使用 Dalvik 可执行文件分包配置的应用发出非常庞大的内存分配请求，则可能会在运行期间发生崩溃。尽管 Android 4.0（API 级别 14）提高了分配限制，但在 Android 5.0（API 级别 21）之前的 Android 版本上，应用仍有可能遭遇这一限制。</li>
</ul>
<h2 id="声明主-DEX-文件中需要的类"><a href="#声明主-DEX-文件中需要的类" class="headerlink" title="声明主 DEX 文件中需要的类"></a>声明主 DEX 文件中需要的类</h2><p>为 Dalvik 可执行文件分包构建每个 DEX 文件时，构建工具会执行复杂的决策制定来确定主要 DEX 文件中需要的类，以便应用能够成功启动。如果启动期间需要的任何类未在主 DEX 文件中提供，那么您的应用将崩溃并出现错误 <code>java.lang.NoClassDefFoundError</code>。</p>
<p>该情况不应出现在直接从应用代码访问的代码上，因为构建工具能识别这些代码路径，但可能在代码路径可见性较低（如使用的库具有复杂的依赖项）时出现。例如，如果代码使用自检机制或从原生代码调用 Java 方法，那么这些类可能不会被识别为主 DEX 文件中的必需项。</p>
<p>因此，如果您收到 <code>java.lang.NoClassDefFoundError</code>，则必须使用构建类型中的 <a href="http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.BuildType.html#com.android.build.gradle.internal.dsl.BuildType:multiDexKeepFile"><code>multiDexKeepFile</code></a> 或 <a href="http://google.github.io/android-gradle-dsl/2.2/com.android.build.gradle.internal.dsl.BuildType.html#com.android.build.gradle.internal.dsl.BuildType:multiDexKeepProguard"><code>multiDexKeepProguard</code></a> 属性声明它们，以手动将这些其他类指定为主 DEX 文件中的必需项。如果类在 <code>multiDexKeepFile</code> 或 <code>multiDexKeepProguard</code> 文件中匹配，则该类会添加至主 DEX 文件。</p>
<h3 id="multiDexKeepFile-属性"><a href="#multiDexKeepFile-属性" class="headerlink" title="multiDexKeepFile 属性"></a>multiDexKeepFile 属性</h3><p>您在 multiDexKeepFile 中指定的文件应该每行包含一个类，并且采用 com/example/MyClass.class 的格式。例如，您可以创建一个名为 multidex-config.txt 的文件，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">com/example/MyClass.class</span><br><span class="line">com/example/MyOtherClass.class</span><br></pre></td></tr></table></figure>

<p>然后，您可以按以下方式针对构建类型声明该文件：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            multiDexKeepFile file(<span class="string">&#x27;multidex-config.txt&#x27;</span>)</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请记住，Gradle 会读取相对于 build.gradle 文件的路径，因此如果 multidex-config.txt 与 build.gradle 文件在同一目录中，以上示例将有效。</p>
<h3 id="multiDexKeepProguard-属性"><a href="#multiDexKeepProguard-属性" class="headerlink" title="multiDexKeepProguard 属性"></a>multiDexKeepProguard 属性</h3><p><code>multiDexKeepProguard</code> 文件使用与 Proguard 相同的格式，并且支持整个 Proguard 语法。如需了解有关 Proguard 格式和语法的详细信息，请参阅 Proguard 手册中的 <a href="http://proguard.sourceforge.net/manual/usage.html#keepoptions">Keep Options</a> 一节。</p>
<p>您在 <code>multiDexKeepProguard</code> 中指定的文件应该在任何有效的 ProGuard 语法中包含 <code>-keep</code> 选项。例如，<code>-keep com.example.MyClass.class</code>。您可以创建一个名为 <code>multidex-config.pro</code> 的文件，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-keep class com.example.MyClass</span><br><span class="line">-keep class com.example.MyClassToo</span><br></pre></td></tr></table></figure>

<p>如果您想要指定包中的所有类，文件将如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-keep class com.example.** &#123; *; &#125; // All classes in the com.example package</span><br></pre></td></tr></table></figure>

<p>然后，您可以按以下方式针对构建类型声明该文件：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            multiDexKeepProguard(<span class="string">&#x27;multidex-config.pro&#x27;</span>)</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="优化开发构建中的-Dalvik-可执行文件分包"><a href="#优化开发构建中的-Dalvik-可执行文件分包" class="headerlink" title="优化开发构建中的 Dalvik 可执行文件分包"></a>优化开发构建中的 Dalvik 可执行文件分包</h2><p>Dalvik 可执行文件分包配置会大幅增加构建处理时间，因为构建系统必须就哪些类必须包括在主 DEX 文件中以及哪些类可以包括在辅助 DEX 文件中作出复杂的决策。这意味着使用 Dalvik 可执行文件分包的增量式构建通常耗时更长，可能会拖慢您的开发进度。</p>
<p>为了缩短耗时更长的 Dalvik 可执行文件分包输出构建时间，请利用 <a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Product-flavors"><code>productFlavors</code></a>（一个开发定制和一个发布定制，具有不同的 <code>minSdkVersion</code> 值）创建两个构建变型。</p>
<p>对于开发定制，将 <code>minSdkVersion</code> 设置为 21。该设置将启用一个名为 <em>pre-dexing</em> 的构建功能，此功能使用仅适用于 Android 5.0（API 级别 21）和更高版本的 ART 格式更快生成 Dalvik 可执行文件分包输出。对于发布定制，将 <code>minSdkVersion</code> 设置为适于您的实际最低支持级别。此设置生成的 Dalvik 可执行文件分包 APK 可兼容更多设备，但构建时间更长。</p>
<p>以下构建配置示例展示了如何在 Gradle 构建文件中设置这些定制：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        ...</span><br><span class="line">        multiDexEnabled <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        dev &#123;</span><br><span class="line">            <span class="comment">// Enable pre-dexing to produce an APK that can be tested on</span></span><br><span class="line">            <span class="comment">// Android 5.0+ without the time-consuming DEX build processes.</span></span><br><span class="line">            minSdkVersion <span class="number">21</span></span><br><span class="line">        &#125;</span><br><span class="line">        prod &#123;</span><br><span class="line">            <span class="comment">// The actual minSdkVersion for the production version.</span></span><br><span class="line">            minSdkVersion <span class="number">14</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="literal">true</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android.txt&#x27;</span>),</span><br><span class="line">                                                 <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;com.android.support:multidex:1.0.3&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您完成此配置变更后，可以为增量式构建使用应用的 <code>devDebug</code> 变体，后者集 <code>dev</code> 产品定制与 <code>debug</code> 构建类型的属性于一身。这将创建已启用 Dalvik 可执行文件分包且禁用 proguard 的可调试应用（因为 <code>minifyEnabled</code> 默认为 <code>false</code>）。这些设置会使适用于 Gradle 的 Android 插件执行以下操作：</p>
<ol>
<li> 执行 pre-dexing：将每个应用模块和每个依赖项构建为单独的 DEX 文件。</li>
<li> 将每个 DEX 文件加入 APK，并且不做任何修改（不执行代码压缩）。</li>
<li> 最重要的是，模块 DEX 文件不执行合并操作，因此可以避免为确定主 DEX 文件的内容而进行长时间的计算。</li>
</ol>
<p>这些设置的好处是，可以进行快速的增量式构建，因为只有修改过的模块的 DEX 文件才会在后续构建期间重新计算并重新打包。但是，这些构建的 APK 只能用于在 Android 5.0 设备上进行测试。不过，由于是以定制形式实现配置，您保留了使用与发布相适的最低 API 级别和 ProGuard 代码压缩执行正常构建的能力。</p>
<p>您还可以构建其他变体，包括 <code>prodDebug</code> 变体构建，该变体虽然构建时间更长，但可用于开发以外的测试。在所示配置内，<code>prodRelease</code> 变体将是最终测试和发布版本。如需了解有关使用构建变体的详细信息，请参阅<a href="https://developer.android.com/studio/build/build-variants.html">配置构建变体</a>。</p>
<blockquote>
<p><strong>提示</strong>：由于您有适用于不同 Dalvik 可执行文件分包需求的不同构建变体，因此也可以为不同变体提供不同清单文件（这样，只有适用于 API 级别 20 和更低版本的清单文件会更改 <code>&lt;application&gt;</code> 标记名称），或者为每个变体创建不同的 <code>Application</code> 子类（这样，只有适用于 API 级别 20 和更低版本的清单文件会扩展 <a href="https://developer.android.com/reference/android/support/multidex/MultiDexApplication.html"><code>MultiDexApplication</code></a> 类或调用 <a href="https://developer.android.com/reference/android/support/multidex/MultiDex.html#install(android.content.Context)"><code>MultiDex.install(this)</code></a>）。</p>
</blockquote>
<h2 id="测试-Dalvik-可执行文件分包应用"><a href="#测试-Dalvik-可执行文件分包应用" class="headerlink" title="测试 Dalvik 可执行文件分包应用"></a>测试 Dalvik 可执行文件分包应用</h2><p>编写面向 Dalvik 可执行文件分包应用的仪器测试时，无需进行其他配置。<a href="https://developer.android.com/reference/android/support/test/runner/AndroidJUnitRunner.html"><code>AndroidJUnitRunner</code></a> 直接支持 Dalvik 可执行文件分包，前提是您使用 <a href="https://developer.android.com/reference/android/support/multidex/MultiDexApplication.html"><code>MultiDexApplication</code></a> 或替换您的自定义 <a href="https://developer.android.com/reference/android/app/Application.html"><code>Application</code></a> 对象中的 <a href="https://developer.android.com/reference/android/content/ContextWrapper.html#attachBaseContext(android.content.Context)"><code>attachBaseContext() 方法，并调用 </code></a> <a href="https://developer.android.com/reference/android/support/multidex/MultiDex.html#install(android.content.Context)"><code>MultiDex.install(this)</code></a> 以启用 Dalvik 可执行文件分包。<br>或者，您可以替换 AndroidJUnitRunner 中的 onCreate() 方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle arguments)</span> </span>&#123;</span><br><span class="line">    MultiDex.install(getTargetContext());</span><br><span class="line">    <span class="keyword">super</span>.onCreate(arguments);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注</strong>：目前不支持使用 Dalvik 可执行文件分包来创建测试 APK。</p>
</blockquote>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>旧时光</title>
    <url>/2021/01/18/old-time/</url>
    <content><![CDATA[<p>于2013年9月4日，用<strong>联想A360</strong>录制中央人民广播电台，「千里共良宵」节目</p>
<audio controls>
    <source src="old_time.ogg" type="audio/ogg"/>
    您的浏览器不支持 audio 标签。
</audio>

<p><strong>《心曲，散落于旧时光》</strong></p>
<p> 作者：一朵怜幽</p>
<p>[初夏，一米阳光]</p>
<p>初夏，日光倾城。</p>
<p>　　诗行里于樱花的咏叹未曾落定，被温透的诗情还未风干，街左右浅粉的花瓣已摇曳着曼妙的舞姿，纷纷落下。那身影，让人怜惜，其时花开，即时花败，终敌不过荏苒时光。春，让多少花儿为其献了身？</p>
<p>　　岸边的柳，依靠了哪夜皓月的肩，让绿盈满了天空，朦胧了脸庞？那些风景由近至远处妖娆，葱翠的绿浪蔓延成了远方的地平线。</p>
<p>　　束起短的发，游弋于这江南小城的拐角。让心成为一个跳动的音符，融在五月的隽永里翩翩而舞。光，有透明的暖意，亦多了一丝炙热，照在背上，洒了一地的影子。</p>
<p>　　初夏，是我们相识的时节，风声穿越记忆，一遍遍回忆，你是怎样把我从忧郁的冬眠中唤醒，理顺了二十多年的心结，翻走了那淡灰的日子。</p>
<p>　　用一支曲的时间，回眸相拥走过的日子，那次，为你写的文，你阅过，说感动得要哭，我竟不相信。你始终是个刚毅的男子，钟情经济学，怎会有感那儿女情长的唏嘘。</p>
<p>　　暮地害怕起来，我有多了解你，你又对我有多了解？</p>
<p>　　此一时，想裁一片天空，借它的蓝，放在此文中，澄澈你的心，亦让你明白我的情。却也只是空幻。</p>
<p>　　货船从眼前掠过，渐行渐远，皱了河的心思，日落的余晖伏在面上，泛着金黄的光。</p>
<p>　　这河，缓缓吞了热情的太阳，即将吐出幽幽的星月。</p>
<p>这光，能否借一抹，予我升腾，朝着你所在的方向，凝眸……</p>
<p>[幽思心曲]</p>
<p>　　盛夏，阳光都是纯白色。</p>
<p>　　在氤氲香气的清晨，遵循着花飞花落的旧路，穿过鹅卵石小道，踏过古色的木廊，漫步到第八座桥。</p>
<p>　　有轻柔的风从身旁拂过，翕动了我的睫毛。依着桥栏，独对清碧，那些水香弥漫，濛濛的一片，有朦胧的美丽。拈一朵素洁小花，在太阳抛出暧昧眼神的霎那，抛入在水中央，荡起的圈圈涟漪便拥有了花朵的独特清芬，漾着一抹欢愉与感激。</p>
<p>　　一叶小舟，不知泅渡了多少人由此岸到彼岸，此时，被废弃在一隅，盛满了无数碎末的叹息。那斑驳的容颜，都是光阴流逝的见证。</p>
<p>　　静静地，溢出绚彩如烟的往事，隐遁了，前世今生。临岸，一佝偻阿婆，气定神闲，推着轮椅上的阿翁，于木阁亭小歇，未闻交谈，仅那几个细微的动作与温情的眼神，亦羡煞许多人。</p>
<p>　　那日，见到一个有关爱与被爱的投票，于是投了爱一票，闺蜜问：被爱不是要幸福些么？我答：正因这样，才让我爱的人感受幸福。她反问：你不是说过，被爱，有时也会成为负担么？我，无言以对。</p>
<p>　　抑或，待到桑榆暮景时，方能悟出爱的真谛吧？</p>
<p>此一时，只静静而立，远离千葩百卉，开成一朵含苞的白色小花，一朵就好。等候下个女子的柔指，拈花而笑，之后，绽在她的耳畔……</p>
<p>[夏日呓语]</p>
<p>　　小城，暮色已临，如是地想着，夜，必定是斑斓的。</p>
<p>　　将心放在闲处，凭栏感受清风徐来，清浅的柔波里，剪影凄美，迷幻了眼睛。你说我宛如黛玉，独自莫凭栏，会沾染孤寂。怎奈独爱上这凭栏的心，寂寥的景，不可自制。</p>
<p>　　《琵琶语》，余音袅袅，融在空气里悬浮于空间，久久不肯落下。聆听此曲时，常幻想一雪衣女子：素手弄琵琶，信手低眉，续续弹，弹尽心中无限事。一声叹息，穿越千年寻觅，叹尽人间的哀怨与孤寂。</p>
<p>　　《琵琶语》源于《一个陌生女人的来信》，茨威格的直译本读过数次，泪亦流过数次。而后，一度认为那只是个梦，连卡门与爱丝美拉达亦都活在纸上，何况他们。</p>
<p>　　七月，祝福很多人：七月初始，顺安。可是，竟然忘了祝福自己，于是，一度被人误解，从来不是个善于言辞之人，不惯于解释。因为一直相信，解释不如沉默，一切自当水落石出。</p>
<p>　　自忖，你们不信我，但我，信时间，可是依旧希望你们都安好。误解冰释时，我愿一笑而过，之后，风轻云淡。</p>
<p>　　有人问我：“我若英年早殇，能否有你一滴清泪。”</p>
<p>　　他不知，我是怎样个爱落泪的女子，常常看着别人的故事，流自己的眼泪。仅你这一句话，已让我的眼中便蒙上异彩，已然成殇。那么，请你好好活着，不为他人，只为自己，只为我眼中的这滴泪，不要落下。</p>
<p>近来，旧疾复发，身心俱疲，不想再过问其他，唯想书写一笺丝缕分明且温润馨香的诗，纪念此一时。然，无芳姿纤笔，便不能落笔成花，只能静静地，任残章驮着白色的忧伤，让夕阳一点一点西沉，落在心上……</p>
<p>[采一瓣阳光，置在心房]</p>
<p>　　初冬，时光温然，阳光静沉。</p>
<p>　　午后的闲散时分，径自踱在疏影憧憬的青石巷内，有江南古韵的屋舍在小巷左右排列着延伸。尽头有一方莲塘，那些残荷映在日光下，水中的倒影凄美里亦是分外妖饶。无论哪一隅，都有江南水墨画的气息神韵。时常在静好的时光，静默的风景里，醉去，迟迟不能醒来。</p>
<p>　　葱郁墨绿的梧桐叶边缘被初冬的风点缀了些橙红，宛如羞红了脸的少女。那三两片已枯黄的乘着风蹁跹而下，落地轻吟。大片的阳光穿梭过梧桐叶，被切割成细细碎碎的光块，斑斓地洒在地上。我立在那里，如痴如醉地淋了一场阳光梧桐雨。</p>
<p>　　摊开掌心，让一瓣阳光停留，看她恬静的样子，感知她的温度。这阳光，有声有韵，有形有态，有馥有香。</p>
<p>　　这一瓣，从天际流淌下来，一路欢愉地低吟浅唱。穿过梧桐，到达我掌心时有有微微的破碎声，如柔匀的吐息。她轻声对我诉说，在红尘里与万物邂逅的美丽瞬间。</p>
<p>　　这一瓣，柔谐婉转地随着风变动成各异的形态，倾斜着，有不规则的美，如一个舞者随着音律不停地变换姿步。那一份绝韵，让人不觉对着她，凝眸，唯恐错过某个清丽而绰约的刹那。</p>
<p>　　这一瓣，有明媚的轻香浮溢，还聚敛着风尘的味道，不似花却也清清淡淡将你俘获。这香味，随着风声穿过记忆，变成来日灿烂缤纷的思恋印在往事里。</p>
<p>　　这一刻，所有的阳光，都属于今日的时光。清晨从潋滟的海面而来，黄昏从幽静的山谷隐褪。我用最虔诚的姿态恳求此时的光阴，可否将这一瓣赠予我。我会温柔地捧她在手心，迈着缓缓的步调，不至于颠簸到她，携领着回家，珍存于挚爱的水晶瓶中。</p>
<p>　　在云淡风轻的夜，携着她到幽静的露台，凭栏而望，望她从未见过的月色。一瓣日光与月光相遇，那该是怎样的景致呢？我定会被她们那炫美的邂逅感动，然后摘一朵花浸酒，庆贺这无双的一对。</p>
<p>　　或是将她悬挂在我清冷的案台，细致地描抹下她的颜容，她有娇柔的形态，暖暖的颜色。我们共赏一曲箫声、再赏一曲琵琶语。这些忧伤如泣的音乐常常让我柔软的心疼痛得无以复加。有她在身边，那些暖光定全浸润所有的忧伤，让疼痛也变得温柔而温暖。</p>
<p>　　或是让她住进我的文字里，游弋于字里行间，隐约我所有的愁绪。那篇文字定会饱满而深情，成为历来最能打动自我的一文。在后日，翻阅记忆，轻易便因为它忆起那一日的自己。</p>
<p>　　我还会征得她的应允，置放在你、我、他、所有需要温暖的人的心房。让她在心中，生根、发芽、再开出一朵又一朵温馨的永不凋零的阳光之花……</p>
<p><strong>《蓦然回首，那些旧时光已不在》</strong></p>
<p>文/迅雷</p>
<p>看到这四个字，让人很容易想到，暮然回首此人就在灯火阑珊处。但意境跟它不一样。</p>
<p>​    ——题记</p>
<p><strong>一、无泪</strong>　</p>
<p>刚出来时，总是很天真的认为只要努力，只要你用心的去做了，那就是好的。当第一次被生产线的老大骂的狗血淋头的时候，当被人家故意嫁祸的时候，当被冤枉百口莫辩的时候，当被别人认为是新来的就呼来唤去的时候，才发现这就是社会。这就是生活中极小极小的潜规则，这只是生活的一角。那时眼泪是天性，总是以眼泪来抗拒，总是认为委屈，以为哭泣是最好的宣泄，是解决的办法。</p>
<p>​    当人们用嫌恶和嘲笑来看待时，才发现泪水是那么的不值钱。眼泪是懦弱的表现，哭了才代表你输了。所以无泪的网名成了我的固定。以此来告诫自己不许哭，不能哭，要坚强。当要流泪时，就偷偷的躲起来，偷偷的哭，不能让别人看到自己的懦弱。总认为这样的自己很坚强，很厉害很了不起，当后来看到一句话，提醒自己坚强是弱者的表现。只有脆弱的人才会需要用坚强来提醒、麻痹自己。</p>
<p>​    现在的自己，奇怪的是依然爱哭，依然偷偷的哭，依然以为这样的自己最坚强。其实自己才知道，自己有多脆弱。</p>
<p>　　<strong>二、朋友</strong>　</p>
<p>　　熟话说，在家靠父母，出外靠朋友。这句话一句也不假，试问身在异乡的我们，哪个没有一两个知心朋友，哪个没被朋友帮助过？我爱回忆，突然回忆起我生命中那些可爱的朋友。　</p>
<p>　　王飞艳：她是第一个主动关心我的人，她是我的第一个知心朋友，可以说心里话，不必担心被人告密，不必担心会添油加醋的去陷害你。她是我第一个去放开心去交的朋友。同样爱唱歌的我们，曾傻傻的在马路上大声的歌唱过，不在乎别人异样的眼光。曾一起诉说过自己那些不开心的童年时光，一起动情的哭过，一起谈这个社会，一起谈我们的梦想，一起努力去实现梦想。曾经说下豪言说要让中国的每寸土地都留下我们的脚印。曾一起找工作被PK过，曾一起在大马路上被打劫过……那些曾经的曾经我们一起面对过。现在，我变了，不再是那个说道就能做到的我了，她生病了没去看，她要我帮的忙我一件也没帮上，不是不愿意，是无可奈何。现在再也没有人可以陪我一起唱歌了，再也没有人跟我和了。再也没有人被我一个笑话笑得眼泪都掉出来了。再也没有人鼓励我为自己的梦想去奋斗了。因为我们离得远了。不知是距离，心的距离也远了。　　</p>
<p>　　邵宁霞：她是第一个教会我如何打扮的人，她是第一个给我画眼影用睫毛膏的人。她是第一个告诉我不要轻易的去相信一个人，第一个告诉我这个世界有多可怕多肮脏。第一个教会我做人做事都要留个心眼，可惜现在仞没学会。她是第一个在我偷偷哭泣躲起来时，打电话大声的骂我是笨蛋，问我有没有把她当朋友的人。她是在我生病时苦等我几小时的人，我却没有珍惜。现在，依然记得我们在莲湖打打闹闹的情景，依然记得我生日时一起唱歌的情景，依然记得你最爱听的是那首《白狐》、你喜欢那忧伤的格调。依然记得你最爱跳舞，依然记得我们最爱吃的伊利奶片，可惜现在涨价啊。　　</p>
<p>　　真真：负债后我的第一个朋友。第一个听我唧唧呱呱不停讲家里事的人。第一个即使不会唱歌，只要我说去唱歌，就一定会陪我去的人。第一个在大年30晚上一起想家一起去网吧通宵的人。第一个送我衣服的人。还好，现在的你依然还在，我不知道几年之后，我们又会是什么样子，在现有这一刻，我只知道我该珍惜，生活中会有许多的朋友，但社会，或者说是生存环境给它的定义又是不同的，握个手，我们也是朋友了，但可信度有有几成呢，我们得去考虑。但我知道，我们是真心的朋友。　　</p>
<p>　　郝有晴：第一个我想去帮助的人，在她身上，看到刚出来时的自己。她是第一个让我感觉原来真诚的微笑也可以这样的美丽自然，第一个傻乎乎的问我许多问题的人，第一个你给她一点好处，她就会感恩戴德的人，第一个在2010年大年30因想家抱着我大声痛哭的人。一有事就会找我诉说的人。第一个让我觉得做人，我有愧的人。单纯干净得让你羞愧。第一个让我觉得，即使没有出众的外貌，我们依然可以活得快乐的人。她让我知道微笑其实可以很简单。　</p>
<p>　　这些曾经的现在的朋友，或许以前我们有过争吵，或许我们已不再联系，或许我们已不再亲近，但是偶尔闲暇时，就请回忆我们的旧时光，你会发现，那些曾经的美好让你释然，那些一起感动一起哭过、笑过、累过、痛过、闹过、打过、骂过、也怨过的日子，也是我们美好的回忆，因为生命只有一次，有些人，或许你这一辈子都不会再相见，开心的不开心的，你们相处的时间就会定格在你们最后见面的那一秒，说过的话也一样。所以有时话不可太重，相处的机会很轻也很短。我们该珍惜。</p>
<p>　　暮然回首，我们的那些旧时光已不在，我想你们了。</p>
<p><strong>《指尖流逝的美好旧时光呵》</strong></p>
<p>文/墨黑、纸白</p>
<p>双手握在眼前，朦胧与现实的距离，悄悄地在心中，虔诚地祷告，向指缝、指尖流逝的美好旧时光，说一声，因为虚度而抱歉。</p>
<p>——题记</p>
<p>指尖流逝的美好旧时光呵，你是那样的柔细，比风沙还细软的身躯，用你的温柔，抚摸着我日渐变长的黑发，划过我日益成熟的脸庞，亲吻我因成长而流落的泪珠，那份爱意，浓浓的让人迷失了自我。</p>
<p>【一】 指尖流逝的美好旧时光，我错过了你多少次的提醒？　　</p>
<p>几度春风拂面，几经花开花落，几何冰封融化，渐行渐远的时光，若隐若现的美好，它不经意间，出现在我不用看便可以敲打出文字的键盘，也让我想起初次用这键盘时的生涩。它悄然之间，出现在我那几本不算新妆的书本之上，落了厚厚的灰尘讲述着不为人知的偷偷阅览。它默然回首，降临在我那本厚厚的同学录上，泛黄了的笔记，远去的照片中的微笑，又在追忆着那些年前的美好。它随夜潜入梦，赶走了胡思乱想，却带来了一个个的曾经画面，还有那年那个惘然的少年，看着前方的问号继续惘然着。它随着双手插在衣袋中，包裹着的不单纯再是双手，还是父母的关怀与责备，还是几位老师的教导与鼓励，还是无数朋友们的支持与呐喊，还是更多的忠言逆耳的言论……</p>
<p>不敢回忆，而今已是弱冠之年，没有多少细软在手，没有多少资本细数，没有多少学识于胸，有的只是一片充满希望的梦想，此刻人生若泥，只有梦想主义的灌溉，永远无法让人生刻画成精美的瓷器，只能在一地叹息之中，沦落了这一场青春永无休止的争论。</p>
<p>坐在空无一人的教室，虽然还有一年多的时光在等待着消磨或是奋斗，但是那些渐行渐远的光阴，还是让人无限的后怕。他们都说：最是一年好时光。朱自清先生也说：一年之计在于春。而今年的初春、晚雪又在讲述着多少变故？一直在安排着自己的时光，希望可以更好的，更合理的将人生安排，最终却发现自己一直被人生安排着，无法战胜自己的安排，只能是一种妄想，而非一种踏踏实实的实践。</p>
<p>闹钟每天都在嘈闹地提醒着人们，一天的时光到来了，而睡意却一直在拖着人们的身体，在讲述着睡眠的美妙，到最后也闹不清楚到底是闹钟失败在睡意的强大之中，还是睡意败在了闹钟嘹亮的呐喊之中。只知道，每天温习着昨天的日子，而时光便在此刻指尖纤细中，继续着它的流逝，一去不再复返。</p>
<p>春天，唤醒了多少人的迷惘。春天，讲述了多少人的起步。春天，释放了多少人的压抑。数不清楚，也不应该去数，因为我们还有事情要做，那便是如何让自己对得起这一场充满希望的春之中，不失这场希望的施舍，不辜负这场春的恩泽！</p>
<p>【二】 指缝逝去的美好旧时光，我擦肩了你多少次的际遇？　</p>
<p>暖暖的风，扑面而来。炙燥的天，夏蝉鸣叫。热的马路，柳絮纷飞。悄悄溜走的时光，似有若无的美好，它忽而幻化为红色的蜻蜓，缓缓地朝我飞来，又瞬间转折方向而去，让我不断回忆着，也不断忘却着。它忽而转换成树叶上的露珠，露珠爬在树叶之上，又悄然间消失于太阳的初光之中，转换的不是被蒸发了的身体，而是瞬间即逝的光阴。它又像天空之云，像是谁都可以捏成的形状，忽而龙状，忽然虫状，捏成的不是变化的躯体，而是明白却不懂珍惜的时光。还有那瀑布，还有那流水，还有那屋檐下的燕子，还有那不曾被发现的毛毛虫……</p>
<p>不敢思索，现在再回头看那片段，总觉得自己在断桥处，凭栏独望的不是美丽的风景，而是繁华被没落而代替。此时人生若浮云，只有现实主义的厚重，永远无法让这片充满力量的云飞翔于空中，成为天之骄子，只能在声声无奈之中，落幕了这一场年少的懊悔。</p>
<p>置身于山水之间，聆听涧边的瀑布，臭着夏天的凉爽，偶有梵呗入耳，又闻松下琴声，耳畔此刻如此丰富。流水，沟浍，还有那片片的翠绿，倒影在脑海中的是该如何拥抱这些美景。其实用现实去拥抱这些美景，倒不如用自己的眼帘去记住这点点滴滴，永远封存在记忆之中，现实永远不可能随你的任性而选择改变，那么就天马行空的随现实的改变而改变吧，人生的哲学不过如此，即使再清高，总得继续着人情世故吧？</p>
<p>夏蝉总会在我打盹的那刻，此起彼伏。当然也没有能力去分辨，是睡虫肆虐了夏蝉的嘈杂？还是夏蝉打跑了爱寻事非的睡虫。依稀记得，手缝这点空隙，还不足以留住时光的流逝，越想去捧住时光的脚丫子，她也是逝去的更快。</p>
<p>夏天，用燥热批判了多少人的懒惰？夏天，用蝉鸣喊乱了多少人的忏悔？夏天，用暖风柳絮惊觉了多少人的美梦？没有去细数这些细节，因为我们还有我们要做的事情，只有去做了，才对得起这场夏雨般的赦书，它赦免的不是你的忏悔，而是你勇往直上的心！</p>
<p>【三】 被秋风吹落的美好旧时光，我该怎样去接才不会摔伤你？　　</p>
<p>秋风萧瑟，卷席了一切努力后的成果。秋意盎然，带回了多少诗意的画卷。秋雨紧慢，模糊了多少人的记忆。我就坐在，那个早已被红木代替的老藤椅上，看不到古城旧砖，看不到四合杂院，也体会不到那场皮影戏，手捏泥人的欢乐。它们像院子里厚厚的落叶一般，安静的躺在我的脚下。还有那薄如蝉翼的时光，它更像正在被风摇晃着，摇摇欲坠的剩叶，我就坐在它的下面，用不灵便的双手，放在它也许会掉落的位置上，静静地看着，不知道何时，它会悄然的掉落，而我能不能用自己的小心翼翼去接住它，怕它被风的那股劲，还有地上的凉，摔坏了，就像怕一个孩子跌倒一般的心疼，其实我明白，孩子既然要学习走路，必然要跌倒，而我们既然要经历人生，那么就注定了凋落，我唯一不甘的是，怕这场人生平平淡淡，毫无意义的过去，那该是多么悲凉的结局？</p>
<p>秋叶讲述着它曾经的红，还述说着它曾经染红过的故事。破浪拍打着它曾经的花，还形容这它曾经托起过的豪艇。秋雨洗礼着它的世界，也轻轻地叹道，曾经随风而落的冲劲。屋檐下的滴答声，正是它最爱听的声音，而今可能再也听不到了，因为它也在时光的交换中，幻化为冰冷的雪。<br>　　秋树看着自己周遭的凄惨，看着自己突兀的树枝，不禁黯然泪下，轻声道：已经这个样子了，我还能看到下一个春的样子吗？秋风摇摆着秋树不再伟岸的身影，安慰道：每个时期必然有每个时期的兴盛，相对而言，每个时期亦必然有没有时期的败落，懂得珍惜，不愧对曾经的拥有即可，叹息不是你该做的事，你要做的就是聚集力量，待到来年花开时，也是你朝气蓬勃时。秋树挺直了腰板，仿佛刚刚什么都没发生一样。</p>
<p>摔伤了旧的美好时光，便真的无法再言拥有了。那么就在你明白的时候，好好去疼爱这段美好的旧的时光，这样便会让自己内疚的心，轻轻地哼唱着流金岁月。秋雨若挽歌，此话果真不假，当到了秋的季节，人们成熟也便随之而来了，当懂得了很多，便会明白，秋雨呢喃地挽歌，在轻轻地对你诉说着，成长方能自由！</p>
<p>【四】 被冬雪覆盖的美好旧时光，我该怎样觅寻你当初的翠绿？　　</p>
<p>漫漫冬夜，似霜月光，凌乱枯叶，不经意间与雪合而为一。冬天，听雪拍落的声音，无疑是一种从心底里悦耳动听。那么在雪中望月，更该是一种莫名的悸动吧，所谓新月恨其易沉，缺月恨其迟上，那此时的雪，又会怎样看到这轮明月，面对不同的自己，所感叹不同的言辞呢？</p>
<p>或而有友相伴，雪月下说剑，畅谈远去历史中的荆轲，赵云，肝胆相照的岂止忠义？更有情谊！雪月下论诗，遥想当年大小李杜之交好，李白，杜甫，李商隐，杜牧，风致幽雅的岂止诗歌？更有我中华之文化博大精深。只是这段美好的旧时光呵，你太快的便离去了，谁还会坐在月下说剑论诗？都被这嘈杂的世界，引领上了所谓的市场经济，为吃口饭，不得不忙忙碌碌，即使不愁衣食，那些人还要惦记着娱乐万千哩。</p>
<p>想给远去的美好旧时光写封信，开头未知，结尾惘然，最终在一封苍白的信纸上，毫无点墨，只好将白的信纸装进信封，没有了字里行间，没有了万千愁绪，没有了缠缠绵绵，有的便是内心深处对没有珍惜的逝去道声珍重，也提醒自己及诸君能够缅怀逝去，珍惜现在。</p>
<p>在小小的两人世界中，我看到了分秒的珍惜，当然我无意讽刺所谓的爱情带来的珍惜时光效应。我真的是在他们洋溢着幸福的脸庞上，看到了他们对彼此深深地依恋及珍惜，舍不得一分一秒离开彼此的脸颊，舍不得眨眼，怕逝去了便不再复返。他们漫步在小亭中，游走在浮桥上，爬过了山坡，飞跃了云海，我在想还会有谁像他们一样如此珍惜美好的旧的时光的逝去吗？答案：未知。</p>
<p>我试图在想，猜，也许与小孩子猜一元硬币这种兴趣应该略同，一切缘起美好的旧时光，在这场旧时光中寻找乐趣所在，这便是我们逝去的，也是我们想要永远拥有的吧！雪又开始了游历，而我们的人生也走在下一个春的路上，路途不远，只是能不能让自己好好地珍惜，这段逝去的美好的旧时光？</p>
<p>东风之中，斟酌小酒，酣畅淋漓，浑不觉冷，东风便若姜芥一般，辛辣了你的神经，也让你从刺骨之中醒来，来尝尝这杯小酒，也许你会精神百倍！</p>
<p>【尾声】　　</p>
<p>谁也无法追回从指缝、指尖溜走的美好旧的时光，那么就请从这段逝去中，学会拥有，拥有现在的美好的时光，如此便是最好的道歉，否则在道歉中忏悔，那样依然会让现在的美好时光，转化了昨日的美好旧时光。</p>
<p>　　朋友们，我们的时光真的不多，我们不能用任性去挽留她，那么就让自己用珍惜去感动她，她会在你的岁月变迁中，在变白你的双鬓，轻轻地对你说一声：你曾经来过，你的人生曾经充满了意义，这便足够了！</p>
<p><strong>《陌上花开，聆听那一曲旧时光的伤》</strong></p>
<p>文/锦瑟柠檬</p>
<p>  流年的风景划过眼前，陌上的花儿已开，陌上人却早已不在。只能躲在角落聆听一首旧时光里的伤。</p>
<p>——题记</p>
<p>【一】</p>
<p>我一直以为，既是被上苍安排到了尘世，生而为人，就免不了在人间应景。这世上应景的，又何止是人，凡尘万物皆如此。草木山石、飞禽虫蚁，都有其无法推卸的使命。它们的到来，也许有前世今生之约，为了某个人，为了某种生物。我相信，每一段缘分，每一个故事，都意义非凡，耐人寻味。</p>
<p>时常生出一种预感，今生，定然有那么一座深深庭院，属于我。院子里长满了植物，有一池莲，有梅骨雕刻的桌案，摆放一张琴。院内无生人，爬满青藤的木门终年落锁。世间风尘就这样被关在院外，无惊无扰。而我甘愿，和流光执手，缓慢老去，不言沧桑。</p>
<p>也许每个人，都没有属于自己的归宿。每个人，都是浮云一朵。明明有过交集，转身又成了陌路。我想，我是船，静静地漂浮在时间的河上。人海茫茫，也曾为了一段萍水相逢，迷失过最初的方向。隔岸灯火已阑珊，而我打捞着一轮水中的月亮，止不住内心无尽的荒凉。在时间的河上，已然忘记那些落花无言的过往。当年的承诺，是我对青春撒下的谎。走过千回百转的岁月，不要问我，是否饮尽了尘世的风霜。走过百转千回的山水，如果你真的慈悲，那么就别再去打听，谁失踪了，谁又去了哪里？</p>
<p>一时无句，心中留白。或许每个人的内心，都有几处不为人知的暗伤，只能等待时光去将之复原。</p>
<p>【二】</p>
<p>时光如水，物转星移，许多人事都以分道扬镳，不明下落。而缘分是一条神奇的河流，我们划着桨橹漂浮在其中，朝着各自的方向驶去。在没有约定的未来，却终有一天会不期而遇。就像花开是有情，花落是无意。来者是缘起，去者是缘灭。三千世界，每一天都会有擦肩，每一天都会有重逢。就像一段前朝往事，一出经年的戏曲，一本古老的书，被五味杂陈的烟火浸染，被悲欢冷暖的世情冲洗，繁芜中，依然有种地老天荒的安宁。</p>
<p>有人说，许多的风景，总是在对岸。如果相逢总在山水外，莫如，在人间四月安然地等待。看一纸诗书，如何将世间聚散的缘分，重新安排。给我一段老时光，独坐在绿苔滋长的木窗下，泡一壶闲茶。不去管，那南飞燕子，何日才可以返家。不去问，那一叶小舟，又会放逐到哪里的天涯。不去想，那些走过的岁月，到底多少是真，多少是假。</p>
<p>古人云：“人到无求品自高。”无求即是无欲，人若能无欲，品格自然高尚，而苦恼也会消散。但能够做到无欲无求的人，又岂是等闲之辈。在风尘弥漫的人世间修炼，有人痴迷惊艳华丽的风景，有人独恋似曾相识的旧物。辽阔似海的人心啊，该用什么来填满，平凡的物质或是精神，真的足够吗？</p>
<p>在那条叫做轮回的老巷里，多少人，在那里曾寻找散落的过往。其实，故事早已改写了当初的模样，可流年，为什么还要这样叫人神伤。一定有些什么，被我不小心遗忘。否则，转角处的灯火，不会那样的荒凉。否则，昨天留下的，不会只是淡淡迷惘。如果支付了一生的时光，那么，是否就可以拥有，我想要的地久天长？</p>
<p>世上总有许多执迷不悟的人，为了一溪云、一帘梦、一出戏，交换心性，倾注深情。而痴情本身就是一个寂寞的旅程，倘若无法承担其间的清冷与凉薄，莫如不要开始。其实有时候，做一个有情有义的人，会比一个寡淡漠然的人更疲累。</p>
<p>多想擦去昨天的记忆，漫步在红尘的烟火里。多想流光飞作雪，世味煮成茶。想来谁都愿意做一个闲散的人，日子纯净简单，生活并无别事。有大把时光，用来虚度，而不去担心流年似水，转瞬白头。只是这世上，有多少人可以清醒自持，敢于承担光阴所带来的消耗，敢于接受命运所带来的仓促变幻。</p>
<p>曾经那样仓促地背上行囊，想用年华，换取一段如水的过往。走过红尘陌上，品过浮世清欢，才知道，人生不过戏梦一场。假如爱过的人，可以遗忘；犯下的错，值得原谅。就许我，用剩余的时光，重新和这里的一草一木、一瓦一檐，诉说衷肠。</p>
<p>即使没有世事洞明的宽厚与气度，却有着落尽尘埃的简净与从容。岁月河山瞬息万变，就算有未卜先知的能力，结局也难免有所偏失。回首前尘，聚散离合，不过镜花水月一场。守着当下，不去寻找曾经预约的风景，不再许下迟早要违背的诺言。愿与草木，随遇而安。</p>
<p>如果可以，我只想做一株遗世的梅花，守着寂寞的年华，在老去的渡口，静看日落烟霞。</p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>audio</tag>
      </tags>
  </entry>
  <entry>
    <title>C语言</title>
    <url>/2021/05/26/c-language/</url>
    <content><![CDATA[<h3 id="一步编译"><a href="#一步编译" class="headerlink" title="一步编译"></a>一步编译</h3><p><code>gcc -o hello.exe hello1.c hello2.c</code></p>
<h3 id="分步编译"><a href="#分步编译" class="headerlink" title="分步编译"></a>分步编译</h3><ol>
<li>预处理：<code>gcc -E hello.c -o hello.i</code></li>
</ol>
<ul>
<li>展开宏定义</li>
<li>展开头文件</li>
<li>条件编译</li>
<li>删除注释</li>
</ul>
<ol start="2">
<li>编译：<code>gcc -S hello.i -o hello.s</code></li>
</ol>
<ul>
<li>检查语法</li>
<li>将C语言转成汇编语言</li>
</ul>
<ol start="3">
<li>汇编：<code>gcc -c hello.s -o hello.o</code></li>
</ol>
<ul>
<li>将汇编语言转成机器语言</li>
</ul>
<ol start="4">
<li>链接：<code>gcc hello.o -o hello.exe</code></li>
</ol>
<ul>
<li>将C语言的库文件链接到可执行程序中</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-E</td>
<td>只进行预处理</td>
</tr>
<tr>
<td>-S</td>
<td>只进行预处理和编译</td>
</tr>
<tr>
<td>-c</td>
<td>只进行预处理、编译和汇编</td>
</tr>
<tr>
<td>-o file</td>
<td>指定生成的文件名为file</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>文件后缀</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>.c</td>
<td>C语言文件</td>
</tr>
<tr>
<td>.i</td>
<td>预处理后的C语言文件</td>
</tr>
<tr>
<td>.s</td>
<td>编译后的汇编文件</td>
</tr>
<tr>
<td>.o</td>
<td>编译后的目标文件</td>
</tr>
</tbody></table>
<h3 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h3><table>
<thead>
<tr>
<th>转义字符</th>
<th>意义</th>
<th>ASCII码值（十进制）</th>
</tr>
</thead>
<tbody><tr>
<td>\a</td>
<td>响铃(BEL)</td>
<td>007</td>
</tr>
<tr>
<td>\b</td>
<td>退格(BS) ，将当前位置移到前一列</td>
<td>008</td>
</tr>
<tr>
<td>\f</td>
<td>换页(FF)，将当前位置移到下页开头</td>
<td>012</td>
</tr>
<tr>
<td>\n</td>
<td>换行(LF) ，将当前位置移到下一行开头</td>
<td>010</td>
</tr>
<tr>
<td>\r</td>
<td>回车(CR) ，将当前位置移到本行开头</td>
<td>013</td>
</tr>
<tr>
<td>\t</td>
<td>水平制表(HT) （跳到下一个TAB位置）</td>
<td>009</td>
</tr>
<tr>
<td>\v</td>
<td>垂直制表(VT)</td>
<td>011</td>
</tr>
<tr>
<td>\</td>
<td>代表一个反斜线字符’’&#39;</td>
<td>092</td>
</tr>
<tr>
<td>&#39;</td>
<td>代表一个单引号（撇号）字符</td>
<td>039</td>
</tr>
<tr>
<td>&quot;</td>
<td>代表一个双引号字符</td>
<td>034</td>
</tr>
<tr>
<td>?</td>
<td>代表一个问号</td>
<td>063</td>
</tr>
<tr>
<td>\0</td>
<td>空字符(NUL)</td>
<td>000</td>
</tr>
<tr>
<td>\ddd</td>
<td>1到3位八进制数所代表的任意字符</td>
<td>三位八进制</td>
</tr>
<tr>
<td>\xhh</td>
<td>十六进制所代表的任意字符</td>
<td>十六进制</td>
</tr>
</tbody></table>
<h3 id="ASCII打印字符对照表"><a href="#ASCII打印字符对照表" class="headerlink" title="ASCII打印字符对照表"></a>ASCII打印字符对照表</h3><table>
<thead>
<tr>
<th align="left">DEC</th>
<th align="left">OCT</th>
<th align="left">HEX</th>
<th align="left">BIN</th>
<th align="left">缩写/符号</th>
<th align="left">HTML实体</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">000</td>
<td align="left">00</td>
<td align="left">00000000</td>
<td align="left">NUL</td>
<td align="left">&#000;</td>
<td align="left">Null char (空字符)</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">001</td>
<td align="left">01</td>
<td align="left">00000001</td>
<td align="left">SOH</td>
<td align="left">&#001;</td>
<td align="left">Start of Heading (标题开始)</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">002</td>
<td align="left">02</td>
<td align="left">00000010</td>
<td align="left">STX</td>
<td align="left">&#002;</td>
<td align="left">Start of Text (正文开始)</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">003</td>
<td align="left">03</td>
<td align="left">00000011</td>
<td align="left">ETX</td>
<td align="left">&#003;</td>
<td align="left">End of Text (正文结束)</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">004</td>
<td align="left">04</td>
<td align="left">00000100</td>
<td align="left">EOT</td>
<td align="left">&#004;</td>
<td align="left">End of Transmission (传输结束)</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">005</td>
<td align="left">05</td>
<td align="left">00000101</td>
<td align="left">ENQ</td>
<td align="left">&#005;</td>
<td align="left">Enquiry (请求)</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">006</td>
<td align="left">06</td>
<td align="left">00000110</td>
<td align="left">ACK</td>
<td align="left">&#006;</td>
<td align="left">Acknowledgment (收到通知)</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">007</td>
<td align="left">07</td>
<td align="left">00000111</td>
<td align="left">BEL</td>
<td align="left">&#007;</td>
<td align="left">Bell (响铃)</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">010</td>
<td align="left">08</td>
<td align="left">00001000</td>
<td align="left">BS</td>
<td align="left">&#008;</td>
<td align="left">Back Space (退格)</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">011</td>
<td align="left">09</td>
<td align="left">00001001</td>
<td align="left">HT</td>
<td align="left">&#009;</td>
<td align="left">Horizontal Tab (水平制表符)</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">012</td>
<td align="left">0A</td>
<td align="left">00001010</td>
<td align="left">LF</td>
<td align="left">&#010;</td>
<td align="left">Line Feed (换行键)</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">013</td>
<td align="left">0B</td>
<td align="left">00001011</td>
<td align="left">VT</td>
<td align="left">&#011;</td>
<td align="left">Vertical Tab (垂直制表符)</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left">014</td>
<td align="left">0C</td>
<td align="left">00001100</td>
<td align="left">FF</td>
<td align="left">&#012;</td>
<td align="left">Form Feed (换页键)</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left">015</td>
<td align="left">0D</td>
<td align="left">00001101</td>
<td align="left">CR</td>
<td align="left">&#013;</td>
<td align="left">Carriage Return (回车键)</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">016</td>
<td align="left">0E</td>
<td align="left">00001110</td>
<td align="left">SO</td>
<td align="left">&#014;</td>
<td align="left">Shift Out / X-On (不用切换)</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">017</td>
<td align="left">0F</td>
<td align="left">00001111</td>
<td align="left">SI</td>
<td align="left">&#015;</td>
<td align="left">Shift In / X-Off (启用切换)</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left">020</td>
<td align="left">10</td>
<td align="left">00010000</td>
<td align="left">DLE</td>
<td align="left">&#016;</td>
<td align="left">Data Line Escape (数据链路转义)</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left">021</td>
<td align="left">11</td>
<td align="left">00010001</td>
<td align="left">DC1</td>
<td align="left">&#017;</td>
<td align="left">Device Control 1 (设备控制1)</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left">022</td>
<td align="left">12</td>
<td align="left">00010010</td>
<td align="left">DC2</td>
<td align="left">&#018;</td>
<td align="left">Device Control 2 (设备控制2)</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left">023</td>
<td align="left">13</td>
<td align="left">00010011</td>
<td align="left">DC3</td>
<td align="left">&#019;</td>
<td align="left">Device Control 3 (设备控制3)</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left">024</td>
<td align="left">14</td>
<td align="left">00010100</td>
<td align="left">DC4</td>
<td align="left">&#020;</td>
<td align="left">Device Control 4 (设备控制4)</td>
</tr>
<tr>
<td align="left">21</td>
<td align="left">025</td>
<td align="left">15</td>
<td align="left">00010101</td>
<td align="left">NAK</td>
<td align="left">&#021;</td>
<td align="left">Negative Acknowledgement (拒绝接收)</td>
</tr>
<tr>
<td align="left">22</td>
<td align="left">026</td>
<td align="left">16</td>
<td align="left">00010110</td>
<td align="left">SYN</td>
<td align="left">&#022;</td>
<td align="left">Synchronous Idle (同步空闲)</td>
</tr>
<tr>
<td align="left">23</td>
<td align="left">027</td>
<td align="left">17</td>
<td align="left">00010111</td>
<td align="left">ETB</td>
<td align="left">&#023;</td>
<td align="left">End of Transmit Block (传输块结束)</td>
</tr>
<tr>
<td align="left">24</td>
<td align="left">030</td>
<td align="left">18</td>
<td align="left">00011000</td>
<td align="left">CAN</td>
<td align="left">&#024;</td>
<td align="left">Cancel (取消)</td>
</tr>
<tr>
<td align="left">25</td>
<td align="left">031</td>
<td align="left">19</td>
<td align="left">00011001</td>
<td align="left">EM</td>
<td align="left">&#025;</td>
<td align="left">End of Medium (介质中断)</td>
</tr>
<tr>
<td align="left">26</td>
<td align="left">032</td>
<td align="left">1A</td>
<td align="left">00011010</td>
<td align="left">SUB</td>
<td align="left">&#026;</td>
<td align="left">Substitute (替补)</td>
</tr>
<tr>
<td align="left">27</td>
<td align="left">033</td>
<td align="left">1B</td>
<td align="left">00011011</td>
<td align="left">ESC</td>
<td align="left">&#027;</td>
<td align="left">Escape (溢出)</td>
</tr>
<tr>
<td align="left">28</td>
<td align="left">034</td>
<td align="left">1C</td>
<td align="left">00011100</td>
<td align="left">FS</td>
<td align="left">&#028;</td>
<td align="left">File Separator (文件分割符)</td>
</tr>
<tr>
<td align="left">29</td>
<td align="left">035</td>
<td align="left">1D</td>
<td align="left">00011101</td>
<td align="left">GS</td>
<td align="left">&#029;</td>
<td align="left">Group Separator (分组符)</td>
</tr>
<tr>
<td align="left">30</td>
<td align="left">036</td>
<td align="left">1E</td>
<td align="left">00011110</td>
<td align="left">RS</td>
<td align="left">&#030;</td>
<td align="left">Record Separator (记录分离符)</td>
</tr>
<tr>
<td align="left">31</td>
<td align="left">037</td>
<td align="left">1F</td>
<td align="left">00011111</td>
<td align="left">US</td>
<td align="left">&#031;</td>
<td align="left">Unit Separator (单元分隔符)</td>
</tr>
<tr>
<td align="left">32</td>
<td align="left">040</td>
<td align="left">20</td>
<td align="left">00100000</td>
<td align="left"></td>
<td align="left">&#32;</td>
<td align="left">Space (空格)</td>
</tr>
<tr>
<td align="left">33</td>
<td align="left">041</td>
<td align="left">21</td>
<td align="left">00100001</td>
<td align="left">!</td>
<td align="left">&#33;</td>
<td align="left">Exclamation mark</td>
</tr>
<tr>
<td align="left">34</td>
<td align="left">042</td>
<td align="left">22</td>
<td align="left">00100010</td>
<td align="left">“</td>
<td align="left">&#34;</td>
<td align="left">Double quotes</td>
</tr>
<tr>
<td align="left">35</td>
<td align="left">043</td>
<td align="left">23</td>
<td align="left">00100011</td>
<td align="left">#</td>
<td align="left">&#35;</td>
<td align="left">Number</td>
</tr>
<tr>
<td align="left">36</td>
<td align="left">044</td>
<td align="left">24</td>
<td align="left">00100100</td>
<td align="left">$</td>
<td align="left">&#36;</td>
<td align="left">Dollar</td>
</tr>
<tr>
<td align="left">37</td>
<td align="left">045</td>
<td align="left">25</td>
<td align="left">00100101</td>
<td align="left">%</td>
<td align="left">&#37;</td>
<td align="left">Procenttecken</td>
</tr>
<tr>
<td align="left">38</td>
<td align="left">046</td>
<td align="left">26</td>
<td align="left">00100110</td>
<td align="left">&amp;</td>
<td align="left">&#38;</td>
<td align="left">Ampersand</td>
</tr>
<tr>
<td align="left">39</td>
<td align="left">047</td>
<td align="left">27</td>
<td align="left">00100111</td>
<td align="left">‘</td>
<td align="left">&#39;</td>
<td align="left">Single quote</td>
</tr>
<tr>
<td align="left">40</td>
<td align="left">050</td>
<td align="left">28</td>
<td align="left">00101000</td>
<td align="left">(</td>
<td align="left">&#40;</td>
<td align="left">Open parenthesis</td>
</tr>
<tr>
<td align="left">41</td>
<td align="left">051</td>
<td align="left">29</td>
<td align="left">00101001</td>
<td align="left">)</td>
<td align="left">&#41;</td>
<td align="left">Close parenthesis</td>
</tr>
<tr>
<td align="left">42</td>
<td align="left">052</td>
<td align="left">2A</td>
<td align="left">00101010</td>
<td align="left">*</td>
<td align="left">&#42;</td>
<td align="left">Asterisk</td>
</tr>
<tr>
<td align="left">43</td>
<td align="left">053</td>
<td align="left">2B</td>
<td align="left">00101011</td>
<td align="left">+</td>
<td align="left">&#43;</td>
<td align="left">Plus</td>
</tr>
<tr>
<td align="left">44</td>
<td align="left">054</td>
<td align="left">2C</td>
<td align="left">00101100</td>
<td align="left">,</td>
<td align="left">&#44;</td>
<td align="left">Comma</td>
</tr>
<tr>
<td align="left">45</td>
<td align="left">055</td>
<td align="left">2D</td>
<td align="left">00101101</td>
<td align="left">-</td>
<td align="left">&#45;</td>
<td align="left">Hyphen</td>
</tr>
<tr>
<td align="left">46</td>
<td align="left">056</td>
<td align="left">2E</td>
<td align="left">00101110</td>
<td align="left">.</td>
<td align="left">&#46;</td>
<td align="left">Period, dot or full stop</td>
</tr>
<tr>
<td align="left">47</td>
<td align="left">057</td>
<td align="left">2F</td>
<td align="left">00101111</td>
<td align="left">/</td>
<td align="left">&#47;</td>
<td align="left">Slash or divide</td>
</tr>
<tr>
<td align="left">48</td>
<td align="left">060</td>
<td align="left">30</td>
<td align="left">00110000</td>
<td align="left">0</td>
<td align="left">&#48;</td>
<td align="left">Zero</td>
</tr>
<tr>
<td align="left">49</td>
<td align="left">061</td>
<td align="left">31</td>
<td align="left">00110001</td>
<td align="left">1</td>
<td align="left">&#49;</td>
<td align="left">One</td>
</tr>
<tr>
<td align="left">50</td>
<td align="left">062</td>
<td align="left">32</td>
<td align="left">00110010</td>
<td align="left">2</td>
<td align="left">&#50;</td>
<td align="left">Two</td>
</tr>
<tr>
<td align="left">51</td>
<td align="left">063</td>
<td align="left">33</td>
<td align="left">00110011</td>
<td align="left">3</td>
<td align="left">&#51;</td>
<td align="left">Three</td>
</tr>
<tr>
<td align="left">52</td>
<td align="left">064</td>
<td align="left">34</td>
<td align="left">00110100</td>
<td align="left">4</td>
<td align="left">&#52;</td>
<td align="left">Four</td>
</tr>
<tr>
<td align="left">53</td>
<td align="left">065</td>
<td align="left">35</td>
<td align="left">00110101</td>
<td align="left">5</td>
<td align="left">&#53;</td>
<td align="left">Five</td>
</tr>
<tr>
<td align="left">54</td>
<td align="left">066</td>
<td align="left">36</td>
<td align="left">00110110</td>
<td align="left">6</td>
<td align="left">&#54;</td>
<td align="left">Six</td>
</tr>
<tr>
<td align="left">55</td>
<td align="left">067</td>
<td align="left">37</td>
<td align="left">00110111</td>
<td align="left">7</td>
<td align="left">&#55;</td>
<td align="left">Seven</td>
</tr>
<tr>
<td align="left">56</td>
<td align="left">070</td>
<td align="left">38</td>
<td align="left">00111000</td>
<td align="left">8</td>
<td align="left">&#56;</td>
<td align="left">Eight</td>
</tr>
<tr>
<td align="left">57</td>
<td align="left">071</td>
<td align="left">39</td>
<td align="left">00111001</td>
<td align="left">9</td>
<td align="left">&#57;</td>
<td align="left">Nine</td>
</tr>
<tr>
<td align="left">58</td>
<td align="left">072</td>
<td align="left">3A</td>
<td align="left">00111010</td>
<td align="left">:</td>
<td align="left">&#58;</td>
<td align="left">Colon</td>
</tr>
<tr>
<td align="left">59</td>
<td align="left">073</td>
<td align="left">3B</td>
<td align="left">00111011</td>
<td align="left">;</td>
<td align="left">&#59;</td>
<td align="left">Semicolon</td>
</tr>
<tr>
<td align="left">60</td>
<td align="left">074</td>
<td align="left">3C</td>
<td align="left">00111100</td>
<td align="left">&lt;</td>
<td align="left">&#60;</td>
<td align="left">Less than</td>
</tr>
<tr>
<td align="left">61</td>
<td align="left">075</td>
<td align="left">3D</td>
<td align="left">00111101</td>
<td align="left">=</td>
<td align="left">&#61;</td>
<td align="left">Equals</td>
</tr>
<tr>
<td align="left">62</td>
<td align="left">076</td>
<td align="left">3E</td>
<td align="left">00111110</td>
<td align="left">&gt;</td>
<td align="left">&#62;</td>
<td align="left">Greater than</td>
</tr>
<tr>
<td align="left">63</td>
<td align="left">077</td>
<td align="left">3F</td>
<td align="left">00111111</td>
<td align="left">?</td>
<td align="left">&#63;</td>
<td align="left">Question mark</td>
</tr>
<tr>
<td align="left">64</td>
<td align="left">100</td>
<td align="left">40</td>
<td align="left">01000000</td>
<td align="left">@</td>
<td align="left">&#64;</td>
<td align="left">At symbol</td>
</tr>
<tr>
<td align="left">65</td>
<td align="left">101</td>
<td align="left">41</td>
<td align="left">01000001</td>
<td align="left">A</td>
<td align="left">&#65;</td>
<td align="left">Uppercase A</td>
</tr>
<tr>
<td align="left">66</td>
<td align="left">102</td>
<td align="left">42</td>
<td align="left">01000010</td>
<td align="left">B</td>
<td align="left">&#66;</td>
<td align="left">Uppercase B</td>
</tr>
<tr>
<td align="left">67</td>
<td align="left">103</td>
<td align="left">43</td>
<td align="left">01000011</td>
<td align="left">C</td>
<td align="left">&#67;</td>
<td align="left">Uppercase C</td>
</tr>
<tr>
<td align="left">68</td>
<td align="left">104</td>
<td align="left">44</td>
<td align="left">01000100</td>
<td align="left">D</td>
<td align="left">&#68;</td>
<td align="left">Uppercase D</td>
</tr>
<tr>
<td align="left">69</td>
<td align="left">105</td>
<td align="left">45</td>
<td align="left">01000101</td>
<td align="left">E</td>
<td align="left">&#69;</td>
<td align="left">Uppercase E</td>
</tr>
<tr>
<td align="left">70</td>
<td align="left">106</td>
<td align="left">46</td>
<td align="left">01000110</td>
<td align="left">F</td>
<td align="left">&#70;</td>
<td align="left">Uppercase F</td>
</tr>
<tr>
<td align="left">71</td>
<td align="left">107</td>
<td align="left">47</td>
<td align="left">01000111</td>
<td align="left">G</td>
<td align="left">&#71;</td>
<td align="left">Uppercase G</td>
</tr>
<tr>
<td align="left">72</td>
<td align="left">110</td>
<td align="left">48</td>
<td align="left">01001000</td>
<td align="left">H</td>
<td align="left">&#72;</td>
<td align="left">Uppercase H</td>
</tr>
<tr>
<td align="left">73</td>
<td align="left">111</td>
<td align="left">49</td>
<td align="left">01001001</td>
<td align="left">I</td>
<td align="left">&#73;</td>
<td align="left">Uppercase I</td>
</tr>
<tr>
<td align="left">74</td>
<td align="left">112</td>
<td align="left">4A</td>
<td align="left">01001010</td>
<td align="left">J</td>
<td align="left">&#74;</td>
<td align="left">Uppercase J</td>
</tr>
<tr>
<td align="left">75</td>
<td align="left">113</td>
<td align="left">4B</td>
<td align="left">01001011</td>
<td align="left">K</td>
<td align="left">&#75;</td>
<td align="left">Uppercase K</td>
</tr>
<tr>
<td align="left">76</td>
<td align="left">114</td>
<td align="left">4C</td>
<td align="left">01001100</td>
<td align="left">L</td>
<td align="left">&#76;</td>
<td align="left">Uppercase L</td>
</tr>
<tr>
<td align="left">77</td>
<td align="left">115</td>
<td align="left">4D</td>
<td align="left">01001101</td>
<td align="left">M</td>
<td align="left">&#77;</td>
<td align="left">Uppercase M</td>
</tr>
<tr>
<td align="left">78</td>
<td align="left">116</td>
<td align="left">4E</td>
<td align="left">01001110</td>
<td align="left">N</td>
<td align="left">&#78;</td>
<td align="left">Uppercase N</td>
</tr>
<tr>
<td align="left">79</td>
<td align="left">117</td>
<td align="left">4F</td>
<td align="left">01001111</td>
<td align="left">O</td>
<td align="left">&#79;</td>
<td align="left">Uppercase O</td>
</tr>
<tr>
<td align="left">80</td>
<td align="left">120</td>
<td align="left">50</td>
<td align="left">01010000</td>
<td align="left">P</td>
<td align="left">&#80;</td>
<td align="left">Uppercase P</td>
</tr>
<tr>
<td align="left">81</td>
<td align="left">121</td>
<td align="left">51</td>
<td align="left">01010001</td>
<td align="left">Q</td>
<td align="left">&#81;</td>
<td align="left">Uppercase Q</td>
</tr>
<tr>
<td align="left">82</td>
<td align="left">122</td>
<td align="left">52</td>
<td align="left">01010010</td>
<td align="left">R</td>
<td align="left">&#82;</td>
<td align="left">Uppercase R</td>
</tr>
<tr>
<td align="left">83</td>
<td align="left">123</td>
<td align="left">53</td>
<td align="left">01010011</td>
<td align="left">S</td>
<td align="left">&#83;</td>
<td align="left">Uppercase S</td>
</tr>
<tr>
<td align="left">84</td>
<td align="left">124</td>
<td align="left">54</td>
<td align="left">01010100</td>
<td align="left">T</td>
<td align="left">&#84;</td>
<td align="left">Uppercase T</td>
</tr>
<tr>
<td align="left">85</td>
<td align="left">125</td>
<td align="left">55</td>
<td align="left">01010101</td>
<td align="left">U</td>
<td align="left">&#85;</td>
<td align="left">Uppercase U</td>
</tr>
<tr>
<td align="left">86</td>
<td align="left">126</td>
<td align="left">56</td>
<td align="left">01010110</td>
<td align="left">V</td>
<td align="left">&#86;</td>
<td align="left">Uppercase V</td>
</tr>
<tr>
<td align="left">87</td>
<td align="left">127</td>
<td align="left">57</td>
<td align="left">01010111</td>
<td align="left">W</td>
<td align="left">&#87;</td>
<td align="left">Uppercase W</td>
</tr>
<tr>
<td align="left">88</td>
<td align="left">130</td>
<td align="left">58</td>
<td align="left">01011000</td>
<td align="left">X</td>
<td align="left">&#88;</td>
<td align="left">Uppercase X</td>
</tr>
<tr>
<td align="left">89</td>
<td align="left">131</td>
<td align="left">59</td>
<td align="left">01011001</td>
<td align="left">Y</td>
<td align="left">&#89;</td>
<td align="left">Uppercase Y</td>
</tr>
<tr>
<td align="left">90</td>
<td align="left">132</td>
<td align="left">5A</td>
<td align="left">01011010</td>
<td align="left">Z</td>
<td align="left">&#90;</td>
<td align="left">Uppercase Z</td>
</tr>
<tr>
<td align="left">91</td>
<td align="left">133</td>
<td align="left">5B</td>
<td align="left">01011011</td>
<td align="left">[</td>
<td align="left">&#91;</td>
<td align="left">Opening bracket</td>
</tr>
<tr>
<td align="left">92</td>
<td align="left">134</td>
<td align="left">5C</td>
<td align="left">01011100</td>
<td align="left">\</td>
<td align="left">&#92;</td>
<td align="left">Backslash</td>
</tr>
<tr>
<td align="left">93</td>
<td align="left">135</td>
<td align="left">5D</td>
<td align="left">01011101</td>
<td align="left">]</td>
<td align="left">&#93;</td>
<td align="left">Closing bracket</td>
</tr>
<tr>
<td align="left">94</td>
<td align="left">136</td>
<td align="left">5E</td>
<td align="left">01011110</td>
<td align="left">^</td>
<td align="left">&#94;</td>
<td align="left">Caret - circumflex</td>
</tr>
<tr>
<td align="left">95</td>
<td align="left">137</td>
<td align="left">5F</td>
<td align="left">01011111</td>
<td align="left">_</td>
<td align="left">&#95;</td>
<td align="left">Underscore</td>
</tr>
<tr>
<td align="left">96</td>
<td align="left">140</td>
<td align="left">60</td>
<td align="left">01100000</td>
<td align="left">`</td>
<td align="left">&#96;</td>
<td align="left">Grave accent</td>
</tr>
<tr>
<td align="left">97</td>
<td align="left">141</td>
<td align="left">61</td>
<td align="left">01100001</td>
<td align="left">a</td>
<td align="left">&#97;</td>
<td align="left">Lowercase a</td>
</tr>
<tr>
<td align="left">98</td>
<td align="left">142</td>
<td align="left">62</td>
<td align="left">01100010</td>
<td align="left">b</td>
<td align="left">&#98;</td>
<td align="left">Lowercase b</td>
</tr>
<tr>
<td align="left">99</td>
<td align="left">143</td>
<td align="left">63</td>
<td align="left">01100011</td>
<td align="left">c</td>
<td align="left">&#99;</td>
<td align="left">Lowercase c</td>
</tr>
<tr>
<td align="left">100</td>
<td align="left">144</td>
<td align="left">64</td>
<td align="left">01100100</td>
<td align="left">d</td>
<td align="left">&#100;</td>
<td align="left">Lowercase d</td>
</tr>
<tr>
<td align="left">101</td>
<td align="left">145</td>
<td align="left">65</td>
<td align="left">01100101</td>
<td align="left">e</td>
<td align="left">&#101;</td>
<td align="left">Lowercase e</td>
</tr>
<tr>
<td align="left">102</td>
<td align="left">146</td>
<td align="left">66</td>
<td align="left">01100110</td>
<td align="left">f</td>
<td align="left">&#102;</td>
<td align="left">Lowercase f</td>
</tr>
<tr>
<td align="left">103</td>
<td align="left">147</td>
<td align="left">67</td>
<td align="left">01100111</td>
<td align="left">g</td>
<td align="left">&#103;</td>
<td align="left">Lowercase g</td>
</tr>
<tr>
<td align="left">104</td>
<td align="left">150</td>
<td align="left">68</td>
<td align="left">01101000</td>
<td align="left">h</td>
<td align="left">&#104;</td>
<td align="left">Lowercase h</td>
</tr>
<tr>
<td align="left">105</td>
<td align="left">151</td>
<td align="left">69</td>
<td align="left">01101001</td>
<td align="left">i</td>
<td align="left">&#105;</td>
<td align="left">Lowercase i</td>
</tr>
<tr>
<td align="left">106</td>
<td align="left">152</td>
<td align="left">6A</td>
<td align="left">01101010</td>
<td align="left">j</td>
<td align="left">&#106;</td>
<td align="left">Lowercase j</td>
</tr>
<tr>
<td align="left">107</td>
<td align="left">153</td>
<td align="left">6B</td>
<td align="left">01101011</td>
<td align="left">k</td>
<td align="left">&#107;</td>
<td align="left">Lowercase k</td>
</tr>
<tr>
<td align="left">108</td>
<td align="left">154</td>
<td align="left">6C</td>
<td align="left">01101100</td>
<td align="left">l</td>
<td align="left">&#108;</td>
<td align="left">Lowercase l</td>
</tr>
<tr>
<td align="left">109</td>
<td align="left">155</td>
<td align="left">6D</td>
<td align="left">01101101</td>
<td align="left">m</td>
<td align="left">&#109;</td>
<td align="left">Lowercase m</td>
</tr>
<tr>
<td align="left">110</td>
<td align="left">156</td>
<td align="left">6E</td>
<td align="left">01101110</td>
<td align="left">n</td>
<td align="left">&#110;</td>
<td align="left">Lowercase n</td>
</tr>
<tr>
<td align="left">111</td>
<td align="left">157</td>
<td align="left">6F</td>
<td align="left">01101111</td>
<td align="left">o</td>
<td align="left">&#111;</td>
<td align="left">Lowercase o</td>
</tr>
<tr>
<td align="left">112</td>
<td align="left">160</td>
<td align="left">70</td>
<td align="left">01110000</td>
<td align="left">p</td>
<td align="left">&#112;</td>
<td align="left">Lowercase p</td>
</tr>
<tr>
<td align="left">113</td>
<td align="left">161</td>
<td align="left">71</td>
<td align="left">01110001</td>
<td align="left">q</td>
<td align="left">&#113;</td>
<td align="left">Lowercase q</td>
</tr>
<tr>
<td align="left">114</td>
<td align="left">162</td>
<td align="left">72</td>
<td align="left">01110010</td>
<td align="left">r</td>
<td align="left">&#114;</td>
<td align="left">Lowercase r</td>
</tr>
<tr>
<td align="left">115</td>
<td align="left">163</td>
<td align="left">73</td>
<td align="left">01110011</td>
<td align="left">s</td>
<td align="left">&#115;</td>
<td align="left">Lowercase s</td>
</tr>
<tr>
<td align="left">116</td>
<td align="left">164</td>
<td align="left">74</td>
<td align="left">01110100</td>
<td align="left">t</td>
<td align="left">&#116;</td>
<td align="left">Lowercase t</td>
</tr>
<tr>
<td align="left">117</td>
<td align="left">165</td>
<td align="left">75</td>
<td align="left">01110101</td>
<td align="left">u</td>
<td align="left">&#117;</td>
<td align="left">Lowercase u</td>
</tr>
<tr>
<td align="left">118</td>
<td align="left">166</td>
<td align="left">76</td>
<td align="left">01110110</td>
<td align="left">v</td>
<td align="left">&#118;</td>
<td align="left">Lowercase v</td>
</tr>
<tr>
<td align="left">119</td>
<td align="left">167</td>
<td align="left">77</td>
<td align="left">01110111</td>
<td align="left">w</td>
<td align="left">&#119;</td>
<td align="left">Lowercase w</td>
</tr>
<tr>
<td align="left">120</td>
<td align="left">170</td>
<td align="left">78</td>
<td align="left">01111000</td>
<td align="left">x</td>
<td align="left">&#120;</td>
<td align="left">Lowercase x</td>
</tr>
<tr>
<td align="left">121</td>
<td align="left">171</td>
<td align="left">79</td>
<td align="left">01111001</td>
<td align="left">y</td>
<td align="left">&#121;</td>
<td align="left">Lowercase y</td>
</tr>
<tr>
<td align="left">122</td>
<td align="left">172</td>
<td align="left">7A</td>
<td align="left">01111010</td>
<td align="left">z</td>
<td align="left">&#122;</td>
<td align="left">Lowercase z</td>
</tr>
<tr>
<td align="left">123</td>
<td align="left">173</td>
<td align="left">7B</td>
<td align="left">01111011</td>
<td align="left">{</td>
<td align="left">&#123;</td>
<td align="left">Opening brace</td>
</tr>
<tr>
<td align="left">124</td>
<td align="left">174</td>
<td align="left">7C</td>
<td align="left">01111100</td>
<td align="left">|</td>
<td align="left">&#124;</td>
<td align="left">Vertical bar</td>
</tr>
<tr>
<td align="left">125</td>
<td align="left">175</td>
<td align="left">7D</td>
<td align="left">01111101</td>
<td align="left">}</td>
<td align="left">&#125;</td>
<td align="left">Closing brace</td>
</tr>
<tr>
<td align="left">126</td>
<td align="left">176</td>
<td align="left">7E</td>
<td align="left">01111110</td>
<td align="left">~</td>
<td align="left">&#126;</td>
<td align="left">Equivalency sign (tilde)</td>
</tr>
<tr>
<td align="left">127</td>
<td align="left">177</td>
<td align="left">7F</td>
<td align="left">01111111</td>
<td align="left"></td>
<td align="left">&#127;</td>
<td align="left">Delete</td>
</tr>
<tr>
<td align="left">128</td>
<td align="left">200</td>
<td align="left">80</td>
<td align="left">10000000</td>
<td align="left">€</td>
<td align="left">&#128;</td>
<td align="left">Euro sign</td>
</tr>
<tr>
<td align="left">129</td>
<td align="left">201</td>
<td align="left">81</td>
<td align="left">10000001</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">130</td>
<td align="left">202</td>
<td align="left">82</td>
<td align="left">10000010</td>
<td align="left">‚</td>
<td align="left">&#130;</td>
<td align="left">Single low-9 quotation mark</td>
</tr>
<tr>
<td align="left">131</td>
<td align="left">203</td>
<td align="left">83</td>
<td align="left">10000011</td>
<td align="left">ƒ</td>
<td align="left">&#131;</td>
<td align="left">Latin small letter f with hook</td>
</tr>
<tr>
<td align="left">132</td>
<td align="left">204</td>
<td align="left">84</td>
<td align="left">10000100</td>
<td align="left">„</td>
<td align="left">&#132;</td>
<td align="left">Double low-9 quotation mark</td>
</tr>
<tr>
<td align="left">133</td>
<td align="left">205</td>
<td align="left">85</td>
<td align="left">10000101</td>
<td align="left">…</td>
<td align="left">&#133;</td>
<td align="left">Horizontal ellipsis</td>
</tr>
<tr>
<td align="left">134</td>
<td align="left">206</td>
<td align="left">86</td>
<td align="left">10000110</td>
<td align="left">†</td>
<td align="left">&#134;</td>
<td align="left">Dagger</td>
</tr>
<tr>
<td align="left">135</td>
<td align="left">207</td>
<td align="left">87</td>
<td align="left">10000111</td>
<td align="left">‡</td>
<td align="left">&#135;</td>
<td align="left">Double dagger</td>
</tr>
<tr>
<td align="left">136</td>
<td align="left">210</td>
<td align="left">88</td>
<td align="left">10001000</td>
<td align="left">ˆ</td>
<td align="left">&#136;</td>
<td align="left">Modifier letter circumflex accent</td>
</tr>
<tr>
<td align="left">137</td>
<td align="left">211</td>
<td align="left">89</td>
<td align="left">10001001</td>
<td align="left">‰</td>
<td align="left">&#137;</td>
<td align="left">Per mille sign</td>
</tr>
<tr>
<td align="left">138</td>
<td align="left">212</td>
<td align="left">8A</td>
<td align="left">10001010</td>
<td align="left">Š</td>
<td align="left">&#138;</td>
<td align="left">Latin capital letter S with caron</td>
</tr>
<tr>
<td align="left">139</td>
<td align="left">213</td>
<td align="left">8B</td>
<td align="left">10001011</td>
<td align="left">‹</td>
<td align="left">&#139;</td>
<td align="left">Single left-pointing angle quotation</td>
</tr>
<tr>
<td align="left">140</td>
<td align="left">214</td>
<td align="left">8C</td>
<td align="left">10001100</td>
<td align="left">Œ</td>
<td align="left">&#140;</td>
<td align="left">Latin capital ligature OE</td>
</tr>
<tr>
<td align="left">141</td>
<td align="left">215</td>
<td align="left">8D</td>
<td align="left">10001101</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">142</td>
<td align="left">216</td>
<td align="left">8E</td>
<td align="left">10001110</td>
<td align="left">Ž</td>
<td align="left">&#142;</td>
<td align="left">Latin capital letter Z with caron</td>
</tr>
<tr>
<td align="left">143</td>
<td align="left">217</td>
<td align="left">8F</td>
<td align="left">10001111</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">144</td>
<td align="left">220</td>
<td align="left">90</td>
<td align="left">10010000</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">145</td>
<td align="left">221</td>
<td align="left">91</td>
<td align="left">10010001</td>
<td align="left">‘</td>
<td align="left">&#145;</td>
<td align="left">Left single quotation mark</td>
</tr>
<tr>
<td align="left">146</td>
<td align="left">222</td>
<td align="left">92</td>
<td align="left">10010010</td>
<td align="left">’</td>
<td align="left">&#146;</td>
<td align="left">Right single quotation mark</td>
</tr>
<tr>
<td align="left">147</td>
<td align="left">223</td>
<td align="left">93</td>
<td align="left">10010011</td>
<td align="left">“</td>
<td align="left">&#147;</td>
<td align="left">Left double quotation mark</td>
</tr>
<tr>
<td align="left">148</td>
<td align="left">224</td>
<td align="left">94</td>
<td align="left">10010100</td>
<td align="left">”</td>
<td align="left">&#148;</td>
<td align="left">Right double quotation mark</td>
</tr>
<tr>
<td align="left">149</td>
<td align="left">225</td>
<td align="left">95</td>
<td align="left">10010101</td>
<td align="left">•</td>
<td align="left">&#149;</td>
<td align="left">Bullet</td>
</tr>
<tr>
<td align="left">150</td>
<td align="left">226</td>
<td align="left">96</td>
<td align="left">10010110</td>
<td align="left">–</td>
<td align="left">&#150;</td>
<td align="left">En dash</td>
</tr>
<tr>
<td align="left">151</td>
<td align="left">227</td>
<td align="left">97</td>
<td align="left">10010111</td>
<td align="left">—</td>
<td align="left">&#151;</td>
<td align="left">Em dash</td>
</tr>
<tr>
<td align="left">152</td>
<td align="left">230</td>
<td align="left">98</td>
<td align="left">10011000</td>
<td align="left">˜</td>
<td align="left">&#152;</td>
<td align="left">Small tilde</td>
</tr>
<tr>
<td align="left">153</td>
<td align="left">231</td>
<td align="left">99</td>
<td align="left">10011001</td>
<td align="left">™</td>
<td align="left">&#153;</td>
<td align="left">Trade mark sign</td>
</tr>
<tr>
<td align="left">154</td>
<td align="left">232</td>
<td align="left">9A</td>
<td align="left">10011010</td>
<td align="left">š</td>
<td align="left">&#154;</td>
<td align="left">Latin small letter S with caron</td>
</tr>
<tr>
<td align="left">155</td>
<td align="left">233</td>
<td align="left">9B</td>
<td align="left">10011011</td>
<td align="left">›</td>
<td align="left">&#155;</td>
<td align="left">Single right-pointing angle quotation mark</td>
</tr>
<tr>
<td align="left">156</td>
<td align="left">234</td>
<td align="left">9C</td>
<td align="left">10011100</td>
<td align="left">œ</td>
<td align="left">&#156;</td>
<td align="left">Latin small ligature oe</td>
</tr>
<tr>
<td align="left">157</td>
<td align="left">235</td>
<td align="left">9D</td>
<td align="left">10011101</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">158</td>
<td align="left">236</td>
<td align="left">9E</td>
<td align="left">10011110</td>
<td align="left">ž</td>
<td align="left">&#158;</td>
<td align="left">Latin small letter z with caron</td>
</tr>
<tr>
<td align="left">159</td>
<td align="left">237</td>
<td align="left">9F</td>
<td align="left">10011111</td>
<td align="left">Ÿ</td>
<td align="left">&#159;</td>
<td align="left">Latin capital letter Y with diaeresis</td>
</tr>
<tr>
<td align="left">160</td>
<td align="left">240</td>
<td align="left">A0</td>
<td align="left">10100000</td>
<td align="left"></td>
<td align="left">&#160;</td>
<td align="left">Non-breaking space</td>
</tr>
<tr>
<td align="left">161</td>
<td align="left">241</td>
<td align="left">A1</td>
<td align="left">10100001</td>
<td align="left">¡</td>
<td align="left">&#161;</td>
<td align="left">Inverted exclamation mark</td>
</tr>
<tr>
<td align="left">162</td>
<td align="left">242</td>
<td align="left">A2</td>
<td align="left">10100010</td>
<td align="left">¢</td>
<td align="left">&#162;</td>
<td align="left">Cent sign</td>
</tr>
<tr>
<td align="left">163</td>
<td align="left">243</td>
<td align="left">A3</td>
<td align="left">10100011</td>
<td align="left">£</td>
<td align="left">&#163;</td>
<td align="left">Pound sign</td>
</tr>
<tr>
<td align="left">164</td>
<td align="left">244</td>
<td align="left">A4</td>
<td align="left">10100100</td>
<td align="left">¤</td>
<td align="left">&#164;</td>
<td align="left">Currency sign</td>
</tr>
<tr>
<td align="left">165</td>
<td align="left">245</td>
<td align="left">A5</td>
<td align="left">10100101</td>
<td align="left">¥</td>
<td align="left">&#165;</td>
<td align="left">Yen sign</td>
</tr>
<tr>
<td align="left">166</td>
<td align="left">246</td>
<td align="left">A6</td>
<td align="left">10100110</td>
<td align="left">¦</td>
<td align="left">&#166;</td>
<td align="left">Pipe, Broken vertical bar</td>
</tr>
<tr>
<td align="left">167</td>
<td align="left">247</td>
<td align="left">A7</td>
<td align="left">10100111</td>
<td align="left">§</td>
<td align="left">&#167;</td>
<td align="left">Section sign</td>
</tr>
<tr>
<td align="left">168</td>
<td align="left">250</td>
<td align="left">A8</td>
<td align="left">10101000</td>
<td align="left">¨</td>
<td align="left">&#168;</td>
<td align="left">Spacing diaeresis - umlaut</td>
</tr>
<tr>
<td align="left">169</td>
<td align="left">251</td>
<td align="left">A9</td>
<td align="left">10101001</td>
<td align="left">©</td>
<td align="left">&#169;</td>
<td align="left">Copyright sign</td>
</tr>
<tr>
<td align="left">170</td>
<td align="left">252</td>
<td align="left">AA</td>
<td align="left">10101010</td>
<td align="left">ª</td>
<td align="left">&#170;</td>
<td align="left">Feminine ordinal indicator</td>
</tr>
<tr>
<td align="left">171</td>
<td align="left">253</td>
<td align="left">AB</td>
<td align="left">10101011</td>
<td align="left">«</td>
<td align="left">&#171;</td>
<td align="left">Left double angle quotes</td>
</tr>
<tr>
<td align="left">172</td>
<td align="left">254</td>
<td align="left">AC</td>
<td align="left">10101100</td>
<td align="left">¬</td>
<td align="left">&#172;</td>
<td align="left">Not sign</td>
</tr>
<tr>
<td align="left">173</td>
<td align="left">255</td>
<td align="left">AD</td>
<td align="left">10101101</td>
<td align="left">­</td>
<td align="left">&#173;</td>
<td align="left">Soft hyphen</td>
</tr>
<tr>
<td align="left">174</td>
<td align="left">256</td>
<td align="left">AE</td>
<td align="left">10101110</td>
<td align="left">®</td>
<td align="left">&#174;</td>
<td align="left">Registered trade mark sign</td>
</tr>
<tr>
<td align="left">175</td>
<td align="left">257</td>
<td align="left">AF</td>
<td align="left">10101111</td>
<td align="left">¯</td>
<td align="left">&#175;</td>
<td align="left">Spacing macron - overline</td>
</tr>
<tr>
<td align="left">176</td>
<td align="left">260</td>
<td align="left">B0</td>
<td align="left">10110000</td>
<td align="left">°</td>
<td align="left">&#176;</td>
<td align="left">Degree sign</td>
</tr>
<tr>
<td align="left">177</td>
<td align="left">261</td>
<td align="left">B1</td>
<td align="left">10110001</td>
<td align="left">±</td>
<td align="left">&#177;</td>
<td align="left">Plus-or-minus sign</td>
</tr>
<tr>
<td align="left">178</td>
<td align="left">262</td>
<td align="left">B2</td>
<td align="left">10110010</td>
<td align="left">²</td>
<td align="left">&#178;</td>
<td align="left">Superscript two - squared</td>
</tr>
<tr>
<td align="left">179</td>
<td align="left">263</td>
<td align="left">B3</td>
<td align="left">10110011</td>
<td align="left">³</td>
<td align="left">&#179;</td>
<td align="left">Superscript three - cubed</td>
</tr>
<tr>
<td align="left">180</td>
<td align="left">264</td>
<td align="left">B4</td>
<td align="left">10110100</td>
<td align="left">´</td>
<td align="left">&#180;</td>
<td align="left">Acute accent - spacing acute</td>
</tr>
<tr>
<td align="left">181</td>
<td align="left">265</td>
<td align="left">B5</td>
<td align="left">10110101</td>
<td align="left">µ</td>
<td align="left">&#181;</td>
<td align="left">Micro sign</td>
</tr>
<tr>
<td align="left">182</td>
<td align="left">266</td>
<td align="left">B6</td>
<td align="left">10110110</td>
<td align="left">¶</td>
<td align="left">&#182;</td>
<td align="left">Pilcrow sign - paragraph sign</td>
</tr>
<tr>
<td align="left">183</td>
<td align="left">267</td>
<td align="left">B7</td>
<td align="left">10110111</td>
<td align="left">·</td>
<td align="left">&#183;</td>
<td align="left">Middle dot - Georgian comma</td>
</tr>
<tr>
<td align="left">184</td>
<td align="left">270</td>
<td align="left">B8</td>
<td align="left">10111000</td>
<td align="left">¸</td>
<td align="left">&#184;</td>
<td align="left">Spacing cedilla</td>
</tr>
<tr>
<td align="left">185</td>
<td align="left">271</td>
<td align="left">B9</td>
<td align="left">10111001</td>
<td align="left">¹</td>
<td align="left">&#185;</td>
<td align="left">Superscript one</td>
</tr>
<tr>
<td align="left">186</td>
<td align="left">272</td>
<td align="left">BA</td>
<td align="left">10111010</td>
<td align="left">º</td>
<td align="left">&#186;</td>
<td align="left">Masculine ordinal indicator</td>
</tr>
<tr>
<td align="left">187</td>
<td align="left">273</td>
<td align="left">BB</td>
<td align="left">10111011</td>
<td align="left">»</td>
<td align="left">&#187;</td>
<td align="left">Right double angle quotes</td>
</tr>
<tr>
<td align="left">188</td>
<td align="left">274</td>
<td align="left">BC</td>
<td align="left">10111100</td>
<td align="left">¼</td>
<td align="left">&#188;</td>
<td align="left">Fraction one quarter</td>
</tr>
<tr>
<td align="left">189</td>
<td align="left">275</td>
<td align="left">BD</td>
<td align="left">10111101</td>
<td align="left">½</td>
<td align="left">&#189;</td>
<td align="left">Fraction one half</td>
</tr>
<tr>
<td align="left">190</td>
<td align="left">276</td>
<td align="left">BE</td>
<td align="left">10111110</td>
<td align="left">¾</td>
<td align="left">&#190;</td>
<td align="left">Fraction three quarters</td>
</tr>
<tr>
<td align="left">191</td>
<td align="left">277</td>
<td align="left">BF</td>
<td align="left">10111111</td>
<td align="left">¿</td>
<td align="left">&#191;</td>
<td align="left">Inverted question mark</td>
</tr>
<tr>
<td align="left">192</td>
<td align="left">300</td>
<td align="left">C0</td>
<td align="left">11000000</td>
<td align="left">À</td>
<td align="left">&#192;</td>
<td align="left">Latin capital letter A with grave</td>
</tr>
<tr>
<td align="left">193</td>
<td align="left">301</td>
<td align="left">C1</td>
<td align="left">11000001</td>
<td align="left">Á</td>
<td align="left">&#193;</td>
<td align="left">Latin capital letter A with acute</td>
</tr>
<tr>
<td align="left">194</td>
<td align="left">302</td>
<td align="left">C2</td>
<td align="left">11000010</td>
<td align="left">Â</td>
<td align="left">&#194;</td>
<td align="left">Latin capital letter A with circumflex</td>
</tr>
<tr>
<td align="left">195</td>
<td align="left">303</td>
<td align="left">C3</td>
<td align="left">11000011</td>
<td align="left">Ã</td>
<td align="left">&#195;</td>
<td align="left">Latin capital letter A with tilde</td>
</tr>
<tr>
<td align="left">196</td>
<td align="left">304</td>
<td align="left">C4</td>
<td align="left">11000100</td>
<td align="left">Ä</td>
<td align="left">&#196;</td>
<td align="left">Latin capital letter A with diaeresis</td>
</tr>
<tr>
<td align="left">197</td>
<td align="left">305</td>
<td align="left">C5</td>
<td align="left">11000101</td>
<td align="left">Å</td>
<td align="left">&#197;</td>
<td align="left">Latin capital letter A with ring above</td>
</tr>
<tr>
<td align="left">198</td>
<td align="left">306</td>
<td align="left">C6</td>
<td align="left">11000110</td>
<td align="left">Æ</td>
<td align="left">&#198;</td>
<td align="left">Latin capital letter AE</td>
</tr>
<tr>
<td align="left">199</td>
<td align="left">307</td>
<td align="left">C7</td>
<td align="left">11000111</td>
<td align="left">Ç</td>
<td align="left">&#199;</td>
<td align="left">Latin capital letter C with cedilla</td>
</tr>
<tr>
<td align="left">200</td>
<td align="left">310</td>
<td align="left">C8</td>
<td align="left">11001000</td>
<td align="left">È</td>
<td align="left">&#200;</td>
<td align="left">Latin capital letter E with grave</td>
</tr>
<tr>
<td align="left">201</td>
<td align="left">311</td>
<td align="left">C9</td>
<td align="left">11001001</td>
<td align="left">É</td>
<td align="left">&#201;</td>
<td align="left">Latin capital letter E with acute</td>
</tr>
<tr>
<td align="left">202</td>
<td align="left">312</td>
<td align="left">CA</td>
<td align="left">11001010</td>
<td align="left">Ê</td>
<td align="left">&#202;</td>
<td align="left">Latin capital letter E with circumflex</td>
</tr>
<tr>
<td align="left">203</td>
<td align="left">313</td>
<td align="left">CB</td>
<td align="left">11001011</td>
<td align="left">Ë</td>
<td align="left">&#203;</td>
<td align="left">Latin capital letter E with diaeresis</td>
</tr>
<tr>
<td align="left">204</td>
<td align="left">314</td>
<td align="left">CC</td>
<td align="left">11001100</td>
<td align="left">Ì</td>
<td align="left">&#204;</td>
<td align="left">Latin capital letter I with grave</td>
</tr>
<tr>
<td align="left">205</td>
<td align="left">315</td>
<td align="left">CD</td>
<td align="left">11001101</td>
<td align="left">Í</td>
<td align="left">&#205;</td>
<td align="left">Latin capital letter I with acute</td>
</tr>
<tr>
<td align="left">206</td>
<td align="left">316</td>
<td align="left">CE</td>
<td align="left">11001110</td>
<td align="left">Î</td>
<td align="left">&#206;</td>
<td align="left">Latin capital letter I with circumflex</td>
</tr>
<tr>
<td align="left">207</td>
<td align="left">317</td>
<td align="left">CF</td>
<td align="left">11001111</td>
<td align="left">Ï</td>
<td align="left">&#207;</td>
<td align="left">Latin capital letter I with diaeresis</td>
</tr>
<tr>
<td align="left">208</td>
<td align="left">320</td>
<td align="left">D0</td>
<td align="left">11010000</td>
<td align="left">Ð</td>
<td align="left">&#208;</td>
<td align="left">Latin capital letter ETH</td>
</tr>
<tr>
<td align="left">209</td>
<td align="left">321</td>
<td align="left">D1</td>
<td align="left">11010001</td>
<td align="left">Ñ</td>
<td align="left">&#209;</td>
<td align="left">Latin capital letter N with tilde</td>
</tr>
<tr>
<td align="left">210</td>
<td align="left">322</td>
<td align="left">D2</td>
<td align="left">11010010</td>
<td align="left">Ò</td>
<td align="left">&#210;</td>
<td align="left">Latin capital letter O with grave</td>
</tr>
<tr>
<td align="left">211</td>
<td align="left">323</td>
<td align="left">D3</td>
<td align="left">11010011</td>
<td align="left">Ó</td>
<td align="left">&#211;</td>
<td align="left">Latin capital letter O with acute</td>
</tr>
<tr>
<td align="left">212</td>
<td align="left">324</td>
<td align="left">D4</td>
<td align="left">11010100</td>
<td align="left">Ô</td>
<td align="left">&#212;</td>
<td align="left">Latin capital letter O with circumflex</td>
</tr>
<tr>
<td align="left">213</td>
<td align="left">325</td>
<td align="left">D5</td>
<td align="left">11010101</td>
<td align="left">Õ</td>
<td align="left">&#213;</td>
<td align="left">Latin capital letter O with tilde</td>
</tr>
<tr>
<td align="left">214</td>
<td align="left">326</td>
<td align="left">D6</td>
<td align="left">11010110</td>
<td align="left">Ö</td>
<td align="left">&#214;</td>
<td align="left">Latin capital letter O with diaeresis</td>
</tr>
<tr>
<td align="left">215</td>
<td align="left">327</td>
<td align="left">D7</td>
<td align="left">11010111</td>
<td align="left">×</td>
<td align="left">&#215;</td>
<td align="left">Multiplication sign</td>
</tr>
<tr>
<td align="left">216</td>
<td align="left">330</td>
<td align="left">D8</td>
<td align="left">11011000</td>
<td align="left">Ø</td>
<td align="left">&#216;</td>
<td align="left">Latin capital letter O with slash</td>
</tr>
<tr>
<td align="left">217</td>
<td align="left">331</td>
<td align="left">D9</td>
<td align="left">11011001</td>
<td align="left">Ù</td>
<td align="left">&#217;</td>
<td align="left">Latin capital letter U with grave</td>
</tr>
<tr>
<td align="left">218</td>
<td align="left">332</td>
<td align="left">DA</td>
<td align="left">11011010</td>
<td align="left">Ú</td>
<td align="left">&#218;</td>
<td align="left">Latin capital letter U with acute</td>
</tr>
<tr>
<td align="left">219</td>
<td align="left">333</td>
<td align="left">DB</td>
<td align="left">11011011</td>
<td align="left">Û</td>
<td align="left">&#219;</td>
<td align="left">Latin capital letter U with circumflex</td>
</tr>
<tr>
<td align="left">220</td>
<td align="left">334</td>
<td align="left">DC</td>
<td align="left">11011100</td>
<td align="left">Ü</td>
<td align="left">&#220;</td>
<td align="left">Latin capital letter U with diaeresis</td>
</tr>
<tr>
<td align="left">221</td>
<td align="left">335</td>
<td align="left">DD</td>
<td align="left">11011101</td>
<td align="left">Ý</td>
<td align="left">&#221;</td>
<td align="left">Latin capital letter Y with acute</td>
</tr>
<tr>
<td align="left">222</td>
<td align="left">336</td>
<td align="left">DE</td>
<td align="left">11011110</td>
<td align="left">Þ</td>
<td align="left">&#222;</td>
<td align="left">Latin capital letter THORN</td>
</tr>
<tr>
<td align="left">223</td>
<td align="left">337</td>
<td align="left">DF</td>
<td align="left">11011111</td>
<td align="left">ß</td>
<td align="left">&#223;</td>
<td align="left">Latin small letter sharp s - ess-zed</td>
</tr>
<tr>
<td align="left">224</td>
<td align="left">340</td>
<td align="left">E0</td>
<td align="left">11100000</td>
<td align="left">à</td>
<td align="left">&#224;</td>
<td align="left">Latin small letter a with grave</td>
</tr>
<tr>
<td align="left">225</td>
<td align="left">341</td>
<td align="left">E1</td>
<td align="left">11100001</td>
<td align="left">á</td>
<td align="left">&#225;</td>
<td align="left">Latin small letter a with acute</td>
</tr>
<tr>
<td align="left">226</td>
<td align="left">342</td>
<td align="left">E2</td>
<td align="left">11100010</td>
<td align="left">â</td>
<td align="left">&#226;</td>
<td align="left">Latin small letter a with circumflex</td>
</tr>
<tr>
<td align="left">227</td>
<td align="left">343</td>
<td align="left">E3</td>
<td align="left">11100011</td>
<td align="left">ã</td>
<td align="left">&#227;</td>
<td align="left">Latin small letter a with tilde</td>
</tr>
<tr>
<td align="left">228</td>
<td align="left">344</td>
<td align="left">E4</td>
<td align="left">11100100</td>
<td align="left">ä</td>
<td align="left">&#228;</td>
<td align="left">Latin small letter a with diaeresis</td>
</tr>
<tr>
<td align="left">229</td>
<td align="left">345</td>
<td align="left">E5</td>
<td align="left">11100101</td>
<td align="left">å</td>
<td align="left">&#229;</td>
<td align="left">Latin small letter a with ring above</td>
</tr>
<tr>
<td align="left">230</td>
<td align="left">346</td>
<td align="left">E6</td>
<td align="left">11100110</td>
<td align="left">æ</td>
<td align="left">&#230;</td>
<td align="left">Latin small letter ae</td>
</tr>
<tr>
<td align="left">231</td>
<td align="left">347</td>
<td align="left">E7</td>
<td align="left">11100111</td>
<td align="left">ç</td>
<td align="left">&#231;</td>
<td align="left">Latin small letter c with cedilla</td>
</tr>
<tr>
<td align="left">232</td>
<td align="left">350</td>
<td align="left">E8</td>
<td align="left">11101000</td>
<td align="left">è</td>
<td align="left">&#232;</td>
<td align="left">Latin small letter e with grave</td>
</tr>
<tr>
<td align="left">233</td>
<td align="left">351</td>
<td align="left">E9</td>
<td align="left">11101001</td>
<td align="left">é</td>
<td align="left">&#233;</td>
<td align="left">Latin small letter e with acute</td>
</tr>
<tr>
<td align="left">234</td>
<td align="left">352</td>
<td align="left">EA</td>
<td align="left">11101010</td>
<td align="left">ê</td>
<td align="left">&#234;</td>
<td align="left">Latin small letter e with circumflex</td>
</tr>
<tr>
<td align="left">235</td>
<td align="left">353</td>
<td align="left">EB</td>
<td align="left">11101011</td>
<td align="left">ë</td>
<td align="left">&#235;</td>
<td align="left">Latin small letter e with diaeresis</td>
</tr>
<tr>
<td align="left">236</td>
<td align="left">354</td>
<td align="left">EC</td>
<td align="left">11101100</td>
<td align="left">ì</td>
<td align="left">&#236;</td>
<td align="left">Latin small letter i with grave</td>
</tr>
<tr>
<td align="left">237</td>
<td align="left">355</td>
<td align="left">ED</td>
<td align="left">11101101</td>
<td align="left">í</td>
<td align="left">&#237;</td>
<td align="left">Latin small letter i with acute</td>
</tr>
<tr>
<td align="left">238</td>
<td align="left">356</td>
<td align="left">EE</td>
<td align="left">11101110</td>
<td align="left">î</td>
<td align="left">&#238;</td>
<td align="left">Latin small letter i with circumflex</td>
</tr>
<tr>
<td align="left">239</td>
<td align="left">357</td>
<td align="left">EF</td>
<td align="left">11101111</td>
<td align="left">ï</td>
<td align="left">&#239;</td>
<td align="left">Latin small letter i with diaeresis</td>
</tr>
<tr>
<td align="left">240</td>
<td align="left">360</td>
<td align="left">F0</td>
<td align="left">11110000</td>
<td align="left">ð</td>
<td align="left">&#240;</td>
<td align="left">Latin small letter eth</td>
</tr>
<tr>
<td align="left">241</td>
<td align="left">361</td>
<td align="left">F1</td>
<td align="left">11110001</td>
<td align="left">ñ</td>
<td align="left">&#241;</td>
<td align="left">Latin small letter n with tilde</td>
</tr>
<tr>
<td align="left">242</td>
<td align="left">362</td>
<td align="left">F2</td>
<td align="left">11110010</td>
<td align="left">ò</td>
<td align="left">&#242;</td>
<td align="left">Latin small letter o with grave</td>
</tr>
<tr>
<td align="left">243</td>
<td align="left">363</td>
<td align="left">F3</td>
<td align="left">11110011</td>
<td align="left">ó</td>
<td align="left">&#243;</td>
<td align="left">Latin small letter o with acute</td>
</tr>
<tr>
<td align="left">244</td>
<td align="left">364</td>
<td align="left">F4</td>
<td align="left">11110100</td>
<td align="left">ô</td>
<td align="left">&#244;</td>
<td align="left">Latin small letter o with circumflex</td>
</tr>
<tr>
<td align="left">245</td>
<td align="left">365</td>
<td align="left">F5</td>
<td align="left">11110101</td>
<td align="left">õ</td>
<td align="left">&#245;</td>
<td align="left">Latin small letter o with tilde</td>
</tr>
<tr>
<td align="left">246</td>
<td align="left">366</td>
<td align="left">F6</td>
<td align="left">11110110</td>
<td align="left">ö</td>
<td align="left">&#246;</td>
<td align="left">Latin small letter o with diaeresis</td>
</tr>
<tr>
<td align="left">247</td>
<td align="left">367</td>
<td align="left">F7</td>
<td align="left">11110111</td>
<td align="left">÷</td>
<td align="left">&#247;</td>
<td align="left">Division sign</td>
</tr>
<tr>
<td align="left">248</td>
<td align="left">370</td>
<td align="left">F8</td>
<td align="left">11111000</td>
<td align="left">ø</td>
<td align="left">&#248;</td>
<td align="left">Latin small letter o with slash</td>
</tr>
<tr>
<td align="left">249</td>
<td align="left">371</td>
<td align="left">F9</td>
<td align="left">11111001</td>
<td align="left">ù</td>
<td align="left">&#249;</td>
<td align="left">Latin small letter u with grave</td>
</tr>
<tr>
<td align="left">250</td>
<td align="left">372</td>
<td align="left">FA</td>
<td align="left">11111010</td>
<td align="left">ú</td>
<td align="left">&#250;</td>
<td align="left">Latin small letter u with acute</td>
</tr>
<tr>
<td align="left">251</td>
<td align="left">373</td>
<td align="left">FB</td>
<td align="left">11111011</td>
<td align="left">û</td>
<td align="left">&#251;</td>
<td align="left">Latin small letter u with circumflex</td>
</tr>
<tr>
<td align="left">252</td>
<td align="left">374</td>
<td align="left">FC</td>
<td align="left">11111100</td>
<td align="left">ü</td>
<td align="left">&#252;</td>
<td align="left">Latin small letter u with diaeresis</td>
</tr>
<tr>
<td align="left">253</td>
<td align="left">375</td>
<td align="left">FD</td>
<td align="left">11111101</td>
<td align="left">ý</td>
<td align="left">&#253;</td>
<td align="left">Latin small letter y with acute</td>
</tr>
<tr>
<td align="left">254</td>
<td align="left">376</td>
<td align="left">FE</td>
<td align="left">11111110</td>
<td align="left">þ</td>
<td align="left">&#254;</td>
<td align="left">Latin small letter thorn</td>
</tr>
<tr>
<td align="left">255</td>
<td align="left">377</td>
<td align="left">FF</td>
<td align="left">11111111</td>
<td align="left">ÿ</td>
<td align="left">&#255;</td>
<td align="left">Latin small letter y with diaeresis</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Note</title>
    <url>/2021/02/11/mysql-note/</url>
    <content><![CDATA[<h1 id="1-基本命令"><a href="#1-基本命令" class="headerlink" title="(1) 基本命令"></a>(1) 基本命令</h1><ul>
<li><p>登录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// -h 指定连接的主机</span><br><span class="line">// -P 指定端口</span><br><span class="line">// -u 指定用户</span><br><span class="line">// -p 指定密码</span><br><span class="line">mysql -h localhost -P 3306 -u root -p root1234</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img1.png"></p>
</li>
<li><p>退出</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img2.png"></p>
</li>
<li><p>查看所有数据库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img3.png"></p>
</li>
<li><p>打开某个数据库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use sys;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img4.png"></p>
</li>
<li><p>显示数据库内的表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img5.png"></p>
</li>
<li><p>显示指定数据库内的表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show tables from mysql;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img6.png"></p>
</li>
<li><p>查看当前所在数据库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select database();</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img7.png"></p>
</li>
<li><p>创建数据库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create database test;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img8.png"></p>
</li>
<li><p>创建表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table user_info(id int, name varchar(20));</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img9.png"></p>
</li>
<li><p>查看表结构</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">desc user_info;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img10.png"></p>
</li>
<li><p>插入数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">insert into user_info(id,name) value(1,&#x27;Kavan&#x27;);</span><br></pre></td></tr></table></figure></li>
<li><p>查看表中的数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from user_info;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img11.png"></p>
</li>
<li><p>修改表内的数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update user_info set name=&#x27;KavanLiu&#x27; where id=1;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img12.png"></p>
</li>
<li><p>删除数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">delete from user_info where id=1;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img13.png"></p>
</li>
<li><p>查看数据库版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select version();</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img14.png"></p>
</li>
<li><p>命令行查看版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql --version</span><br><span class="line">mysql -V</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/11/mysql-note/img15.png"></p>
</li>
</ul>
<h1 id="2-查询"><a href="#2-查询" class="headerlink" title="(2) 查询"></a>(2) 查询</h1><h2 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h2><ul>
<li><p>departments<br><img src="/2021/02/11/mysql-note/departments.png" alt="departments"></p>
</li>
<li><p>employees<br><img src="/2021/02/11/mysql-note/employees.png" alt="employees"></p>
</li>
<li><p>jobs<br><img src="/2021/02/11/mysql-note/jobs.png" alt="jobs"></p>
</li>
<li><p>locations<br><img src="/2021/02/11/mysql-note/locations.png" alt="locations"></p>
</li>
<li><p>job_grades<br><img src="/2021/02/11/mysql-note/job_grades.png" alt="job_grades"></p>
</li>
</ul>
<h2 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">USE myemployees;</span><br><span class="line">/*</span><br><span class="line">语法：SELECT 查询的东西 FROM 表名;</span><br><span class="line"></span><br><span class="line">特点：</span><br><span class="line">1、可以查询表中的字段、常量值、表达式、函数</span><br><span class="line">2、查询结果是虚拟表格</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"># 1、查询单个字段</span><br><span class="line">SELECT last_name FROM employees;</span><br><span class="line"></span><br><span class="line"># 2、查询多个字短</span><br><span class="line">SELECT last_name,salary,email FROM employees;</span><br><span class="line"></span><br><span class="line"># 3、查询所有字段</span><br><span class="line">SELECT * FROM employees;</span><br><span class="line"></span><br><span class="line"># 4、查询常量值（字符型和日期型必须用引号引起来）</span><br><span class="line">SELECT 100;</span><br><span class="line">SELECT &#x27;jhon&#x27;;</span><br><span class="line"></span><br><span class="line"># 5、查询表达式</span><br><span class="line">SELECT 100*98;</span><br><span class="line">SELECT 100%98;</span><br><span class="line"></span><br><span class="line"># 6、查询函数</span><br><span class="line">SELECT VERSION();</span><br><span class="line"></span><br><span class="line"># 7、为字段起别名</span><br><span class="line">SELECT 100%98 AS Result;</span><br><span class="line">SELECT last_name AS 姓,first_name AS 名 FROM employees;</span><br><span class="line">SELECT last_name 姓,first_name 名 FROM employees;</span><br><span class="line">SELECT last_name AS &quot;姓 名&quot; FROM employees;</span><br><span class="line"></span><br><span class="line"># 8、去重（只能针对单个字段去重，多个字段不支持。假如支持，第一个字段去重后，第二个字段查询出来可能不完整）</span><br><span class="line">SELECT DISTINCT department_id FROM employees;</span><br><span class="line"></span><br><span class="line"># 9、+ 的作用（只能当作运算符，不能当作字符串的连接符）</span><br><span class="line">SELECT &#x27;100&#x27;+6; # 会试图将字符转换成数值型进行运算，</span><br><span class="line">SELECT &#x27;jhon&#x27;+6; # 转换失败，字符取值为0</span><br><span class="line">SELECT null+6; # 只要存在null，结果就为null</span><br><span class="line"># 连接多个字段使用concat函数</span><br><span class="line">SELECT CONCAT(last_name,first_name) AS 姓名 FROM employees;</span><br><span class="line"></span><br><span class="line"># 10、IFNULL(expr1,expr2) 如果值为null，使用第二个参数代替</span><br><span class="line">SELECT IFNULL(commission_pct,0) FROM employees;</span><br><span class="line"></span><br><span class="line"># 11、ISNULL() 判断字段或表达式是否为null，是返回1，否则返回0</span><br><span class="line">SELECT ISNULL(commission_pct),commission_pct FROM employees;</span><br></pre></td></tr></table></figure>

<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">USE myemployees;</span><br><span class="line">/*</span><br><span class="line">语法：SELECT 查询的东西 FROM 表名 WHERE 筛选条件;</span><br><span class="line"></span><br><span class="line">分类：</span><br><span class="line">1、按条件表达式(&#x27;&gt;&#x27;, &#x27;&lt;&#x27;, &#x27;=&#x27;, &#x27;!=&#x27;, &#x27;&lt;&gt;&#x27;, &#x27;&gt;=&#x27;, &#x27;&lt;=&#x27;&gt;)筛选</span><br><span class="line">2、按逻辑表达式(&#x27;&amp;&amp;&#x27;, &#x27;||&#x27;, &#x27;!&#x27;, &#x27;AND&#x27;, &#x27;OR&#x27;, &#x27;NOT&#x27;)筛选</span><br><span class="line">3、模糊(&#x27;LIKE&#x27;, &#x27;BETWEEN AND&#x27;, &#x27;IN&#x27;, &#x27;IS NULL&#x27;, &#x27;IS NOT NULL&#x27;)筛选</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"># 按条件表达式</span><br><span class="line">SELECT * FROM employees WHERE salary&gt;12000;</span><br><span class="line">SELECT last_name,department_id FROM employees WHERE department_id&lt;&gt;90;</span><br><span class="line"></span><br><span class="line"># 按逻辑表达式</span><br><span class="line">SELECT last_name,salary,commission_pct FROM employees WHERE salary&gt;=10000 AND salary&lt;=10000;</span><br><span class="line">SELECT * FROM employees WHERE department_id&lt;90 OR department_id&gt;100 OR salary&gt;15000;</span><br><span class="line">SELECT * FROM employees WHERE NOT(department_id&gt;=90 AND department_id&lt;=100) OR salary&gt;15000);</span><br><span class="line"></span><br><span class="line"># 模糊查询(一般和通配符搭配使用)</span><br><span class="line"># 通配符：</span><br><span class="line"># % 任意多个字符，包含0个字符</span><br><span class="line"># _ 任意单个字符</span><br><span class="line"></span><br><span class="line"># 名字中包含字符&#x27;a&#x27;的员工信息</span><br><span class="line">SELECT * FROM employees WHERE last_name LIKE &#x27;%a%&#x27;;</span><br><span class="line"></span><br><span class="line"># 名字中第三个字符为e，第五个字符为a的员工名字和工资</span><br><span class="line">SELECT last_name,salary FROM employees WHERE last_name LIKE &#x27;___e_a%&#x27;;</span><br><span class="line"></span><br><span class="line"># 名字中第二个字符为下划线的员工</span><br><span class="line">SELECT * FROM employees WHERE last_name LIKE &#x27;_\_%&#x27;;</span><br><span class="line"># 指定转移字符</span><br><span class="line">SELECT * FROM employees WHERE last_name LIKE &#x27;_$_%&#x27; ESCAPE &#x27;$&#x27;;</span><br><span class="line"></span><br><span class="line"># between and (包含临界值)</span><br><span class="line">SELECT * FROM employees WHERE department_id BETWEEN 90 AND 100;</span><br><span class="line"></span><br><span class="line"># IN 列表内不能使用通配符</span><br><span class="line">SELECT last_name,job_id FROM employees WHERE job_id IN(&#x27;IT_PROT&#x27;, &#x27;AD_VP&#x27;, &#x27;AD_PRES&#x27;);</span><br><span class="line"></span><br><span class="line"># IS NULL / IS NOT NULL （IS 不能代替&#x27;=&#x27;使用）</span><br><span class="line"># 没奖金的员工</span><br><span class="line">SELECT last_name,commission_pct FROM employees WHERE commission_pct IS NULL;</span><br><span class="line"># 有奖金的员工</span><br><span class="line">SELECT last_name,commission_pct FROM employees WHERE commission_pct IS NOT NULL;</span><br><span class="line"></span><br><span class="line"># 安全等于 &lt;=&gt;</span><br><span class="line"># 没奖金的员工</span><br><span class="line">SELECT last_name,commission_pct FROM employees WHERE commission_pct &lt;=&gt; NULL;</span><br><span class="line">SELECT last_name,salary FROM employees WHERE salary &lt;=&gt; 12000;</span><br></pre></td></tr></table></figure>

<h2 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">语法：SELECT 查询的东西 FROM 表名 WHERE 筛选条件 ORDER BY 排序的列表 ASC|DESC;</span><br><span class="line"></span><br><span class="line">ASC 代表升序</span><br><span class="line">DESC 代表降序</span><br><span class="line">默认不写代表升序</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"># 公司从高到低排序</span><br><span class="line">SELECT * FROM employees ORDER BY salary DESC;</span><br><span class="line"></span><br><span class="line"># 按年薪排序</span><br><span class="line">SELECT *,salary*12*(1+IFNULL(commission_pct,0)) AS 年薪 FROM employees ORDER BY salary*12*(1+IFNULL(commission_pct,0)) ASC;</span><br><span class="line"># 支持别名</span><br><span class="line">SELECT *,salary*12*(1+IFNULL(commission_pct,0)) AS 年薪 FROM employees ORDER BY 年薪 ASC;</span><br><span class="line"></span><br><span class="line"># 按名字长度排序</span><br><span class="line">SELECT LENGTH(last_name) AS 名字长度,last_name FROM employees ORDER BY 名字长度 DESC;</span><br><span class="line"></span><br><span class="line"># 先按工资排序，再按员工编号排序</span><br><span class="line">SELECT * FROM employees ORDER BY salary ASC,employee_id DESC;</span><br></pre></td></tr></table></figure>

<h1 id="3-单行函数"><a href="#3-单行函数" class="headerlink" title="(3) 单行函数"></a>(3) 单行函数</h1><blockquote>
<p>语法：SELECT 函数名(实参列表) FROM 表名;</p>
</blockquote>
<ol>
<li>字符函数<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># LENGTH() 返回字节长度</span><br><span class="line">SELECT LENGTH(&#x27;jhon&#x27;); # 返回4</span><br><span class="line">SELECT LENGTH(&#x27;张三&#x27;); # 返回6</span><br><span class="line">SELECT LENGTH(last_name) FROM employees;</span><br><span class="line"></span><br><span class="line"># CONCAT()</span><br><span class="line">SELECT CONCAT(last_name,first_name) FROM employees;</span><br><span class="line"></span><br><span class="line"># UPPER() LOWER()</span><br><span class="line">SELECT UPPER(&#x27;jhon&#x27;);</span><br><span class="line">SELECT CONCAT(UPPER(last_name),first_name) FROM employees;</span><br><span class="line"></span><br><span class="line"># SUBSTR() SUBSTRING()</span><br><span class="line">SELECT SUBSTR(&#x27;王二麻子&#x27;,2); #返回 二麻子，索引从1开始</span><br><span class="line"># 第三个参数指字符长度</span><br><span class="line">SELECT SUBSTR(&#x27;大河弯弯向东流&#x27;,3，2); # 返回 弯弯</span><br><span class="line"></span><br><span class="line"># INSTR()</span><br><span class="line">SELECT INSTR(&#x27;abcdefg&#x27;,bcd); #返回2，返回起始索引，第一次出现的索引，找不到返回0</span><br><span class="line"></span><br><span class="line">#TRIM()</span><br><span class="line">SELECT TRIM(&#x27;    张三 &#x27;);</span><br><span class="line">SELECT TRIM(&#x27;a&#x27; FROM &#x27;aaaaa张a三aaa&#x27;); # 返回 张a三</span><br><span class="line"></span><br><span class="line">#LPAD() RPAD() # 左填充，右填充，用指定字符填充到指定长度</span><br><span class="line">SELECT LPAD(&#x27;李二狗子&#x27;,10,&#x27;*&#x27;); # 最后总字符为10，</span><br><span class="line">SELECT LPAD(&#x27;李二狗子&#x27;,2,&#x27;*&#x27;); # 返回 李二</span><br><span class="line"></span><br><span class="line">#REPLACE()</span><br><span class="line">SELECT REPLACE(&#x27;李二狗子&#x27;,&#x27;二&#x27;，&#x27;三&#x27;); #返回 李三狗子</span><br></pre></td></tr></table></figure></li>
<li>数学函数<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ROUND() 四舍五入</span><br><span class="line">SELECT ROUND(1.45); #返回1</span><br><span class="line">SELECT ROUND(1.65); #返回2</span><br><span class="line">SELECT ROUND(-1.65); #返回-2</span><br><span class="line">SELECT ROUND(1.567，2); #返回1.57</span><br><span class="line"></span><br><span class="line"> #CEIL() 向上取整，返回&gt;=该参数的最小整数</span><br><span class="line">SELECT CEIL(1.02); #返回2</span><br><span class="line">SELECT CEIL(-1.02); #返回-1</span><br><span class="line"></span><br><span class="line">#FLOOR() 向下取整，返回&lt;=该参数的最大整数</span><br><span class="line">SELECT FLOOR(1.02); #返回1</span><br><span class="line">SELECT FLOOR(-1.02); #返回-2</span><br><span class="line"></span><br><span class="line">#TRUNCATE() 截断</span><br><span class="line">SELECT TRUNCATE(1.65，1); #小数点后保留1位，返回1.6</span><br><span class="line"></span><br><span class="line">#MOD() 取余 MOD(a,b) =&gt; a-a/b*b</span><br><span class="line">SELECT MOD(10,3); # 返回1</span><br></pre></td></tr></table></figure></li>
<li>日期函数<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># NOW() 返回系统时间</span><br><span class="line">SELECT NOW(); #返回 2021-01-31 12:02:29</span><br><span class="line"></span><br><span class="line"># CURDARE();</span><br><span class="line">SELECT CURDARE(); #返回 2021-01-31</span><br><span class="line"></span><br><span class="line"># CURTIME();</span><br><span class="line">SELECT CURTIME(); #返回 12:04:24</span><br><span class="line"></span><br><span class="line"># 获取日期指定部分</span><br><span class="line"># YEAR()  MONTH()  MONTHNAME() DAY()  HOUR() .....</span><br><span class="line">SELECT YEAR(NOW());</span><br><span class="line">SELECT YEAR(&#x27;2021-1-31&#x27;);</span><br><span class="line">SELECT YEAR(hiredate) FROM employees;</span><br><span class="line"></span><br><span class="line"># STR_TO_DATE() 将日期格式的字符转化成日期类型</span><br><span class="line">SELECT STR_TO_DATE(&#x27;9-13-2021&#x27;,&#x27;%m-%d-%Y&#x27;); # 返回 2021-09-13</span><br></pre></td></tr></table></figure>
<img src="/2021/02/11/mysql-note/img16.png"></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 通过日期查询</span><br><span class="line">SELECT * FROM employees WHERE hiredate = &#x27;2021-1-31&#x27;</span><br><span class="line">SELECT * FROM employees WHERE hiredate = STR_TO_DATE(&#x27;1-31 2021&#x27;,&#x27;%m-%d %Y&#x27;);</span><br><span class="line"></span><br><span class="line"># DATE_FORMAT()</span><br><span class="line">DATE_FORMAT(&#x27;2021.1.31&#x27;,&#x27;%Y年%m月%d日&#x27;)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>其他函数<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT VERSION();</span><br><span class="line">SELECT DATABASE();</span><br><span class="line">SELECT USER();</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>流程控制函数<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># IF(expr1,expr2,expr3); 表达式expr1成立返回expe2否则返回expr3</span><br><span class="line"></span><br><span class="line"># CASE 表达式</span><br><span class="line">CASE 要判断的字段或表达式</span><br><span class="line">WHEN 常量1 THEN 要显示的语句1或值1（语句后需要带分号 ;）</span><br><span class="line">WHEN 常量2 THEN 要显示的语句2或值2（语句后需要带分号 ;）</span><br><span class="line">WHEN 常量3 THEN 要显示的语句3或值3（语句后需要带分号 ;）</span><br><span class="line">ELSE 默认要显示的语句或值</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">SELECT salary AS 原始工资,department_id,</span><br><span class="line">CASE department_id</span><br><span class="line">WHEN 30 THEN salary*1.1</span><br><span class="line">WHEN 40 THEN salary*1.2</span><br><span class="line">WHEN 40 THEN salary*1.3</span><br><span class="line">ELSE salary</span><br><span class="line">END AS 新工资 FROM employees;</span><br><span class="line"></span><br><span class="line">CASE</span><br><span class="line">WHEN 条件1 THEN 要显示的语句1或值1（语句后需要带分号 ;）</span><br><span class="line">WHEN 条件2 THEN 要显示的语句2或值2（语句后需要带分号 ;）</span><br><span class="line">WHEN 条件3 THEN 要显示的语句3或值3（语句后需要带分号 ;）</span><br><span class="line">ELSE 默认要显示的语句或值</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">SELECT salary,</span><br><span class="line">CASE</span><br><span class="line">WHEN salary&gt;20000 THEN &#x27;A&#x27;</span><br><span class="line">WHEN salary&gt;15000 THEN &#x27;B&#x27;</span><br><span class="line">WHEN salary&gt;10000 THEN &#x27;C&#x27;</span><br><span class="line">ELSE &#x27;D&#x27;</span><br><span class="line">END AS 工资级别 FROM employees;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="4-分组函数"><a href="#4-分组函数" class="headerlink" title="(4) 分组函数"></a>(4) 分组函数</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT SUM(salary) FROM employees;</span><br><span class="line">SELECT AVG(salary) FROM employees;</span><br><span class="line">SELECT MAX(salary) FROM employees;</span><br><span class="line">SELECT MIN(salary) FROM employees;</span><br><span class="line">SELECT COUNT(salary) FROM employees; #非空值个数</span><br><span class="line"></span><br><span class="line">SELECT SUM(DISTINCT salary) FROM employees;</span><br><span class="line"></span><br><span class="line">SELECT COUNT(*) FROM employees; # 统计行数</span><br><span class="line">SELECT COUNT(1) FROM employees; # 统计行数</span><br><span class="line"></span><br><span class="line">SELECT DATEDIFF(&#x27;2021-2-11&#x27;,&#x27;2021-1-31&#x27;); # 日期之间相差天数</span><br></pre></td></tr></table></figure>

<h1 id="5-分组查询"><a href="#5-分组查询" class="headerlink" title="(5) 分组查询"></a>(5) 分组查询</h1><blockquote>
<p>语法：<br>SELECT column_name, function(column_name)<br>FROM table_name<br>WHERE column_name operator value<br>GROUP BY column_name;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT job_id, MAX(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY job_id;</span><br><span class="line"></span><br><span class="line">SELECT COUNT(*),location_id</span><br><span class="line">FROM departments</span><br><span class="line">GROUP BY location_id;</span><br><span class="line"></span><br><span class="line"># 分组前筛选</span><br><span class="line">SELECT department_id,AVG(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE email LIKE &#x27;%a%&#x27;</span><br><span class="line">GROUP BY department_id;</span><br><span class="line"></span><br><span class="line">SELECT MAX(salary),manager_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE commission_pct IS NOT NULL</span><br><span class="line">GROUP BY manager_id;</span><br><span class="line"></span><br><span class="line"># Q:哪个部门员工数&gt;2</span><br><span class="line"># 查询每个部门员工数</span><br><span class="line">SELECT COUNT(*),department_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id;</span><br><span class="line"></span><br><span class="line"># 分组之后再筛选</span><br><span class="line">SELECT COUNT(*),department_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING COUNT(*) &gt; 2;</span><br><span class="line"></span><br><span class="line"># 查询每个工种有奖金的员工且最高工资&gt;12000的工种编号和最高工资</span><br><span class="line">SELECT MAX(salary),job_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE commission_pct IS NOT NULL</span><br><span class="line">GRPOP BY job_id</span><br><span class="line">HAVING MAX(salary) &gt; 12000;</span><br><span class="line"></span><br><span class="line"># 查询领导编号&gt;102的每个领导手下员工最低工资&gt;5000的领导编号,以及其最低工资</span><br><span class="line">SELECT manager_id,MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE manager_id &gt; 102</span><br><span class="line">GROUP BY manager_id; </span><br><span class="line">HAVING MIN(salary) &gt; 5000;</span><br><span class="line"></span><br><span class="line"># 按函数分组</span><br><span class="line">SELECT COUNT(*) count,LENGTH(last_name) name</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY name</span><br><span class="line">HAVING count &gt; 5;</span><br><span class="line"></span><br><span class="line"># 按多个字段分组</span><br><span class="line"># 每个部门每个工种的平均工资 (部门和工种相同的为一组)</span><br><span class="line">SELECT AVG(salary),department_id,job_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id,job_id;</span><br></pre></td></tr></table></figure>

<h1 id="6-多表查询（连接查询-多表连接）"><a href="#6-多表查询（连接查询-多表连接）" class="headerlink" title="(6) 多表查询（连接查询/多表连接）"></a>(6) 多表查询（连接查询/多表连接）</h1><ul>
<li>年代：<pre><code>  sql92标准：仅支持内连接
  sql99标准：支持 内连接+外连接（左外、右外）+全外连接
</code></pre>
</li>
<li>功能：<br>  1、内连接<pre><code>  等值连接
  非等值连接
  自连接
</code></pre>
  2、外连接<pre><code>  左外连接
  右外连接
  全外连接
</code></pre>
  3、交叉连接</li>
</ul>
<h2 id="sql92"><a href="#sql92" class="headerlink" title="sql92"></a>sql92</h2><ul>
<li><p>等值连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查询男女对应的名字</span><br><span class="line">SELECT `name`,boyName</span><br><span class="line">FROM boys,beauty</span><br><span class="line">WHERE beauty.boyfriend_id = boys.id;</span><br><span class="line"></span><br><span class="line"># 查询员工名和对应的部门名</span><br><span class="line">SELECT last_name,department_name</span><br><span class="line">FROM employees,departments</span><br><span class="line">WHERE employees.department_id = departments.department_id;</span><br><span class="line"></span><br><span class="line"># 查询员工名，工种号，工种名(起别名，起别名后，原来的表名失效)</span><br><span class="line">SELECT last_name,e.job_id,job_title</span><br><span class="line">FROM employees AS e,jobs AS j</span><br><span class="line">WHERE e.job_id = j.job_id;</span><br><span class="line"></span><br><span class="line"># 加入筛选</span><br><span class="line">SELECT last_name,department_name</span><br><span class="line">FROM employees AS e,departments AS d</span><br><span class="line">WHERE e.department_id = d.department_id</span><br><span class="line">AND e.department_id ID NOT NULL;</span><br><span class="line"></span><br><span class="line"># 三表查询</span><br><span class="line">SELECT last_name,department_name,city</span><br><span class="line">FROM employees AS e,departments AS d,locations AS l</span><br><span class="line">WHERE e.department_id = d.department_id</span><br><span class="line">AND d.location_id = l.location_id;</span><br></pre></td></tr></table></figure></li>
<li><p>非等值连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查询员工工资和工资级别</span><br><span class="line">SELECT salary,grade_level</span><br><span class="line">FROM employees e,job_grades g</span><br><span class="line">WHERE salary BETWEEN g.lowest_sal AND g.highest_sal;</span><br></pre></td></tr></table></figure></li>
<li><p>自连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查询员工名以及他上级名称</span><br><span class="line">SELECT e.employee_id,e.last_name,m.employee_id,m.last_name</span><br><span class="line">FROM employees e,employees m,</span><br><span class="line">WHERE e.manager_id = m.employee_id;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="sql99"><a href="#sql99" class="headerlink" title="sql99"></a>sql99</h2><ul>
<li>语法：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT 查询列表</span><br><span class="line">FROM 表1 别名 [连接类型] 表2 别名</span><br><span class="line">ON 连接条件</span><br><span class="line">[WHERE 筛选条件]</span><br><span class="line">[GROUP BY 分组]</span><br><span class="line">[HAVING 筛选条件]</span><br><span class="line">[ORDER BY 排序列表]</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><blockquote>
<p>INNER JOIN（内连接,或等值连接）：获取两个表中字段匹配关系的记录。</p>
</blockquote>
<ul>
<li><p>等值连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查询员工名和部门名</span><br><span class="line">SELECT last_name,department_name</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN departments AS d</span><br><span class="line">ON e.department_id = d.department_id;</span><br><span class="line"></span><br><span class="line"># 名字中包含e的员工名和工种名</span><br><span class="line">SELECT last_name,job_name</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN jobs AS j</span><br><span class="line">ON e.job_id = j.job_id</span><br><span class="line">WHERE e.last_name LIKE &#x27;%e%&#x27;;</span><br><span class="line"></span><br><span class="line"># 部门个数&gt;3的城市名和部门个数</span><br><span class="line">SELECT city,COUNT(*)</span><br><span class="line">FROM locations AS l</span><br><span class="line">INNER JOIN departments AS d</span><br><span class="line">ON l.location_id = d.location_id</span><br><span class="line">GROUP BY city</span><br><span class="line">HAVING COUNT(*) &gt; 3;</span><br><span class="line"></span><br><span class="line"># 查询哪个部门的员工个数&gt;3的部门名和员工个数，并按个数降序</span><br><span class="line">SELECT department_name,COUNT(*)</span><br><span class="line">FROM departments AS d</span><br><span class="line">INNER JOIN employees AS e</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">GROUP BY department_name</span><br><span class="line">HAVING COUNT(*) &gt; 3</span><br><span class="line">ORDER BY COUNT(*) DESC;</span><br><span class="line"></span><br><span class="line"># 查询员工名、部门名、工种名，并按照部门名降序</span><br><span class="line">SELECT last_name,department_name,job_title</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN departments AS d ON d.department_id = e.department_id</span><br><span class="line">INNER JOIN jobs AS j ON j.job_id = e.job_id</span><br><span class="line">ORDER BY department_name DESC;</span><br></pre></td></tr></table></figure></li>
<li><p>非等值连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT salary,grade_level</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN job_grades AS g</span><br><span class="line">ON e.salary BETWEEN g.lowest_sal AND g.highest_sal;</span><br></pre></td></tr></table></figure></li>
<li><p>自连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查询员工名字和上级名字</span><br><span class="line">SELECT e.last_name,m.last_name</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN employees AS m</span><br><span class="line">ON e.manager_id = m.employee_id;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><blockquote>
<p>LEFT [OUTER] JOIN（左连接）：获取左表所有记录，即使右表没有对应匹配的记录。<br>RIGHT [OUTER] JOIN（右连接）： 与 LEFT JOIN 相反，用于获取右表所有记录，即使左表没有对应匹配的记录。<br>FULL [OUTER] JOIN</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 左连接</span><br><span class="line"># 查询没男朋友的女生</span><br><span class="line">SELECT b.*,bo.id</span><br><span class="line">FROM beauty AS b</span><br><span class="line">LEFT OUTER JOIN boys AS bo</span><br><span class="line">ON b.boyfriend_id = bo.id</span><br><span class="line">WHERE  bo.id IS NULL;</span><br><span class="line"></span><br><span class="line"># 左连接</span><br><span class="line"># 查询哪个部门没有员工</span><br><span class="line">SELECT d.*,e.employee_id</span><br><span class="line">FROM departments AS d</span><br><span class="line">LEFT OUTER JOIN employees AS e</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">WHERE d.employee_id IS NULL;</span><br><span class="line"></span><br><span class="line"># 右连接</span><br><span class="line"># 查询哪个部门没有员工</span><br><span class="line">SELECT d.*,e.employee_id</span><br><span class="line">FROM employees AS e</span><br><span class="line">RIGHT OUTER JOIN departments AS d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">WHERE d.employee_id IS NULL;</span><br><span class="line"></span><br><span class="line"># 交叉连接</span><br><span class="line">SELECT b.*,bo.*</span><br><span class="line">FROM boys AS bo</span><br><span class="line">CROSS OUTER JOIN beauty AS b;</span><br><span class="line"></span><br><span class="line">eg.</span><br><span class="line"># 查询编号&gt;3的女生所对应男生信息</span><br><span class="line">SELECT b.*,bo,id</span><br><span class="line">FROM beauty AS b</span><br><span class="line">LEFT OUTER JOIN boys AS bo</span><br><span class="line">ON b.boyfrienf_id = b.id</span><br><span class="line">WHERE b.id &gt; 3;</span><br><span class="line"></span><br><span class="line"># 查询哪个城市没有部门</span><br><span class="line">SELECT city,d.department_id</span><br><span class="line">FROM locations AS l</span><br><span class="line">LEFT OUTER JOIN departments AS d</span><br><span class="line">ON l.location_id = d.location_id</span><br><span class="line">WHERE d.department_id IS NULL;</span><br><span class="line"></span><br><span class="line"># 查询[部门名]为SAL和IT的员工信息</span><br><span class="line">SELECT e.*,department_name</span><br><span class="line">FROM employees AS e</span><br><span class="line">RIGHT JOIN departments AS d</span><br><span class="line">ON e.department_id = d.department_id</span><br><span class="line">WHERE department_name IN(&#x27;SAL&#x27;,&#x27;IT&#x27;);</span><br></pre></td></tr></table></figure>

<h1 id="7-子查询（内查询）"><a href="#7-子查询（内查询）" class="headerlink" title="(7) 子查询（内查询）"></a>(7) 子查询（内查询）</h1><blockquote>
<p>出现在其他语句中的SELECT语句，叫做子查询或者内查询。<br>外部的查询叫做主查询或外查询。<br>子查询可以在使用表达式的任何地方使用，并且必须在括号中关闭。</p>
</blockquote>
<h4 id="WHERE子句中（1）"><a href="#WHERE子句中（1）" class="headerlink" title="WHERE子句中（1）"></a>WHERE子句中（1）</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 在位于美国(USA)的办公室工作的员工。</span><br><span class="line">SELECT </span><br><span class="line">    lastName, firstName</span><br><span class="line">FROM</span><br><span class="line">    employees</span><br><span class="line">WHERE</span><br><span class="line">    officeCode IN (SELECT </span><br><span class="line">            officeCode</span><br><span class="line">        FROM</span><br><span class="line">            offices</span><br><span class="line">        WHERE</span><br><span class="line">            country = &#x27;USA&#x27;);</span><br><span class="line"></span><br><span class="line"># 查询找到其付款大于平均付款的客户</span><br><span class="line">SELECT </span><br><span class="line">    customerNumber, checkNumber, amount</span><br><span class="line">FROM</span><br><span class="line">    payments</span><br><span class="line">WHERE</span><br><span class="line">    amount &gt; (SELECT </span><br><span class="line">            AVG(amount)</span><br><span class="line">        FROM</span><br><span class="line">            payments);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查找没有下过任何订单的客户</span><br><span class="line">SELECT </span><br><span class="line">    customerName</span><br><span class="line">FROM</span><br><span class="line">    customers</span><br><span class="line">WHERE</span><br><span class="line">    customerNumber NOT IN (SELECT DISTINCT</span><br><span class="line">            customerNumber</span><br><span class="line">        FROM</span><br><span class="line">            orders);</span><br></pre></td></tr></table></figure>

<h4 id="FROM子句中（1）"><a href="#FROM子句中（1）" class="headerlink" title="FROM子句中（1）"></a>FROM子句中（1）</h4><blockquote>
<p>从子查询返回的结果集将用作临时表,该表称为派生表或物化子查询。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查询将查找订单表中的最大，最小和平均数</span><br><span class="line">SELECT </span><br><span class="line">    MAX(items), MIN(items), FLOOR(AVG(items))</span><br><span class="line">FROM</span><br><span class="line">    (SELECT </span><br><span class="line">        orderNumber, COUNT(orderNumber) AS items</span><br><span class="line">    FROM</span><br><span class="line">        orderdetails</span><br><span class="line">    GROUP BY orderNumber) AS lineitems;</span><br></pre></td></tr></table></figure>
<p>以上sql语句来自<a href="https://www.yiibai.com/mysql/subquery.html">易百教程</a></p>
<h4 id="WHERE子句中（2）"><a href="#WHERE子句中（2）" class="headerlink" title="WHERE子句中（2）"></a>WHERE子句中（2）</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 谁的工资比Abel高</span><br><span class="line">SELECT  *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &gt; (</span><br><span class="line">    SELECT salary</span><br><span class="line">    FROM employees AS e</span><br><span class="line">    WHERE e.last_name = &#x27;Abel&#x27;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 返回job_id与141号员工相同，salary比143号员工多的员工姓名，job_id,和工资</span><br><span class="line">SELECT last_name,job_id,salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id = (</span><br><span class="line">    SELECT job_id</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE employee_id = &#x27;141&#x27;</span><br><span class="line">)</span><br><span class="line">AND salary &gt; (</span><br><span class="line">    SELECT salary</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE employee_id = &#x27;143&#x27;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 返回公司工资最少的员工的last_name，job_id，salary</span><br><span class="line">SELECT last_name,job_id,salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary = (</span><br><span class="line">    SELECT MIN(salary)</span><br><span class="line">    FROM employees</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 最低工资大于50号部门最低工资的部门id和其最低工资</span><br><span class="line"></span><br><span class="line"># 错误语句</span><br><span class="line">SELECT department_id,MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE MIN(salary) &gt; (</span><br><span class="line">    SELECT MIN(salary)</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE department_id = &#x27;50&#x27;</span><br><span class="line">);</span><br><span class="line"># 正确语句</span><br><span class="line">SELECT department_id,MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING MIN(salary) &gt; (</span><br><span class="line">    SELECT MIN(salary)</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE department_id = &#x27;50&#x27;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>where 子句的作用是对查询结果进行分组前，将不符合where条件的行去掉，即在分组之前过滤数据，where条件中不能包含聚组函数，使用where条件过滤出特定的行。<br>having 子句的作用是筛选满足条件的组，即在分组之后过滤数据，条件中经常包含聚组函数，使用having 条件过滤出特定的组，也可以使用多个分组标准进行分组。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 返回location_id是1400和1700部门中所有员工姓名</span><br><span class="line">SELECT last_name</span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id IN(</span><br><span class="line">    SELECT department_id</span><br><span class="line">    FROM departments</span><br><span class="line">    WHERE location_id = 1400</span><br><span class="line">    OR location_id = 1700</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 返回其他工种中比job_id为&#x27;IT_PROG&#x27;的部门任意工资低的员工的工号，姓名，job_id，salary</span><br><span class="line">SELECT last_name,job_id,salary,employee_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &lt; ANY(</span><br><span class="line">    SELECT salary</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE job_id = &#x27;IT_PROG&#x27;</span><br><span class="line">)</span><br><span class="line">AND job_id &lt;&gt; &#x27;IT_PROG&#x27;;</span><br><span class="line"># 或者</span><br><span class="line">SELECT last_name,job_id,salary,employee_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &lt; MAX(</span><br><span class="line">    SELECT salary</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE job_id = &#x27;IT_PROG&#x27;</span><br><span class="line">)</span><br><span class="line">AND job_id &lt;&gt; &#x27;IT_PROG&#x27;;</span><br><span class="line"></span><br><span class="line"># 返回其他部门中比job_id为&#x27;IT_PORG&#x27;的部门所有工资都低的员工的工号，姓名，job_id，salary</span><br><span class="line">SELECT last_name,job_id,salary,employee_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &lt; ALL(</span><br><span class="line">    SELECT salary</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE job_id = &#x27;IT_PROG&#x27;</span><br><span class="line">)</span><br><span class="line">AND job_id &lt;&gt; &#x27;IT_PROG&#x27;;</span><br><span class="line">#或者</span><br><span class="line">SELECT last_name,job_id,salary,employee_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &lt; (</span><br><span class="line">    SELECT MIN(salary)</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE job_id = &#x27;IT_PROG&#x27;</span><br><span class="line">)</span><br><span class="line">AND job_id &lt;&gt; &#x27;IT_PROG&#x27;;</span><br><span class="line"></span><br><span class="line"># 查询员工编号最小而且工资最高的员工信息</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE employee_id = (</span><br><span class="line">    SELECT MIN(employee_id)</span><br><span class="line">    FROM employees</span><br><span class="line">)</span><br><span class="line">AND salary = (</span><br><span class="line">    SELECT MAX(salary)</span><br><span class="line">    FROM employees</span><br><span class="line">);</span><br><span class="line"># 或者</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE (employee_id,salary) = (</span><br><span class="line">    SELECT MIN(employee_id),MAX(salary)</span><br><span class="line">    FROM employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="SELECT子句中"><a href="#SELECT子句中" class="headerlink" title="SELECT子句中"></a>SELECT子句中</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查询每个部门员工个数</span><br><span class="line">SELECT d.*,(</span><br><span class="line">    SELECT COUNT(*)</span><br><span class="line">    FROM employees AS e</span><br><span class="line">    WHERE e.department_id = d.department_id</span><br><span class="line">) AS 员工个数</span><br><span class="line">FROM departments AS d;</span><br></pre></td></tr></table></figure>

<h4 id="FROM子句中（2）"><a href="#FROM子句中（2）" class="headerlink" title="FROM子句中（2）"></a>FROM子句中（2）</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 每个部门平均工资的工资等级</span><br><span class="line">SELECT *,g.level</span><br><span class="line">FROM (</span><br><span class="line">    SELECT AVG(salary) AS avg,department_id</span><br><span class="line">    FROM employees AS e</span><br><span class="line">    GROUP BY e.department_id</span><br><span class="line">) AS ag_dep</span><br><span class="line">INNER JOIN job_grades AS g</span><br><span class="line">ON ag_dep.avg</span><br><span class="line">BETWEEN g.lowest_sal</span><br><span class="line">AND g.heigth_sal;</span><br><span class="line"></span><br><span class="line"># 比较</span><br><span class="line">SELECT *,g.level</span><br><span class="line">FROM (</span><br><span class="line">    SELECT AVG(salary) AS avg,department_id</span><br><span class="line">    FROM employees AS e</span><br><span class="line">    GROUP BY e.department_id</span><br><span class="line">) AS ag_dep</span><br><span class="line">LEFT OUTER JOIN job_grades AS g</span><br><span class="line">ON ag_dep.avg</span><br><span class="line">BETWEEN g.lowest_sal</span><br><span class="line">AND g.heigth_sal;</span><br></pre></td></tr></table></figure>

<h4 id="EXISTS子句中（相关子查询）"><a href="#EXISTS子句中（相关子查询）" class="headerlink" title="EXISTS子句中（相关子查询）"></a>EXISTS子句中（相关子查询）</h4><blockquote>
<p>判断子查询中有没有值</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT EXISTS(</span><br><span class="line">    SELECT * FROM employees</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 查询有员工的部门名</span><br><span class="line">SELECT department_name</span><br><span class="line">FROM departments AS d</span><br><span class="line">WHERE (</span><br><span class="line">    SELECT *</span><br><span class="line">    FROM employees AS e</span><br><span class="line">    WHERE e.department_id = d.department_id</span><br><span class="line">);</span><br><span class="line"># 或者</span><br><span class="line">SELECT department_name</span><br><span class="line">FROM departments AS d</span><br><span class="line">WHERE d.department_id IN(</span><br><span class="line">    SELECT e.department_id</span><br><span class="line">    FROM employees AS e</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="子查询景点场景"><a href="#子查询景点场景" class="headerlink" title="子查询景点场景"></a>子查询景点场景</h2><ol>
<li>查询工资最低的员工信息<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary = (</span><br><span class="line">    SELECT MIN(salary)</span><br><span class="line">    FROM employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>查询平均工资最低的部门信息<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT d.*</span><br><span class="line">FROM departments AS d</span><br><span class="line">WHERE d.department_id = (</span><br><span class="line">    SELECT department_id</span><br><span class="line">    FROM employees</span><br><span class="line">    GROUP BY department_id</span><br><span class="line">    HAVING AVG(salary) = (</span><br><span class="line">        SELECT MIN(ag)</span><br><span class="line">        FROM (</span><br><span class="line">            SELECT AVG(salary) AS ag,department_id</span><br><span class="line">            FROM employees</span><br><span class="line">            GROUP BY department_id</span><br><span class="line">        ) AS ag_dep</span><br><span class="line">    ) </span><br><span class="line">);</span><br><span class="line"># 或者</span><br><span class="line">SELECT *</span><br><span class="line">FROM departments</span><br><span class="line">WHERE department_id = (</span><br><span class="line">    SELECT department_id</span><br><span class="line">    FROM employees</span><br><span class="line">    GROUP BY department_id</span><br><span class="line">    ORDER BY AVG(salary) ASC</span><br><span class="line">    LIMIT 0,1</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>查询平均工资最低的部门信息和该部门平均工资<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT d.*,ag</span><br><span class="line">FROM departments AS d</span><br><span class="line">JOIN (</span><br><span class="line">    SELECT AVG(salary) AS ag,department_id</span><br><span class="line">    FROM employees</span><br><span class="line">    GROUP BY department_id</span><br><span class="line">    ORDER BY AVG(salary) ASC</span><br><span class="line">    LIMIT 0,1</span><br><span class="line">) AS ag_dep</span><br><span class="line">ON d.department_id = ag_dep.department_id;</span><br></pre></td></tr></table></figure></li>
<li>查询平均工资最高的job信息 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM jobs</span><br><span class="line">WHERE job_id = (</span><br><span class="line">    SELECT  job_id</span><br><span class="line">    FROM employees</span><br><span class="line">    GROUP BY job_id</span><br><span class="line">    ORDER BY AVG(salary) DESC</span><br><span class="line">    LIMIT 0,1</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>查询平均工资高于公司平均工资的部门<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT AVG(salary),department_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING AVG(salary) &gt; (</span><br><span class="line">    SELECT AVG(salary)</span><br><span class="line">    FROM employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>查询公司所有manager的详细信息<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE employee_id IN(</span><br><span class="line">    SELECT DISTINCT manager_id</span><br><span class="line">    FROM employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>查询各部门中最高工资 中最低的那个部门，最低工资<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select MIN(salary),department_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id = (</span><br><span class="line">    SELECT department_id</span><br><span class="line">    FROM employees</span><br><span class="line">    GROUP BY department_id</span><br><span class="line">    ORDER BY MAX(salary) ASC</span><br><span class="line">    LINIT 0,1</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>查询平均工资最高的部门的manager详细信息<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN departments AS d</span><br><span class="line">ON e.employee_id = d.manager_id</span><br><span class="line">WHERE d.department_id = (</span><br><span class="line">    SELECT department_id</span><br><span class="line">    FROM employees</span><br><span class="line">    GROUP BY department_id</span><br><span class="line">    ORDER BY AVG(salary) DESC</span><br><span class="line">    LIMIT 0,1</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="8-分页查询"><a href="#8-分页查询" class="headerlink" title="(8) 分页查询"></a>(8) 分页查询</h1><blockquote>
<p>SELECT * FROM 表 LIMIT (page - 1) * size, size;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查询前五条员工信息</span><br><span class="line">SELECT * FROM employees LIMIT 0, 5;</span><br><span class="line"></span><br><span class="line"># 查询11-25条员工信息</span><br><span class="line">SELECT * FROM employees LIMIT 10, 15;</span><br><span class="line"></span><br><span class="line"># 有奖金的员工信息，工资较高的前10名</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE commission_pct IS NOT NULL</span><br><span class="line">ORDER BY salary DESC</span><br><span class="line">LIMIT 0, 10; </span><br></pre></td></tr></table></figure>

<h1 id="9-联合查询"><a href="#9-联合查询" class="headerlink" title="(9) 联合查询"></a>(9) 联合查询</h1><blockquote>
<p>将多条语句的查询结果合并成一个结果，多用于多个表没有连接关系时使用<br>要求多条语句查询列数一样，顺序一样，会去掉重复项目，不去重使用<code>UNION ALL </code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 部门编号&gt;90或者邮箱中包含a的员工信息</span><br><span class="line"># 普通查询</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE email LIKE &#x27;%a%&#x27;</span><br><span class="line">OR department_id &gt; 90;</span><br><span class="line"></span><br><span class="line"># 联合查询</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE email LIKE &#x27;%a%&#x27;</span><br><span class="line">UNION</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id &gt; 90;</span><br></pre></td></tr></table></figure>

<h1 id="10-插入语句"><a href="#10-插入语句" class="headerlink" title="(10) 插入语句"></a>(10) 插入语句</h1><blockquote>
<p>语法1：<br>INSERT INTO table_name ( field1, field2,…fieldN )<br>VALUES<br>( value1, value2,…valueN );</p>
</blockquote>
<blockquote>
<p>语法2：<br>INSERT INTO table_name<br>SET<br>field1 = value1, field2 = value2,… fieldN = valueN;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO boys</span><br><span class="line">SET id=19,name=&#x27;Kavan&#x27;,phone=&#x27;180xxxxxxxx&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>语法1 支持插入多条数据</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO beauty</span><br><span class="line">VALUES(13,&#x27;小唐&#x27;,&#x27;女&#x27;,&#x27;1990-4-23&#x27;,&#x27;18888888888&#x27;,NULL,2),</span><br><span class="line">(14,&#x27;小张&#x27;,&#x27;女&#x27;,&#x27;1991-4-23&#x27;,&#x27;18988888888&#x27;,NULL,2);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>语法1 支持子查询</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO beauty(id,name,phone)</span><br><span class="line">SELECT 26,&#x27;小宋&#x27;,&#x27;15888888888&#x27;;</span><br><span class="line"></span><br><span class="line">INSERT INTO beauty(id,name,phone)</span><br><span class="line">SELECT id,name,phone</span><br><span class="line">FROM boys</span><br><span class="line">WHERE id=26;</span><br></pre></td></tr></table></figure>

<h1 id="11-更新语句"><a href="#11-更新语句" class="headerlink" title="(11) 更新语句"></a>(11) 更新语句</h1><blockquote>
<p>语法：<br>UPDATE table_name SET field1=new-value1, field2=new-value2<br>[WHERE Clause]</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 修改beauty表中姓唐的女生电话为15888888888</span><br><span class="line">UPDATE beauty</span><br><span class="line">SET phone=&#x27;15888888888&#x27;</span><br><span class="line">WHERE name LIKE &#x27;唐%&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多表更新<br>语法：<br>UPDATE table_1<br>INNER ｜ LEFT ｜ RIGHT JOIN  table_2<br>ON 连接条件<br>SET field1=new-value1, field2=new-value2<br>[WHERE Clause]</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 修改张无忌女友手机号18989898989</span><br><span class="line">UPDATE boys AS b</span><br><span class="line">INNER JOIN beauty AS bu</span><br><span class="line">ON bu.boyfriend_id = b.id</span><br><span class="line">SET bu.phone = &#x27;18989898989&#x27;</span><br><span class="line">WHERE b.name = &#x27;张无忌&#x27;;</span><br><span class="line"></span><br><span class="line"># 修改没有男友的女生的男友编号为张飞</span><br><span class="line">UPDATE boys AS b</span><br><span class="line">RIGHT JOIN beauty AS bu</span><br><span class="line">ON bo.boyfriend_id = b.id</span><br><span class="line">SET bu.boyfriend_id = 2</span><br><span class="line">WHERE b.id IS NULL;</span><br></pre></td></tr></table></figure>

<h1 id="12-删除语句"><a href="#12-删除语句" class="headerlink" title="(12) 删除语句"></a>(12) 删除语句</h1><blockquote>
<p>语法1：<br>DELETE FROM table_name [WHERE Clause];</p>
</blockquote>
<blockquote>
<p>多表删除<br>语法：<br>DELETE 表一的别名，表二的别名<br>FROM 表一 AS 别名<br>INNER ｜ LEFT ｜ RIGHT JOIN 表二 AS 别名<br>ON 连接条件<br>WHERE 筛选条件;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 删除张无忌女友信息</span><br><span class="line">DELETE b</span><br><span class="line">FROM boys AS b</span><br><span class="line">INNER JOIN beauty AS bu</span><br><span class="line">ON bu.boyfriend_id = b.id</span><br><span class="line">WHERE b.boyName = &#x27;张无忌&#x27;;</span><br><span class="line"></span><br><span class="line"># 删除黄晓明以及其女友记录</span><br><span class="line">DELETE b,bu</span><br><span class="line">FROM boys AS b</span><br><span class="line">INNER JOIN beauty AS bu</span><br><span class="line">ON bu.boyfriend_id = b.id</span><br><span class="line">WHERE b.boyName = &#x27;黄晓明&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>语法2：(自增长列归位，相当于刚创建的空表，删除语句没有返回值，删除后不能回滚)<br>TRUNCATE TABLE table_name;</p>
</blockquote>
<h1 id="13-表和库的管理"><a href="#13-表和库的管理" class="headerlink" title="(13) 表和库的管理"></a>(13) 表和库的管理</h1><blockquote>
<p>操作<br>创建：CREATE<br>修改：ALTER<br>删除：DROP</p>
</blockquote>
<h2 id="库"><a href="#库" class="headerlink" title="库"></a>库</h2><ul>
<li><p>创建</p>
<blockquote>
<p>CREATE DATABASE database_name;<br>创建之前加判断<br>CREATE DATABASE IF NOT EXISTS database_name;</p>
</blockquote>
</li>
<li><p>修改<br>一般不修改，之前有个RENAME关键字修改数据库名字，后来由于安全原因废弃了，可以直接到数据库存储文件位置修改文件夹名字</p>
</li>
</ul>
<blockquote>
<p>改数据库的字符集<br>ALTER DATABASE database_name CHARACTER SET gbk;</p>
</blockquote>
<ul>
<li>删除<blockquote>
<p>DROP DATABASE database_name;<br>删除之前判断<br>DROP IF EXISTS database_name;</p>
</blockquote>
</li>
</ul>
<h2 id="表"><a href="#表" class="headerlink" title="表"></a>表</h2><ul>
<li>创建<blockquote>
<p>CREATE TABLE table_name (column_name column_type []);</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE book(</span><br><span class="line">    id INT,</span><br><span class="line">    bname VARCHAR(20),</span><br><span class="line">    price DOUBLE,</span><br><span class="line">    authorId INT,</span><br><span class="line">    publishDate DATETIME,</span><br><span class="line">);</span><br><span class="line"># 或者</span><br><span class="line">CREATE TABLE IF NOT EXISTS book(</span><br><span class="line">    id INT,</span><br><span class="line">    bname VARCHAR(20),</span><br><span class="line">    price DOUBLE,</span><br><span class="line">    authorId INT,</span><br><span class="line">    publishDate DATETIME,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE author(</span><br><span class="line">    id INT,</span><br><span class="line">    au_name VARCHAR(20),</span><br><span class="line">    nation VARCHAR(10)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>修改<blockquote>
<p>可以修改列名，类型，约束，添加列，删除列，修改表名</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 修改列名</span><br><span class="line">ALTER TABLE book CHANGE COLUMN publishDate pubDate DATETIME;</span><br><span class="line"></span><br><span class="line"># 修改列的类型</span><br><span class="line">ALTER TABLE book MODIFY COLUMN pubDate TIMESTAMP;</span><br><span class="line"></span><br><span class="line"># 添加新列</span><br><span class="line">ALTER TABLE author ADD COLUMN annual DOUBLE;</span><br><span class="line"># 插入第一列</span><br><span class="line">ALTER TABLE author ADD COLUMN annual DOUBLE FIRST;</span><br><span class="line"># 在某一列后面插入</span><br><span class="line">ALTER TABLE author ADD COLUMN annual DOUBLE AFTER au_name;</span><br><span class="line"></span><br><span class="line"># 删除列</span><br><span class="line">ALTER TABLE author DROP COLUMN annual;</span><br><span class="line"></span><br><span class="line"># 修改表名</span><br><span class="line">ALTER TABLE author RENAME TO book_author;</span><br></pre></td></tr></table></figure></li>
<li>删除<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DROP TABLE book_author;</span><br><span class="line"></span><br><span class="line"># 删除之前判断</span><br><span class="line">DROP TABLE IF EXISTS book_author;</span><br></pre></td></tr></table></figure></li>
<li>复制</li>
</ul>
<ol>
<li>仅复制表结构<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE copy_author LIKE author;</span><br></pre></td></tr></table></figure></li>
<li>复制结构和数据<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE copy_author2</span><br><span class="line">SELECT * FROM author;</span><br></pre></td></tr></table></figure></li>
<li>复制结构和部分数据<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE copy_author3</span><br><span class="line">SELECT id,au_name</span><br><span class="line">FROM author</span><br><span class="line">WHERE nation = &#x27;中国&#x27;;</span><br></pre></td></tr></table></figure></li>
<li>仅复制部分结构<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE copy_author4</span><br><span class="line">SELECT id,au_name</span><br><span class="line">FROM author</span><br><span class="line">WHERE 1=2;</span><br><span class="line"># 或者</span><br><span class="line">CREATE TABLE copy_author4</span><br><span class="line">SELECT id,au_name</span><br><span class="line">FROM author</span><br><span class="line">WHERE 0;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="14-约束"><a href="#14-约束" class="headerlink" title="(14) 约束"></a>(14) 约束</h1><blockquote>
<p>约束是一种限制，为了保证表中数据准确可靠</p>
</blockquote>
<h2 id="六种约束"><a href="#六种约束" class="headerlink" title="六种约束"></a>六种约束</h2><ol>
<li>NOT NULL：非空，用于保证该字段值不能为空</li>
<li>DEFAULT：默认，用于保证该字段有默认值</li>
<li>PRIMARY KEY：主键，保证该字段的值唯一且非空</li>
<li>UNIQUE：唯一，用于保证该字段值唯一，可以为空</li>
<li>CHECK：检查约束，mysql不支持</li>
<li>FOREIGN KEY：外键，用于限制两个表的关系，保证该字段的值必须来自主表关联列的值，在从表添加外键约束，用于引用主表中某列的值</li>
</ol>
<blockquote>
<p>约束在创建表和修改表是可以使用</p>
</blockquote>
<blockquote>
<p>关于主键和唯一的比较：<br><img src="/2021/02/11/mysql-note/img17.png" alt="主键和唯一的比较"></p>
</blockquote>
<blockquote>
<p>外键：</p>
<ol>
<li>须在从表设置外键关系</li>
<li>从表外键列的类型和主表关联列类型一致或兼容</li>
<li>主表中关联列必须是一个key（一般是主键或唯一）</li>
<li>插入数据时，先插入主表再插入从表，删除数据时，先删除从表再删除主表</li>
</ol>
</blockquote>
<h2 id="列级约束"><a href="#列级约束" class="headerlink" title="列级约束"></a>列级约束</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE DATABASE students;</span><br><span class="line"></span><br><span class="line">CREATE TABLE stuinfo (</span><br><span class="line">	id INT PRIMARY KEY,#主键</span><br><span class="line">	stuName VARCHAR ( 20 ) NOT NULL,#非空</span><br><span class="line">	gender CHAR ( 1 ) CHECK ( gender = &#x27;男&#x27; OR gender = &#x27;女&#x27; ),#检查</span><br><span class="line">	seat INT UNIQUE,#唯一</span><br><span class="line">	age INT DEFAULT 18,#默认约束</span><br><span class="line">	majorId INT REFERENCES major ( id ) #外键，对列级约束没作用</span><br><span class="line">	</span><br><span class="line">);</span><br><span class="line">CREATE TABLE major (</span><br><span class="line">	id INT PRIMARY KEY,</span><br><span class="line">    majorName VARCHAR ( 20 ) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">DESC stuinfo;</span><br></pre></td></tr></table></figure>

<h2 id="表级约束"><a href="#表级约束" class="headerlink" title="表级约束"></a>表级约束</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DROP TABLE IF EXISTS stuinfo;</span><br><span class="line">CREATE TABLE stuinfo (</span><br><span class="line">	id INT,</span><br><span class="line">	stuName VARCHAR ( 20 ),</span><br><span class="line">	gender CHAR ( 1 ),</span><br><span class="line">	seat INT,</span><br><span class="line">	age INT,</span><br><span class="line">	majorId INT,</span><br><span class="line">	CONSTRAINT pk PRIMARY KEY ( id ),#主键</span><br><span class="line">	CONSTRAINT uq UNIQUE ( seat ),#唯一键</span><br><span class="line">	CONSTRAINT ck CHECK ( gender = &#x27;男&#x27; OR gender = &#x27;女&#x27; ),#检查</span><br><span class="line">	CONSTRAINT fk_stuinfo_major FOREIGN KEY ( majorId ) REFERENCES major ( id ) #外键</span><br><span class="line"></span><br><span class="line">);</span><br><span class="line">SHOW INDEX FROM stuinfo;</span><br><span class="line"></span><br><span class="line"># 或者</span><br><span class="line">DROP TABLE IF EXISTS stuinfo;</span><br><span class="line">CREATE TABLE stuinfo (</span><br><span class="line">	id INT,</span><br><span class="line">	stuName VARCHAR ( 20 ),</span><br><span class="line">	gender CHAR ( 1 ),</span><br><span class="line">	seat INT,</span><br><span class="line">	age INT,</span><br><span class="line">	majorId INT,</span><br><span class="line">	PRIMARY KEY ( id ),#主键</span><br><span class="line">	UNIQUE ( seat ),#唯一键</span><br><span class="line">	CHECK ( gender = &#x27;男&#x27; OR gender = &#x27;女&#x27; ),#检查</span><br><span class="line">	FOREIGN KEY ( majorId ) REFERENCES major ( id ) #外键</span><br><span class="line"></span><br><span class="line">);</span><br><span class="line">SHOW INDEX FROM stuinfo;</span><br><span class="line"></span><br><span class="line"># 一般写法</span><br><span class="line">CREATE TABLE IF NOT EXISTS stuinfo (</span><br><span class="line">	id INT PRIMARY KEY,#主键</span><br><span class="line">	stuName VARCHAR ( 20 ) NOT NULL,#非空</span><br><span class="line">	gender CHAR ( 1 ) CHECK ( gender = &#x27;男&#x27; OR gender = &#x27;女&#x27; ),#检查</span><br><span class="line">	seat INT UNIQUE,#唯一</span><br><span class="line">	age INT DEFAULT 18,#默认约束</span><br><span class="line">	majorId INT,</span><br><span class="line">	CONSTRAINT fk_stuinfo_major FOREIGN KEY ( majorId ) REFERENCES major ( id ) #外键</span><br><span class="line"></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="修改表时添加约束"><a href="#修改表时添加约束" class="headerlink" title="修改表时添加约束"></a>修改表时添加约束</h2><blockquote>
<p>添加列级约束<br>ALTER TABLE 表名 MODIFY COLUMN 字段名 字段类型 新约束;<br>添加表级约束<br>ALTER TABLE 表名 ADD [CONSTRAINT 约束名] 约束类型(字段名);</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DROP TABLE IF EXISTS stuinfo;</span><br><span class="line">CREATE TABLE stuinfo (</span><br><span class="line">	id INT,</span><br><span class="line">	stuName VARCHAR ( 20 ),</span><br><span class="line">	gender CHAR ( 1 ),</span><br><span class="line">	seat INT,</span><br><span class="line">	age INT 18,</span><br><span class="line">	majorId INT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 添加非空约束</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN stuName VARCHAR(20) NOT NULL;</span><br><span class="line"></span><br><span class="line"># 添加默认约束</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN age INT DEFAULT 18;</span><br><span class="line"></span><br><span class="line"># 添加主键</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN id INT PRIMARY KEY;</span><br><span class="line">ALTER TABLE stuinfo ADD PRIMARY KEY(id);</span><br><span class="line"></span><br><span class="line"># 添加唯一键</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN seat INT UNIQUE;</span><br><span class="line">ALTER TABLE stuinfo ADD UNIQUE(seat);</span><br><span class="line"></span><br><span class="line"># 添加外键</span><br><span class="line">ALTER TABLE stuinfo ADD FOREIGN KEY ( majorId ) REFERENCES major ( id ) ;</span><br></pre></td></tr></table></figure>

<h2 id="修改表时删除约束"><a href="#修改表时删除约束" class="headerlink" title="修改表时删除约束"></a>修改表时删除约束</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 删除非空约束</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN stuName VARCHAR(20) NULL;</span><br><span class="line"></span><br><span class="line"># 删除默认约束</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN age INT;</span><br><span class="line"></span><br><span class="line"># 删除主键</span><br><span class="line">ALTER TABLE stuinfo DROP PRIMARY KEY;</span><br><span class="line"></span><br><span class="line"># 删除唯一键</span><br><span class="line">ALTER TABLE stuinfo DROP INDEX seat;</span><br><span class="line"></span><br><span class="line"># 删除外键</span><br><span class="line">ALTER TABLE stuinfo DROP FOREIGN KEY majorId;</span><br></pre></td></tr></table></figure>

<h1 id="15-标示列（自增长列）"><a href="#15-标示列（自增长列）" class="headerlink" title="(15) 标示列（自增长列）"></a>(15) 标示列（自增长列）</h1><blockquote>
<p>可以不用手动插入值，系统提供默认值序列<br>标识列须是一个key<br>每个表最多能有一个自增长列<br>标识列类型只能是数值型<br>标示列可以通过<code>SET AUTO_INCREMENT_INCREMENT = 3</code>设置步长，也可以通过手动插入值，设置起始值</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建表时设置标示列</span><br><span class="line">DROP TABLE IF EXISTS tab_identity; </span><br><span class="line">CREATE TABLE tab_identity(</span><br><span class="line">    id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 修改表时设置标示列</span><br><span class="line">ALTER TABLE tab_identity MODIFY COLUMN id PRIMARY KEY AUTO_INCREMENT;</span><br><span class="line"># 修改表时删除标示列</span><br><span class="line">ALTER TABLE tab_identity MODIFY COLUMN id;</span><br></pre></td></tr></table></figure>

<h1 id="16-事物"><a href="#16-事物" class="headerlink" title="(16) 事物"></a>(16) 事物</h1><blockquote>
<p>一个或者一组sql语句组成一个执行单元，执行这个单元要么全部执行，要么全部不执行</p>
</blockquote>
<ul>
<li>查看存储引擎<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SHOW ENGINES;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="事务的ACID属性"><a href="#事务的ACID属性" class="headerlink" title="事务的ACID属性"></a>事务的ACID属性</h3><ol>
<li>原子性（Atomicity）<br>原子性是指事务是一个不可分割的单位，事物中的操作要么都发生，要么都不发生。</li>
<li>一致性（Consistency）<br>事务必须使数据库从一个一致性状态变到另一个一致性状态。</li>
<li>隔离性（Isolation）<br>一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能相互干扰。</li>
<li>持久性（Durability）<br>一个事务一旦被提交，它对数据库中数据的改变是永久性的，接下来的其他操作和数据库故障应该对其有任何影响。</li>
</ol>
<h2 id="事务的创建"><a href="#事务的创建" class="headerlink" title="事务的创建"></a>事务的创建</h2><ul>
<li><p>隐式的事务：没有明显的开启和关闭标记<br>  insert、update、delete语句都是隐式事务 </p>
</li>
<li><p>显示事务：具有明显的开始和结束标记，使用前必须先设置自动提交功能关闭 <code>SET AUTOCOMMIT = 0;</code></p>
</li>
<li><p>步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 1. 开启事务</span><br><span class="line">SET AUTOCOMMIT = 0;</span><br><span class="line">START TRANSACTION; # 可选的</span><br><span class="line"># 2. 编写事物中的sql语句</span><br><span class="line">增删改查语句（select、insert、update、delete）</span><br><span class="line"># 3. 结束事务</span><br><span class="line">commit; # 提交</span><br><span class="line">rollback; # 回滚</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="事务并发问题"><a href="#事务并发问题" class="headerlink" title="事务并发问题"></a>事务并发问题</h2><ol>
<li>脏读：对于两个事务，T1、T2，T1读取了T2已经更改但是没有提交的字段之后，若T2回滚，T1读取的内容就是临时且无效的。</li>
<li>不可重复读：对于两个事务，T1、T2，T1读取了一个字段，然后T2更新了这个字段之后，T1再读取这个字段，，值就不一样了。</li>
<li>幻读：对于两个事务，T1、T2，T1从一个表中读取了一个字段，T2在这个表中插入了新的行之后，如果T1再读这个表，就会多处几行数据。</li>
</ol>
<h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2><p><img src="/2021/02/11/mysql-note/img18.png" alt="隔离级别"><br>mysql中默认第三种隔离级别<br>oracle默认第二种</p>
<ul>
<li>查看当前隔离级别<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT @@TX_ISOLATION</span><br></pre></td></tr></table></figure></li>
<li>设置隔离级别<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 当前sql语句</span><br><span class="line">SET TRANSACTION ISOLATION LEVEL read committed;</span><br><span class="line"># 数据库系统</span><br><span class="line">SET GLOBAL TRANSACTION ISOLATION LEVEL read committed;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="回滚点（savepoint）"><a href="#回滚点（savepoint）" class="headerlink" title="回滚点（savepoint）"></a>回滚点（savepoint）</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SET AUTOCOMMIT = 0;</span><br><span class="line">START TRANSACTION;</span><br><span class="line">DELETE FROM account WHERE id=25;</span><br><span class="line">SAVEPOINT a;</span><br><span class="line">DELETE FROM account WHERE id=28;</span><br><span class="line">ROLLBACK TO a;</span><br></pre></td></tr></table></figure>

<h1 id="17-存储过程"><a href="#17-存储过程" class="headerlink" title="(17) 存储过程"></a>(17) 存储过程</h1><blockquote>
<p>一组预先编译好的SQL语句合集，类似批处理语句<br>适合做一些批量插入更新等操作</p>
</blockquote>
<ul>
<li>创建存储过程<blockquote>
<p>CREATE PROCEDURE 存储过程名（参数列表）<br>BEGIN<br>  存储过程体（一组合法有效的SQL语句）<br>END</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>Note<br>参数列表包含3部分（参数模式 参数名 参数类型）<br>如果存储过程体中只有一条SQL语句，那么 BEGIN 和 END 可以省略<br>存储过程体中每条语句必须加分号，结尾可以用 DELIMITER 重新设置</p>
</blockquote>
<ul>
<li>参数模式</li>
</ul>
<ol>
<li>IN ：该参数可以作为输入（需要调用方传值进来）</li>
<li>OUT ： 该参数可以作为输出（参数可以作为返回值）</li>
<li>INOUT ： 该参数可以作为输入输出（既需要传入值，又能返回值）</li>
</ol>
<ul>
<li><p>调用存储过程</p>
<blockquote>
<p>CALL 存储过程名（参数列表）;</p>
</blockquote>
</li>
<li><p>空参列表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 插入admin中5条记录</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE myp1()</span><br><span class="line">BEGIN</span><br><span class="line">    INSERT INTO admin(username,`password`) </span><br><span class="line">    VALUES(&#x27;username1&#x27;,&#x27;password1&#x27;),</span><br><span class="line">    VALUES(&#x27;username2&#x27;,&#x27;password2&#x27;),</span><br><span class="line">    VALUES(&#x27;username3&#x27;,&#x27;password3&#x27;),</span><br><span class="line">    VALUES(&#x27;username4&#x27;,&#x27;password4&#x27;),</span><br><span class="line">    VALUES(&#x27;username5&#x27;,&#x27;password5&#x27;);</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">CALL myp1()$</span><br></pre></td></tr></table></figure></li>
<li><p>IN 模式参数存储过程</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 根据女生名查询对应的男生信息</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE myp2(IN beautyName VARCHAR(20))</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT bo.*</span><br><span class="line">    FROM boys AS bo</span><br><span class="line">    RIGHT JOIN beauty AS b</span><br><span class="line">    ON bo.id = b.boyfirend_id</span><br><span class="line">    WHERE b.name = beautyName;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">CALL myp2(&#x27;小昭&#x27;)$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建存储过程，验证用户登录是否成功</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE myp3(IN username VARCHAR(20), IN password VARCHAR(20))</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE result INT DEFAULT 0;</span><br><span class="line">    SELECT COUNT(*) INTO result</span><br><span class="line">    FROM admin</span><br><span class="line">    WHERE admin.username = username</span><br><span class="line">    AND admin.password = password;</span><br><span class="line"></span><br><span class="line">    SELECT if(result&gt;0,&#x27;成功&#x27;,&#x27;失败&#x27;);</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">CALL myp3(&#x27;&#x27;,&#x27;&#x27;)$</span><br></pre></td></tr></table></figure></li>
<li><p>OUT 模式参数存储过程</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 根据女生名返回对应的男生名</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE myp4(IN beautyName VARCHAR(20), OUT boyName VARCHAR(20))</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT bo.boyName INTO boyName</span><br><span class="line">    FROM boys AS bo</span><br><span class="line">    INNER JOIN beauty AS b</span><br><span class="line">    ON bo.id = b.boyfirend_id</span><br><span class="line">    WHERE b.name = beautyName</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SET @bName$</span><br><span class="line">CALL myp5(&#x27;小昭&#x27;,@bName);</span><br><span class="line">SELECT @bName$</span><br></pre></td></tr></table></figure></li>
<li><p>INOUT 模式参数存储过程</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 传入a和b两个值，要求a和b都翻倍并返回</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE myp5(INOUT a INT, INOUT b INT)</span><br><span class="line">BEGIN</span><br><span class="line">    SET a = a * 2;</span><br><span class="line">    SET b = b * 2;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SET @m = 10$</span><br><span class="line">SET @n = 20$</span><br><span class="line">CALL myp5(@m,@n)$</span><br><span class="line">SELECT @m,@n$</span><br></pre></td></tr></table></figure></li>
<li><p>存储过程删除</p>
<blockquote>
<p>DROP PROCEDURE 存储过程名;</p>
</blockquote>
</li>
<li><p>存储过程查看</p>
<blockquote>
<p>SHOW CREATE PROCEDURE 存储过程名;</p>
</blockquote>
</li>
</ul>
<h1 id="18-函数"><a href="#18-函数" class="headerlink" title="(18) 函数"></a>(18) 函数</h1><blockquote>
<p>类似存储过程，但更适合做一些处理数据结果后返回一个结果</p>
</blockquote>
<ul>
<li>函数创建<blockquote>
<p>CREATE FUNCTION 函数名(参数列表) RETURNS 返回类型<br>BEAGIN<br>  函数体<br>END</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>Note<br>参数列表包含2部分（参数名 参数类型）<br>函数体肯定会包含返回语句，不包含会报错，如果return不在最后也不会报错<br>函数体中只有一条语句则可以省略，结尾可以用 DELIMITER 重新设置</p>
</blockquote>
<ul>
<li><p>调用函数</p>
<blockquote>
<p>SELECT 函数名（参数列表）;</p>
</blockquote>
</li>
<li><p>无参</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 返回公司员工个数</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE FUNCTION myf1() RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE c INT DEFAULT 0;</span><br><span class="line">    SELECT COUNT(*) INTO c</span><br><span class="line">    FROM employees;</span><br><span class="line">    RETURN c;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SELECT myf1()$</span><br></pre></td></tr></table></figure></li>
<li><p>有参有返回</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 根据员工名返回工资</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE FUNCTION myf2(empName VARCHAR(20)) RETURNS DOUBLE</span><br><span class="line">BEGIN</span><br><span class="line">    SET @sal = 0;</span><br><span class="line">    SELECT salary INTO @sal</span><br><span class="line">    FROM employees</span><br><span class="line">    WHERE last_name = empName;</span><br><span class="line"></span><br><span class="line">    RETURN @sal;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SELECT myf2(&#x27;kochhar&#x27;)$</span><br><span class="line"></span><br><span class="line"># 根据部门名返回该部门的平均工资</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE FUNCTION myf3(deptName VARCHAR(20)) RETURNS DOUBLE</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE sal DOUBLE DEFAULT 0;</span><br><span class="line">    SELECT AVG(salary) INTO sal</span><br><span class="line">    FROM employees AS e</span><br><span class="line">    INNER JOIN departments AS d</span><br><span class="line">    ON e.department_id = d.department_id</span><br><span class="line">    WHERE d.department_name = deptName;</span><br><span class="line"></span><br><span class="line">    RETURN sal;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SELECT myf3(&#x27;IT&#x27;)$</span><br></pre></td></tr></table></figure></li>
<li><p>查看函数</p>
<blockquote>
<p>SHOW CREATE FUNCTION 函数名;</p>
</blockquote>
</li>
<li><p>删除函数</p>
<blockquote>
<p>DROP FUNCTION 函数名;</p>
</blockquote>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 求和函数</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE FUNCTION test_fun_add(num1 FLOAT,num2 FLOAT) RETURNS FLOAT</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE sum FLOAT DEFAULT 0;</span><br><span class="line">    SET sum = num1 + num2;</span><br><span class="line">    RETURN sum;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">SELECT test_fun_add(1,2)$</span><br></pre></td></tr></table></figure>

<h1 id="19-流程控制"><a href="#19-流程控制" class="headerlink" title="(19) 流程控制"></a>(19) 流程控制</h1><ul>
<li>if else<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 根据传入成绩显示等级</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE FUNCTION test_if(score INT) RETURNS CHAR</span><br><span class="line">BEGIN</span><br><span class="line">    IF score &gt;= 90 AND score &lt;= 100 THEN RETURN &#x27;A&#x27;;</span><br><span class="line">    ELSEIF score &gt;= 80 THEN RETURN &#x27;B&#x27;;</span><br><span class="line">    ELSEIF score &gt;= 60 THEN RETURN &#x27;C&#x27;;</span><br><span class="line">    ELSE RETURN &#x27;D&#x27;;</span><br><span class="line">    END IF;</span><br><span class="line">END $</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><blockquote>
<p>while loop repeat<br>iterate 类似 continue<br>leave 类似 break</p>
</blockquote>
<ul>
<li><p>while</p>
<blockquote>
<p>[标签:] while 循环条件 do<br>  循环体;<br>end while [标签];</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 批量插入,没有循环控制</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE while1(IN insertCount INT)</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE i INT DEFAULT 1;</span><br><span class="line">    WHILE i &lt; insertCount DO</span><br><span class="line">        INSERT INTO admin(username,`password`) VALUES(CONCAT(&#x27;rose&#x27;, i),&#x27;666&#x27;);</span><br><span class="line">        SET i = i + 1; </span><br><span class="line">    END WHILE;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">CALL while1(100)$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 批量插入,有循环控制（如果次数 &gt;20 就停止）</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE while2(IN insertCount INT)</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE i INT DEFAULT 1;</span><br><span class="line">    a:WHILE i &lt; insertCount DO</span><br><span class="line">        INSERT INTO admin(username,`password`) VALUES(CONCAT(&#x27;rose&#x27;, i),&#x27;666&#x27;);</span><br><span class="line">        IF i &gt;= 20 THEN LEAVE a;</span><br><span class="line">        END IF;</span><br><span class="line">        SET i = i + 1; </span><br><span class="line">    END WHILE a;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">CALL while2(100)$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 批量插入,有循环控制（只插入偶数数据）</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE while3(IN insertCount INT)</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE i INT DEFAULT 0;</span><br><span class="line">    a:WHILE i &lt; insertCount DO</span><br><span class="line">        SET i = i + 1; </span><br><span class="line">        IF MOD(i,2) != 0 THEN ITERATE a;</span><br><span class="line">        END IF;</span><br><span class="line">        INSERT INTO admin(username,`password`) VALUES(CONCAT(&#x27;rose&#x27;, i),&#x27;666&#x27;);</span><br><span class="line">    END WHILE a;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">CALL while3(100)$</span><br></pre></td></tr></table></figure></li>
<li><p>loop</p>
<blockquote>
<p>[标签:] loop<br>  循环体;<br>end loop [标签];</p>
</blockquote>
</li>
<li><p>repeat</p>
<blockquote>
<p>[标签:] repeat<br>  循环体;<br>until 结束条件<br>end repeat [标签];</p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Code Tools</title>
    <url>/2021/01/07/code-tools/</url>
    <content><![CDATA[<h3 id="将View保存为图片"><a href="#将View保存为图片" class="headerlink" title="将View保存为图片"></a>将View保存为图片</h3><details>
<summary>点我展开</summary>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.Activity</span><br><span class="line"><span class="keyword">import</span> android.content.Intent</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color</span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> android.util.DisplayMetrics</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> android.view.View</span><br><span class="line"><span class="keyword">import</span> android.view.WindowManager</span><br><span class="line"><span class="keyword">import</span> java.io.File</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> ViewUtils &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">&quot;ViewUtils&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存view为图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activity     Activity</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> view         View</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> savePathName 保存的文件路径及文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Throws(Exception::class)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">saveView</span><span class="params">(activity: <span class="type">Activity</span>, view: <span class="type">View</span>, savePathName: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//计算设备分辨率</span></span><br><span class="line">        <span class="keyword">val</span> manager: WindowManager = activity.windowManager</span><br><span class="line">        <span class="keyword">val</span> outMetrics = DisplayMetrics()</span><br><span class="line">        manager.defaultDisplay.getMetrics(outMetrics)</span><br><span class="line">        <span class="keyword">val</span> width: <span class="built_in">Int</span> = outMetrics.widthPixels</span><br><span class="line">        <span class="keyword">val</span> height: <span class="built_in">Int</span> = outMetrics.heightPixels</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 整个View的大小 参数是左上角 和右下角的坐标</span></span><br><span class="line">        view.layout(<span class="number">0</span>, <span class="number">0</span>, width, height)</span><br><span class="line">        <span class="keyword">val</span> measuredWidth: <span class="built_in">Int</span> = View.MeasureSpec.makeMeasureSpec(width, View.MeasureSpec.EXACTLY)</span><br><span class="line">        <span class="keyword">val</span> measuredHeight: <span class="built_in">Int</span> = View.MeasureSpec.makeMeasureSpec(height, View.MeasureSpec.AT_MOST)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//测量，布局View</span></span><br><span class="line">        view.measure(measuredWidth, measuredHeight)</span><br><span class="line">        view.layout(<span class="number">0</span>, <span class="number">0</span>, view.measuredWidth, view.measuredHeight)</span><br><span class="line">        view.isDrawingCacheEnabled = <span class="literal">true</span></span><br><span class="line">        view.drawingCacheQuality = View.DRAWING_CACHE_QUALITY_HIGH</span><br><span class="line">        view.drawingCacheBackgroundColor = Color.WHITE</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把一个View转换成图片</span></span><br><span class="line">        <span class="keyword">val</span> cacheBmp: Bitmap = viewConversionBitmap(view)</span><br><span class="line">        <span class="keyword">val</span> file = File(savePathName)</span><br><span class="line">        <span class="keyword">val</span> fos = FileOutputStream(file)</span><br><span class="line">        cacheBmp.compress(Bitmap.CompressFormat.PNG, <span class="number">90</span>, fos)</span><br><span class="line">        fos.flush()</span><br><span class="line">        fos.close()</span><br><span class="line">        view.destroyDrawingCache()</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发送广播更新相册</span></span><br><span class="line">        <span class="keyword">val</span> intent = Intent(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE)</span><br><span class="line">        <span class="keyword">val</span> uri: Uri = Uri.fromFile(file)</span><br><span class="line">        intent.<span class="keyword">data</span> = uri</span><br><span class="line">        activity.sendBroadcast(intent)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * view转bitmap</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v View</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Bitmap</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">viewConversionBitmap</span><span class="params">(v: <span class="type">View</span>)</span></span>: Bitmap &#123;</span><br><span class="line">        <span class="keyword">val</span> w: <span class="built_in">Int</span> = v.width</span><br><span class="line">        <span class="keyword">val</span> h: <span class="built_in">Int</span> = v.height</span><br><span class="line">        Log.e(TAG, <span class="string">&quot;width: <span class="variable">$w</span> height: <span class="variable">$h</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">val</span> bmp: Bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888)</span><br><span class="line">        <span class="keyword">val</span> c = Canvas(bmp)</span><br><span class="line">        c.drawColor(Color.WHITE)</span><br><span class="line">        <span class="comment">/** 如果不设置canvas画布为白色，则生成透明  */</span></span><br><span class="line">        v.layout(<span class="number">0</span>, <span class="number">0</span>, w, h)</span><br><span class="line">        v.draw(c)</span><br><span class="line">        <span class="keyword">return</span> bmp</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="扫描文件"><a href="#扫描文件" class="headerlink" title="扫描文件"></a>扫描文件</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Kavan</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ScanFileHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ScanFileHelper scanFileHelper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScanFileHelper <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (scanFileHelper == <span class="keyword">null</span>) &#123;</span><br><span class="line">            scanFileHelper = <span class="keyword">new</span> ScanFileHelper();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> scanFileHelper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ScanFileHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OnFileScanListener fileScanListener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnFileScanListener</span><span class="params">(OnFileScanListener fileScanListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileScanListener = fileScanListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">OnFileScanListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onFileScan</span><span class="params">(String path)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">traverseFolderBFS</span><span class="params">(File node)</span> </span>&#123;</span><br><span class="line">        Set&lt;File&gt; visited = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        Queue&lt;File&gt; q = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        q.offer(node);</span><br><span class="line">        <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">            File currNode = q.poll();</span><br><span class="line">            <span class="keyword">if</span> (visited.contains(currNode) || <span class="keyword">null</span> == currNode) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (fileScanListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                fileScanListener.onFileScan(currNode.getAbsolutePath());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;FileScanListener should be not null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            visited.add(currNode);</span><br><span class="line">            File[] files = currNode.listFiles();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == files) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">                q.offer(file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">traverseFolderBFS</span><span class="params">(File node, OnFileScanListener l)</span> </span>&#123;</span><br><span class="line">        setOnFileScanListener(l);</span><br><span class="line">        traverseFolderBFS(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="读取assets文件"><a href="#读取assets文件" class="headerlink" title="读取assets文件"></a>读取assets文件</h3><details>
<summary>点我展开</summary>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 读取assets📁下json📃</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getJsonStringFromAssetsFile</span><span class="params">(context: <span class="type">Context</span>, fileName: <span class="type">String</span>?)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">val</span> stringBuilder = StringBuilder()</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> assetManager: AssetManager = context.assets</span><br><span class="line">        <span class="keyword">val</span> bf = BufferedReader(</span><br><span class="line">                InputStreamReader(</span><br><span class="line">                        assetManager.<span class="keyword">open</span>(fileName!!)</span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">var</span> line: String?</span><br><span class="line">        <span class="keyword">while</span> (bf.readLine().also &#123; line = it &#125; != <span class="literal">null</span>) &#123;</span><br><span class="line">            stringBuilder.append(line)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stringBuilder.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>


<h3 id="获取应用签名"><a href="#获取应用签名" class="headerlink" title="获取应用签名"></a>获取应用签名</h3><details>
<summary>点我展开</summary>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取应用签名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pkgname</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getSignature</span><span class="params">(Context context, String pkgname)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> isEmpty = TextUtils.isEmpty(pkgname);</span><br><span class="line">    <span class="keyword">if</span> (isEmpty) &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;应用程序的包名不能为空！&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="meta">@SuppressLint(&quot;PackageManagerGetSignatures&quot;)</span></span><br><span class="line">            PackageInfo packageInfo = context.getPackageManager().getPackageInfo(pkgname, PackageManager.GET_SIGNATURES);</span><br><span class="line">            Signature[] signatures = packageInfo.signatures;</span><br><span class="line">            StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (Signature signature : signatures) &#123;</span><br><span class="line">                builder.append(signature.toCharsString());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> builder.toString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>


<h3 id="SPHelper-java"><a href="#SPHelper-java" class="headerlink" title="SPHelper.java"></a>SPHelper.java</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.SharedPreferences;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jiangtao on 2016/12/25 12:22</span></span><br><span class="line"><span class="comment"> * E-mail：3305727299@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SPHelper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存在手机里面的文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_NAME = <span class="string">&quot;share_date&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存数据的方法，我们需要拿到保存数据的具体类型，然后根据类型调用不同的保存方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setParam</span><span class="params">(Context context, String key, Object object)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String type = object.getClass().getSimpleName();</span><br><span class="line">        SharedPreferences sp = context.getSharedPreferences(FILE_NAME, Context.MODE_PRIVATE);</span><br><span class="line">        SharedPreferences.Editor editor = sp.edit();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;String&quot;</span>.equals(type)) &#123;</span><br><span class="line">            editor.putString(key, (String) object);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;Integer&quot;</span>.equals(type)) &#123;</span><br><span class="line">            editor.putInt(key, (Integer) object);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;Boolean&quot;</span>.equals(type)) &#123;</span><br><span class="line">            editor.putBoolean(key, (Boolean) object);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;Float&quot;</span>.equals(type)) &#123;</span><br><span class="line">            editor.putFloat(key, (Float) object);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;Long&quot;</span>.equals(type)) &#123;</span><br><span class="line">            editor.putLong(key, (Long) object);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        editor.apply();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到保存数据的方法，我们根据默认值得到保存的数据的具体类型，然后调用相对于的方法获取值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultObject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getParam</span><span class="params">(Context context, String key, Object defaultObject)</span> </span>&#123;</span><br><span class="line">        String type = defaultObject.getClass().getSimpleName();</span><br><span class="line">        SharedPreferences sp = context.getSharedPreferences(FILE_NAME, Context.MODE_PRIVATE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;String&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> sp.getString(key, (String) defaultObject);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;Integer&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> sp.getInt(key, (Integer) defaultObject);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;Boolean&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> sp.getBoolean(key, (Boolean) defaultObject);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;Float&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> sp.getFloat(key, (Float) defaultObject);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;Long&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> sp.getLong(key, (Long) defaultObject);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>


<h3 id="Logger-java"><a href="#Logger-java" class="headerlink" title="Logger.java"></a>Logger.java</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jiangtao on 2017/2/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> isDebug = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String TAG = <span class="string">&quot;TAG&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">v</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isDebug) &#123;</span><br><span class="line">            Log.v(TAG, msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isDebug) &#123;</span><br><span class="line">            Log.d(TAG, msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isDebug) &#123;</span><br><span class="line">            Log.i(TAG, msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isDebug) &#123;</span><br><span class="line">            Log.w(TAG, msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isDebug) &#123;</span><br><span class="line">            Log.e(TAG, msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>


<h3 id="键盘覆盖WebView输入框"><a href="#键盘覆盖WebView输入框" class="headerlink" title="键盘覆盖WebView输入框"></a>键盘覆盖WebView输入框</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Rect;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewTreeObserver;</span><br><span class="line"><span class="keyword">import</span> android.widget.FrameLayout;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jiangtao on 2017/4/26 16:36</span></span><br><span class="line"><span class="comment"> * E-mail：3305727299@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyBoardListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Activity activity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View mChildOfContent;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> usableHeightPrevious;</span><br><span class="line">    <span class="keyword">private</span> FrameLayout.LayoutParams frameLayoutParams;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> KeyBoardListener keyBoardListener;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> KeyBoardListener <span class="title">getInstance</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">        keyBoardListener = <span class="keyword">new</span> KeyBoardListener(activity);</span><br><span class="line">        <span class="keyword">return</span> keyBoardListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KeyBoardListener</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.activity = activity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        FrameLayout content = (FrameLayout) activity</span><br><span class="line">                .findViewById(android.R.id.content);</span><br><span class="line">        mChildOfContent = content.getChildAt(<span class="number">0</span>);</span><br><span class="line">        mChildOfContent.getViewTreeObserver().addOnGlobalLayoutListener(</span><br><span class="line">                <span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        possiblyResizeChildOfContent();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        frameLayoutParams = (FrameLayout.LayoutParams) mChildOfContent</span><br><span class="line">                .getLayoutParams();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">possiblyResizeChildOfContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> usableHeightNow = computeUsableHeight();</span><br><span class="line">        <span class="keyword">if</span> (usableHeightNow != usableHeightPrevious) &#123;</span><br><span class="line">            <span class="keyword">int</span> usableHeightSansKeyboard = mChildOfContent.getRootView()</span><br><span class="line">                    .getHeight();</span><br><span class="line">            <span class="keyword">int</span> heightDifference = usableHeightSansKeyboard - usableHeightNow;</span><br><span class="line">            <span class="keyword">if</span> (heightDifference &gt; (usableHeightSansKeyboard / <span class="number">4</span>)) &#123;</span><br><span class="line">                frameLayoutParams.height = usableHeightSansKeyboard</span><br><span class="line">                        - heightDifference;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                frameLayoutParams.height = usableHeightSansKeyboard;</span><br><span class="line">            &#125;</span><br><span class="line">            mChildOfContent.requestLayout();</span><br><span class="line">            usableHeightPrevious = usableHeightNow;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">computeUsableHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Rect r = <span class="keyword">new</span> Rect();</span><br><span class="line">        mChildOfContent.getWindowVisibleDisplayFrame(r);</span><br><span class="line">        <span class="keyword">return</span> (r.bottom - r.top);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>


<h3 id="根据经纬度计算两点间的距离"><a href="#根据经纬度计算两点间的距离" class="headerlink" title="根据经纬度计算两点间的距离"></a>根据经纬度计算两点间的距离</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jiangtao on 2017/4/19 15:01</span></span><br><span class="line"><span class="comment"> * E-mail：3305727299@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">getDistance</span><span class="params">(<span class="keyword">double</span> long1, <span class="keyword">double</span> lat1, <span class="keyword">double</span> long2, <span class="keyword">double</span> lat2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a, b, R;</span><br><span class="line">    R = <span class="number">6378137</span>;</span><br><span class="line">    lat1 = lat1 * Math.PI / <span class="number">180.0</span>;</span><br><span class="line">    lat2 = lat2 * Math.PI / <span class="number">180.0</span>;</span><br><span class="line">    a = lat1 - lat2;</span><br><span class="line">    b = (long1 - long2) * Math.PI / <span class="number">180.0</span>;</span><br><span class="line">    <span class="keyword">double</span> d;</span><br><span class="line">    <span class="keyword">double</span> sa2, sb2;</span><br><span class="line">    sa2 = Math.sin(a / <span class="number">2.0</span>);</span><br><span class="line">    sb2 = Math.sin(b / <span class="number">2.0</span>);</span><br><span class="line">    d = <span class="number">2</span> * R * Math.asin(Math.sqrt(sa2 * sa2 + Math.cos(lat1) * Math.cos(lat2) * sb2 * sb2));</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Base64Utils-java"><a href="#Base64Utils-java" class="headerlink" title="Base64Utils.java"></a>Base64Utils.java</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> Base64Utils, v0.1 2020/7/7 10:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Base64Utils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> Base64.Encoder encoder = Base64.getEncoder();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> Base64.Decoder decoder = Base64.getDecoder();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 给字符串加密</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encode</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] textByte = text.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        <span class="keyword">return</span> encoder.encodeToString(textByte);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将加密后的字符串进行解密</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encodedText</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decode</span><span class="params">(String encodedText)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(decoder.decode(encodedText), StandardCharsets.UTF_8);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</details>

<h3 id="File2Base64-java"><a href="#File2Base64-java" class="headerlink" title="File2Base64.java"></a>File2Base64.java</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jiangtao on 2017/3/20 11:10</span></span><br><span class="line"><span class="comment"> * E-mail：3305727299@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">File2Base64</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将文件转成base64 字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path 文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 编码后的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> 3305727299@qq.com</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encodeBase64File</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(path);</span><br><span class="line">        FileInputStream inputFile = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) file.length()];</span><br><span class="line">        inputFile.read(buffer);</span><br><span class="line">        inputFile.close();</span><br><span class="line">        <span class="keyword">return</span> Base64.encodeToString(buffer, Base64.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将base64字符解码保存文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> base64Code 编码后的字串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> savePath   文件保存路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> 3305727299@qq.com</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">decoderBase64File</span><span class="params">(String base64Code, String savePath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = Base64.decode(base64Code, Base64.DEFAULT);</span><br><span class="line">        FileOutputStream out = <span class="keyword">new</span> FileOutputStream(savePath);</span><br><span class="line">        out.write(buffer);</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="Apk下载"><a href="#Apk下载" class="headerlink" title="Apk下载"></a>Apk下载</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.NotificationManager;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.AsyncTask;</span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.NotificationCompat;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jiangtao on 2017/3/13 13:04</span></span><br><span class="line"><span class="comment"> * E-mail：3305727299@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Download</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> File file;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="keyword">private</span> NotificationCompat.Builder builder;</span><br><span class="line">    <span class="keyword">private</span> NotificationManager notificationManager;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Download</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">        notificationManager = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">        builder = <span class="keyword">new</span> NotificationCompat.Builder(context);</span><br><span class="line">        builder.setTicker(<span class="string">&quot;下载开始了...&quot;</span>)</span><br><span class="line">                .setContentTitle(<span class="string">&quot;Download&quot;</span>)</span><br><span class="line">                .setSmallIcon(R.mipmap.ic_launcher);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">doInBackground</span><span class="params">(String... params)</span> </span>&#123;</span><br><span class="line">        URL url;</span><br><span class="line">        HttpURLConnection conn;</span><br><span class="line">        BufferedInputStream bis = <span class="keyword">null</span>;</span><br><span class="line">        FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            url = <span class="keyword">new</span> URL(params[<span class="number">0</span>]);</span><br><span class="line">            Log.i(<span class="string">&quot;TAG&quot;</span>, url.toString());</span><br><span class="line">            conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">            conn.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">            conn.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> fileLength = conn.getContentLength();</span><br><span class="line">            bis = <span class="keyword">new</span> BufferedInputStream(conn.getInputStream());</span><br><span class="line"></span><br><span class="line">            fileName = getFileName(params[<span class="number">0</span>]);</span><br><span class="line">            builder.setContentTitle(fileName);</span><br><span class="line">            String fileDir = Environment.getExternalStorageDirectory().getPath() + <span class="string">&quot;/Download/&quot;</span> + fileName;</span><br><span class="line">            file = <span class="keyword">new</span> File(fileDir);</span><br><span class="line">            <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!file.getParentFile().exists()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file.getParentFile().mkdirs()) &#123;</span><br><span class="line">                        file.createNewFile();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;文件已存在&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">            <span class="keyword">byte</span> data[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span> * <span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">long</span> total = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> count;</span><br><span class="line">            <span class="keyword">while</span> ((count = bis.read(data)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                total += count;</span><br><span class="line">                Log.i(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;total:&quot;</span> + total);</span><br><span class="line">                publishProgress((<span class="keyword">int</span>) (total * <span class="number">100</span> / fileLength));</span><br><span class="line">                fos.write(data, <span class="number">0</span>, count);</span><br><span class="line">                fos.flush();</span><br><span class="line">            &#125;</span><br><span class="line">            fos.flush();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;下载成功&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (bis != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    bis.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;网络错误&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Integer... progress)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onProgressUpdate(progress);</span><br><span class="line">        <span class="keyword">if</span> (progress[<span class="number">0</span>] == <span class="number">100</span>) &#123;</span><br><span class="line">            builder.setTicker(<span class="string">&quot;下载完成！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        builder.setProgress(<span class="number">100</span>, progress[<span class="number">0</span>], <span class="keyword">false</span>);</span><br><span class="line">        builder.setContentText(<span class="string">&quot;正在下载...&quot;</span> + progress[<span class="number">0</span>] + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        notificationManager.notify(<span class="number">1</span>, builder.build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPostExecute(s);</span><br><span class="line">        builder.setContentText(s);</span><br><span class="line">        builder.setProgress(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">false</span>);</span><br><span class="line">        notificationManager.notify(<span class="number">1</span>, builder.build());</span><br><span class="line">        <span class="keyword">if</span> (fileName.endsWith(<span class="string">&quot;.apk&quot;</span>)) &#123;</span><br><span class="line">            openFile(file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFileName</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        String filename = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">boolean</span> isOk = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// 从UrlConnection中获取文件名称</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL myURL = <span class="keyword">new</span> URL(url);</span><br><span class="line">            URLConnection conn = myURL.openConnection();</span><br><span class="line">            <span class="keyword">if</span> (conn == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Map&lt;String, List&lt;String&gt;&gt; hf = conn.getHeaderFields();</span><br><span class="line">            <span class="keyword">if</span> (hf == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Set&lt;String&gt; key = hf.keySet();</span><br><span class="line">            <span class="keyword">if</span> (key == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (String stringKey : key) &#123;</span><br><span class="line">                List&lt;String&gt; values = hf.get(stringKey);</span><br><span class="line">                <span class="keyword">for</span> (String value : values) &#123;</span><br><span class="line">                    String result;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        result = <span class="keyword">new</span> String(value.getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">                        <span class="keyword">int</span> location = result.indexOf(<span class="string">&quot;filename&quot;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (location &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            result = result.substring(location + <span class="string">&quot;filename&quot;</span>.length());</span><br><span class="line">                            filename = result.substring(result.indexOf(<span class="string">&quot;=&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">                            isOk = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;<span class="comment">// ISO-8859-1 UTF-8 gb2312</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (isOk) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 从路径中获取</span></span><br><span class="line">        <span class="keyword">if</span> (filename == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(filename)) &#123;</span><br><span class="line">            filename = url.substring(url.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openFile</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">        intent.setAction(Intent.ACTION_VIEW);</span><br><span class="line">        intent.setDataAndType(Uri.fromFile(file), <span class="string">&quot;application/vnd.android.package-archive&quot;</span>);</span><br><span class="line">        context.startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="根据日期和经纬度，计算日出日落时间"><a href="#根据日期和经纬度，计算日出日落时间" class="headerlink" title="根据日期和经纬度，计算日出日落时间"></a>根据日期和经纬度，计算日出日落时间</h3><details>
<summary>点我展开</summary>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义全局变量</span></span><br><span class="line"><span class="keyword">int</span> days_of_month_1[]= &#123;<span class="number">31</span>,<span class="number">28</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> days_of_month_2[]= &#123;<span class="number">31</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>&#125;;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">double</span> h=<span class="number">-0.833</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断是否为闰年:若为闰年,返回1；若非闰年,返回0</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">leap_year</span><span class="params">(<span class="keyword">int</span> year)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(((year%<span class="number">400</span>==<span class="number">0</span>) || (year%<span class="number">100</span>!=<span class="number">0</span>) &amp;&amp; (year%<span class="number">4</span>==<span class="number">0</span>))) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//求从格林威治时间公元2000年1月1日到计算日天数days</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">days</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">int</span> date)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,a=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">2000</span>; i&lt;year; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">leap_year</span>(i)) a=a+<span class="number">366</span>;</span><br><span class="line">        <span class="keyword">else</span> a=a+<span class="number">365</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">leap_year</span>(year))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;month<span class="number">-1</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            a=a+days_of_month_2[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;month<span class="number">-1</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            a=a+days_of_month_1[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    a=a+date;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//求格林威治时间公元2000年1月1日到计算日的世纪数t</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">t_century</span><span class="params">(<span class="keyword">int</span> days, <span class="keyword">long</span> <span class="keyword">double</span> UTo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">long</span> <span class="keyword">double</span>)days+UTo/<span class="number">360</span>)/<span class="number">36525</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//求太阳的平黄径</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">L_sun</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> t_century)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">280.460</span>+<span class="number">36000.770</span>*t_century);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//求太阳的平近点角</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">G_sun</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> t_century)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">357.528</span>+<span class="number">35999.050</span>*t_century);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//求黄道经度</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">ecliptic_longitude</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> L_sun,<span class="keyword">long</span> <span class="keyword">double</span> G_sun)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (L_sun+<span class="number">1.915</span>*<span class="built_in">sin</span>(G_sun*PI/<span class="number">180</span>)+<span class="number">0.02</span>*<span class="built_in">sin</span>(<span class="number">2</span>*G_sun*PI/<span class="number">180</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//求地球倾角</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">earth_tilt</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> t_century)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">23.4393</span><span class="number">-0.0130</span>*t_century);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//求太阳偏差</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">sun_deviation</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> earth_tilt, <span class="keyword">long</span> <span class="keyword">double</span> ecliptic_longitude)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">180</span>/PI*<span class="built_in">asin</span>(<span class="built_in">sin</span>(PI/<span class="number">180</span>*earth_tilt)*<span class="built_in">sin</span>(PI/<span class="number">180</span>*ecliptic_longitude)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//求格林威治时间的太阳时间角GHA</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">GHA</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> UTo, <span class="keyword">long</span> <span class="keyword">double</span> G_sun, <span class="keyword">long</span> <span class="keyword">double</span> ecliptic_longitude)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  (UTo<span class="number">-180</span><span class="number">-1.915</span>*<span class="built_in">sin</span>(G_sun*PI/<span class="number">180</span>)<span class="number">-0.02</span>*<span class="built_in">sin</span>(<span class="number">2</span>*G_sun*PI/<span class="number">180</span>)+<span class="number">2.466</span>*<span class="built_in">sin</span>(<span class="number">2</span>*ecliptic_longitude*PI/<span class="number">180</span>)<span class="number">-0.053</span>*<span class="built_in">sin</span>(<span class="number">4</span>*ecliptic_longitude*PI/<span class="number">180</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//求修正值e</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">e</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> h, <span class="keyword">long</span> <span class="keyword">double</span> lat, <span class="keyword">long</span> <span class="keyword">double</span> sun_deviation)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="number">180</span>/PI*<span class="built_in">acos</span>((<span class="built_in">sin</span>(h*PI/<span class="number">180</span>)-<span class="built_in">sin</span>(lat*PI/<span class="number">180</span>)*<span class="built_in">sin</span>(sun_deviation*PI/<span class="number">180</span>))/(<span class="built_in">cos</span>(lat*PI/<span class="number">180</span>)*<span class="built_in">cos</span>(sun_deviation*PI/<span class="number">180</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//求日出时间</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">UT_rise</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> UTo, <span class="keyword">long</span> <span class="keyword">double</span> GHA, <span class="keyword">long</span> <span class="keyword">double</span> lng, <span class="keyword">long</span> <span class="keyword">double</span> e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (UTo-(GHA+lng+e));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//求日落时间</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">UT_set</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> UTo, <span class="keyword">long</span> <span class="keyword">double</span> GHA, <span class="keyword">long</span> <span class="keyword">double</span> lng, <span class="keyword">long</span> <span class="keyword">double</span> e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (UTo-(GHA+lng-e));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断并返回结果（日出）</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">result_rise</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> UT, <span class="keyword">long</span> <span class="keyword">double</span> UTo, <span class="keyword">long</span> <span class="keyword">double</span> lng, <span class="keyword">long</span> <span class="keyword">double</span> lat, <span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">int</span> date)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> d;</span><br><span class="line">    <span class="keyword">if</span>(UT&gt;=UTo) d=UT-UTo;</span><br><span class="line">    <span class="keyword">else</span> d=UTo-UT;</span><br><span class="line">    <span class="keyword">if</span>(d&gt;=<span class="number">0.1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        UTo=UT;</span><br><span class="line">        UT=<span class="built_in">UT_rise</span>(UTo,</span><br><span class="line">                   <span class="built_in">GHA</span>(UTo,</span><br><span class="line">                       <span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                            month,</span><br><span class="line">                                            date),</span><br><span class="line">                                       UTo)</span><br><span class="line">                            ),<span class="built_in">ecliptic_longitude</span>(<span class="built_in">L_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                    month,</span><br><span class="line">                                    date),</span><br><span class="line">                                    UTo)</span><br><span class="line">                                                      ),</span><br><span class="line">                                    <span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                            month,</span><br><span class="line">                                            date),</span><br><span class="line">                                            UTo)</span><br><span class="line">                                         )</span><br><span class="line">                                                )</span><br><span class="line">                      ),</span><br><span class="line">                   lng,</span><br><span class="line">                   <span class="built_in">e</span>(h,</span><br><span class="line">                     lat,</span><br><span class="line">                     <span class="built_in">sun_deviation</span>(<span class="built_in">earth_tilt</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                              month,</span><br><span class="line">                                              date),</span><br><span class="line">                                              UTo)</span><br><span class="line">                                             ),</span><br><span class="line">                                   <span class="built_in">ecliptic_longitude</span>(<span class="built_in">L_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                           month,</span><br><span class="line">                                           date),</span><br><span class="line">                                           UTo)</span><br><span class="line">                                                           ),</span><br><span class="line">                                           <span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                                   month,</span><br><span class="line">                                                   date),</span><br><span class="line">                                                   UTo)</span><br><span class="line">                                                )</span><br><span class="line">                                                     )</span><br><span class="line">                                  )</span><br><span class="line">                    )</span><br><span class="line">                  );</span><br><span class="line">        <span class="built_in">result_rise</span>(UT,UTo,lng,lat,year,month,date);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> UT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断并返回结果（日落）</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">double</span> <span class="title">result_set</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> UT, <span class="keyword">long</span> <span class="keyword">double</span> UTo, <span class="keyword">long</span> <span class="keyword">double</span> lng, <span class="keyword">long</span> <span class="keyword">double</span> lat, <span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">int</span> date)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> d;</span><br><span class="line">    <span class="keyword">if</span>(UT&gt;=UTo) d=UT-UTo;</span><br><span class="line">    <span class="keyword">else</span> d=UTo-UT;</span><br><span class="line">    <span class="keyword">if</span>(d&gt;=<span class="number">0.1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        UTo=UT;</span><br><span class="line">        UT=<span class="built_in">UT_set</span>(UTo,</span><br><span class="line">                  <span class="built_in">GHA</span>(UTo,</span><br><span class="line">                      <span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                           month,</span><br><span class="line">                                           date),</span><br><span class="line">                                      UTo)),</span><br><span class="line">                      <span class="built_in">ecliptic_longitude</span>(<span class="built_in">L_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                               month,</span><br><span class="line">                                               date),</span><br><span class="line">                                               UTo)),</span><br><span class="line">                                         <span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                                 month,</span><br><span class="line">                                                 date),</span><br><span class="line">                                                 UTo)</span><br><span class="line">                                              )</span><br><span class="line">                                        )</span><br><span class="line">                     ),</span><br><span class="line">                  lng,</span><br><span class="line">                  <span class="built_in">e</span>(h,</span><br><span class="line">                    lat,</span><br><span class="line">                    <span class="built_in">sun_deviation</span>(<span class="built_in">earth_tilt</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                             month,</span><br><span class="line">                                             date),</span><br><span class="line">                                             UTo)</span><br><span class="line">                                            ),</span><br><span class="line">                                  <span class="built_in">ecliptic_longitude</span>(<span class="built_in">L_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                          month,</span><br><span class="line">                                          date),</span><br><span class="line">                                          UTo)</span><br><span class="line">                                                          ),</span><br><span class="line">                                          <span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,</span><br><span class="line">                                                  month,</span><br><span class="line">                                                  date),</span><br><span class="line">                                                  UTo)</span><br><span class="line">                                               )</span><br><span class="line">                                                    )</span><br><span class="line">                                 )</span><br><span class="line">                   )</span><br><span class="line">                 );</span><br><span class="line">        <span class="built_in">result_set</span>(UT,UTo,lng,lat,year,month,date);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> UT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//求时区</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Zone</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> lng)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(lng&gt;=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)((<span class="keyword">int</span>)(lng/<span class="number">15.0</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in"><span class="keyword">return</span></span> (<span class="keyword">int</span>)((<span class="keyword">int</span>)(lng/<span class="number">15.0</span>)<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印结果</span></span><br><span class="line"><span class="function">string <span class="title">output</span><span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> rise, <span class="keyword">long</span> <span class="keyword">double</span> set, <span class="keyword">long</span> <span class="keyword">double</span> lng)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string hour;</span><br><span class="line">    string mine;</span><br><span class="line">    string sunrise_result;</span><br><span class="line">    string sunset_result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">int</span>)(<span class="number">60</span>*(rise/<span class="number">15</span>+<span class="built_in">Zone</span>(lng)-(<span class="keyword">int</span>)(rise/<span class="number">15</span>+<span class="built_in">Zone</span>(lng))))&lt;<span class="number">10</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        stringstream ss_hour;</span><br><span class="line">        ss_hour&lt;&lt;(<span class="keyword">int</span>)(rise/<span class="number">15</span>+<span class="built_in">Zone</span>(lng));</span><br><span class="line">        ss_hour&gt;&gt;hour;</span><br><span class="line"></span><br><span class="line">        stringstream ss_mine;</span><br><span class="line">        ss_mine&lt;&lt;(<span class="keyword">int</span>)(<span class="number">60</span>*(rise/<span class="number">15</span>+<span class="built_in">Zone</span>(lng)-(<span class="keyword">int</span>)(rise/<span class="number">15</span>+<span class="built_in">Zone</span>(lng))));</span><br><span class="line">        ss_mine&gt;&gt;mine;</span><br><span class="line"></span><br><span class="line">        sunrise_result = hour + <span class="string">&quot;:0&quot;</span> + mine;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;&quot;The time at which the sun rises is &quot;&lt;&lt;(int)(rise/15+Zone(lng))&lt;&lt;&quot;:0&quot;&lt;&lt;(int)(60*(rise/15+Zone(lng)-(int)(rise/15+Zone(lng))))&lt;&lt;&quot; .\n&quot;;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        stringstream ss_hour;</span><br><span class="line">        ss_hour&lt;&lt;(<span class="keyword">int</span>)(rise/<span class="number">15</span>+<span class="built_in">Zone</span>(lng));</span><br><span class="line">        ss_hour&gt;&gt;hour;</span><br><span class="line"></span><br><span class="line">        stringstream ss_mine;</span><br><span class="line">        ss_mine&lt;&lt;(<span class="keyword">int</span>)(<span class="number">60</span>*(rise/<span class="number">15</span>+<span class="built_in">Zone</span>(lng)-(<span class="keyword">int</span>)(rise/<span class="number">15</span>+<span class="built_in">Zone</span>(lng))));</span><br><span class="line">        ss_mine&gt;&gt;mine;</span><br><span class="line"></span><br><span class="line">        sunrise_result = hour + <span class="string">&quot;:&quot;</span> + mine;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;&quot;The time at which the sun rises is &quot;&lt;&lt;(int)(rise/15+Zone(lng))&lt;&lt;&quot;:&quot;&lt;&lt;(int)(60*(rise/15+Zone(lng)-(int)(rise/15+Zone(lng))))&lt;&lt;&quot; .\n&quot;;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">int</span>)(<span class="number">60</span>*(set/<span class="number">15</span>+<span class="built_in">Zone</span>(lng)-(<span class="keyword">int</span>)(set/<span class="number">15</span>+<span class="built_in">Zone</span>(lng))))&lt;<span class="number">10</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        stringstream ss_hour;</span><br><span class="line">        ss_hour&lt;&lt;(<span class="keyword">int</span>)(set/<span class="number">15</span>+<span class="built_in">Zone</span>(lng));</span><br><span class="line">        ss_hour&gt;&gt;hour;</span><br><span class="line"></span><br><span class="line">        stringstream ss_mine;</span><br><span class="line">        ss_mine&lt;&lt;(<span class="keyword">int</span>)(<span class="number">60</span>*(set/<span class="number">15</span>+<span class="built_in">Zone</span>(lng)-(<span class="keyword">int</span>)(set/<span class="number">15</span>+<span class="built_in">Zone</span>(lng))));</span><br><span class="line">        ss_mine&gt;&gt;mine;</span><br><span class="line"></span><br><span class="line">        sunset_result = hour + <span class="string">&quot;: &quot;</span> + mine;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;&quot;The time at which the sun sets is &quot;&lt;&lt;(int)(set/15+Zone(lng))&lt;&lt;&quot;: &quot;&lt;&lt;(int)(60*(set/15+Zone(lng)-(int)(set/15+Zone(lng))))&lt;&lt;&quot; .\n&quot;;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        stringstream ss_hour;</span><br><span class="line">        ss_hour&lt;&lt;(<span class="keyword">int</span>)(set/<span class="number">15</span>+<span class="built_in">Zone</span>(lng));</span><br><span class="line">        ss_hour&gt;&gt;hour;</span><br><span class="line"></span><br><span class="line">        stringstream ss_mine;</span><br><span class="line">        ss_mine&lt;&lt;(<span class="keyword">int</span>)(<span class="number">60</span>*(set/<span class="number">15</span>+<span class="built_in">Zone</span>(lng)-(<span class="keyword">int</span>)(set/<span class="number">15</span>+<span class="built_in">Zone</span>(lng))));</span><br><span class="line">        ss_mine&gt;&gt;mine;</span><br><span class="line"></span><br><span class="line">        sunset_result = hour + <span class="string">&quot;:&quot;</span> + mine;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;&quot;The time at which the sun sets is &quot;&lt;&lt;(int)(set/15+Zone(lng))&lt;&lt;&quot;:&quot;&lt;&lt;(int)(60*(set/15+Zone(lng)-(int)(set/15+Zone(lng))))&lt;&lt;&quot; .\n&quot;;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sunrise_result + <span class="string">&quot;,&quot;</span> + sunset_result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">get_sunrise_and_sunset_time</span><span class="params">(<span class="keyword">int</span> year,<span class="keyword">int</span> month,<span class="keyword">int</span> date,<span class="keyword">double</span> lat,<span class="keyword">double</span> lng)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> UTo=<span class="number">180.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> c[<span class="number">3</span>] = &#123;year,month,date&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">double</span> rise,set;</span><br><span class="line">    rise=<span class="built_in">result_rise</span>(<span class="built_in">UT_rise</span>(UTo,<span class="built_in">GHA</span>(UTo,<span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)),<span class="built_in">ecliptic_longitude</span>(<span class="built_in">L_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)),<span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)))),lng,<span class="built_in">e</span>(h,lat,<span class="built_in">sun_deviation</span>(<span class="built_in">earth_tilt</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)),<span class="built_in">ecliptic_longitude</span>(<span class="built_in">L_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)),<span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)))))),UTo,lng,lat,year,month,date);</span><br><span class="line">    set=<span class="built_in">result_set</span>(<span class="built_in">UT_set</span>(UTo,<span class="built_in">GHA</span>(UTo,<span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)),<span class="built_in">ecliptic_longitude</span>(<span class="built_in">L_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)),<span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)))),lng,<span class="built_in">e</span>(h,lat,<span class="built_in">sun_deviation</span>(<span class="built_in">earth_tilt</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)),<span class="built_in">ecliptic_longitude</span>(<span class="built_in">L_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)),<span class="built_in">G_sun</span>(<span class="built_in">t_century</span>(<span class="built_in">days</span>(year,month,date),UTo)))))),UTo,lng,lat,year,month,date);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">output</span>(rise,set,lng);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string s;</span><br><span class="line">    s = <span class="built_in">get_sunrise_and_sunset_time</span>(<span class="number">2017</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">36.01666</span>,<span class="number">106.2833</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;日出日落时间：&quot;</span> &lt;&lt; s;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jiangtao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/12/13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SunriseAndSunsetTime</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义全局变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> PI = <span class="number">3.1415926</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> daysOfMonth1[] = &#123;<span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> daysOfMonth2[] = &#123;<span class="number">31</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> h = -<span class="number">0.833</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sunrise;</span><br><span class="line">    <span class="keyword">private</span> String sunset;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SunriseAndSunsetTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SunriseAndSunsetTime</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">int</span> date, <span class="keyword">double</span> lat, <span class="keyword">double</span> lng)</span> </span>&#123;</span><br><span class="line">        setTimeAndLoc(year,month,date,lat,lng);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSunrise</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sunrise;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSunset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sunset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断是否为闰年:若为闰年,返回1；若非闰年,返回0</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">leapYear</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((year % <span class="number">400</span> == <span class="number">0</span>) || (year % <span class="number">100</span> != <span class="number">0</span>) &amp;&amp; (year % <span class="number">4</span> == <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//求从格林威治时间公元2000年1月1日到计算日天数days</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">days</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">int</span> date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i, a = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">2000</span>; i &lt; year; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (leapYear(i)) &#123;</span><br><span class="line">                a = a + <span class="number">366</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                a = a + <span class="number">365</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (leapYear(year)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; month - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                a = a + daysOfMonth2[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; month - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                a = a + daysOfMonth1[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        a = a + date;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//求格林威治时间公元2000年1月1日到计算日的世纪数t</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">tCentury</span><span class="params">(<span class="keyword">int</span> days, <span class="keyword">double</span> uto)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((<span class="keyword">double</span>) days + uto / <span class="number">360</span>) / <span class="number">36525</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//求太阳的平黄径</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">lSun</span><span class="params">(<span class="keyword">double</span> tCentury)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">280.460</span> + <span class="number">36000.770</span> * tCentury);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//求太阳的平近点角</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">gSun</span><span class="params">(<span class="keyword">double</span> tCentury)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">357.528</span> + <span class="number">35999.050</span> * tCentury);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//求黄道经度</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">eclipticLongitude</span><span class="params">(<span class="keyword">double</span> lSun, <span class="keyword">double</span> gSun)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (lSun + <span class="number">1.915</span> * Math.sin(gSun * PI / <span class="number">180</span>) + <span class="number">0.02</span> * Math.sin(<span class="number">2</span> * gSun * PI / <span class="number">180</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//求地球倾角</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">earthTilt</span><span class="params">(<span class="keyword">double</span> tCentury)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">23.4393</span> - <span class="number">0.0130</span> * tCentury);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//求太阳偏差</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">sunDeviation</span><span class="params">(<span class="keyword">double</span> earthTilt, <span class="keyword">double</span> eclipticLongitude)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">180</span> / PI * Math.asin(Math.sin(PI / <span class="number">180</span> * earthTilt) * Math.sin(PI / <span class="number">180</span> * eclipticLongitude)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//求格林威治时间的太阳时间角GHA</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">gha</span><span class="params">(<span class="keyword">double</span> uto, <span class="keyword">double</span> gSun, <span class="keyword">double</span> eclipticLongitude)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (uto - <span class="number">180</span> - <span class="number">1.915</span> * Math.sin(gSun * PI / <span class="number">180</span>) - <span class="number">0.02</span> * Math.sin(<span class="number">2</span> * gSun * PI / <span class="number">180</span>) +</span><br><span class="line">                <span class="number">2.466</span> * Math.sin(<span class="number">2</span> * eclipticLongitude * PI / <span class="number">180</span>) -</span><br><span class="line">                <span class="number">0.053</span> * Math.sin(<span class="number">4</span> * eclipticLongitude * PI / <span class="number">180</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//求修正值e</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">e</span><span class="params">(<span class="keyword">double</span> h, <span class="keyword">double</span> lat, <span class="keyword">double</span> sunDeviation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">180</span> / PI *</span><br><span class="line">                Math.acos((Math.sin(h * PI / <span class="number">180</span>) - Math.sin(lat * PI / <span class="number">180</span>) * Math.sin(sunDeviation * PI / <span class="number">180</span>)) /</span><br><span class="line">                        (Math.cos(lat * PI / <span class="number">180</span>) * Math.cos(sunDeviation * PI / <span class="number">180</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//求日出时间</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">utRise</span><span class="params">(<span class="keyword">double</span> uto, <span class="keyword">double</span> gha, <span class="keyword">double</span> lng, <span class="keyword">double</span> e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (uto - (gha + lng + e));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//求日落时间</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">utSet</span><span class="params">(<span class="keyword">double</span> uto, <span class="keyword">double</span> gha, <span class="keyword">double</span> lng, <span class="keyword">double</span> e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (uto - (gha + lng - e));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断并返回结果（日出）</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span></span></span><br><span class="line"><span class="function">    <span class="title">resultRise</span><span class="params">(<span class="keyword">double</span> ut, <span class="keyword">double</span> uto, <span class="keyword">double</span> lng, <span class="keyword">double</span> lat, <span class="keyword">int</span> year, <span class="keyword">int</span> month,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="keyword">int</span> date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> d;</span><br><span class="line">        <span class="keyword">if</span> (ut &gt;= uto) &#123;</span><br><span class="line">            d = ut - uto;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            d = uto - ut;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (d &gt;= <span class="number">0.1</span>) &#123;</span><br><span class="line">            uto = ut;</span><br><span class="line">            ut = utRise(uto, gha(uto, gSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                    eclipticLongitude(lSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                            gSun(tCentury(days(year, month, date), uto)))),</span><br><span class="line">                    lng, e(h, lat,</span><br><span class="line">                            sunDeviation(earthTilt(tCentury(days(year, month, date), uto)),</span><br><span class="line">                                    eclipticLongitude(</span><br><span class="line">                                            lSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                                            gSun(tCentury(days(year, month, date),</span><br><span class="line">                                                    uto))))));</span><br><span class="line">            resultRise(ut, uto, lng, lat, year, month, date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断并返回结果（日落）</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span></span></span><br><span class="line"><span class="function">    <span class="title">resultSet</span><span class="params">(<span class="keyword">double</span> ut, <span class="keyword">double</span> uto, <span class="keyword">double</span> lng, <span class="keyword">double</span> lat, <span class="keyword">int</span> year, <span class="keyword">int</span> month,</span></span></span><br><span class="line"><span class="params"><span class="function">              <span class="keyword">int</span> date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> d;</span><br><span class="line">        <span class="keyword">if</span> (ut &gt;= uto) &#123;</span><br><span class="line">            d = ut - uto;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            d = uto - ut;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (d &gt;= <span class="number">0.1</span>) &#123;</span><br><span class="line">            uto = ut;</span><br><span class="line">            ut = utSet(uto, gha(uto, gSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                    eclipticLongitude(lSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                            gSun(tCentury(days(year, month, date), uto)))),</span><br><span class="line">                    lng, e(h, lat,</span><br><span class="line">                            sunDeviation(earthTilt(tCentury(days(year, month, date), uto)),</span><br><span class="line">                                    eclipticLongitude(</span><br><span class="line">                                            lSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                                            gSun(tCentury(days(year, month, date), uto))))));</span><br><span class="line">            resultSet(ut, uto, lng, lat, year, month, date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//求时区</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">zone</span><span class="params">(<span class="keyword">double</span> lng)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (lng &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ((<span class="keyword">int</span>) (lng / <span class="number">15.0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ((<span class="keyword">int</span>) (lng / <span class="number">15.0</span>) - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印结果</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">output</span><span class="params">(<span class="keyword">double</span> rise, <span class="keyword">double</span> set, <span class="keyword">double</span> lng)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hour;</span><br><span class="line">        <span class="keyword">int</span> min;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">int</span>) (<span class="number">60</span> * (rise / <span class="number">15</span> + zone(lng) - (<span class="keyword">int</span>) (rise / <span class="number">15</span> + zone(lng)))) &lt; <span class="number">10</span>) &#123;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; &quot;the sun rises is &quot; &lt;&lt; (int) (rise / 15 + zone(lng)) &lt;&lt; &quot;:0&quot;</span></span><br><span class="line"><span class="comment">//             &lt;&lt; (int) (60 * (rise / 15 + zone(lng) - (int) (rise / 15 + zone(lng)))) &lt;&lt; &quot; .\n&quot;;</span></span><br><span class="line">            hour = (<span class="keyword">int</span>) (rise / <span class="number">15</span> + zone(lng));</span><br><span class="line">            min = (<span class="keyword">int</span>) (<span class="number">60</span> * (rise / <span class="number">15</span> + zone(lng) - (<span class="keyword">int</span>) (rise / <span class="number">15</span> + zone(lng))));</span><br><span class="line">            sunrise = hour + <span class="string">&quot;:0&quot;</span> + min;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; &quot;the sun rises is &quot; &lt;&lt; (int) (rise / 15 + zone(lng)) &lt;&lt; &quot;:&quot;</span></span><br><span class="line"><span class="comment">//             &lt;&lt; (int) (60 * (rise / 15 + zone(lng) - (int) (rise / 15 + zone(lng)))) &lt;&lt; &quot; .\n&quot;;</span></span><br><span class="line">            hour = (<span class="keyword">int</span>) (rise / <span class="number">15</span> + zone(lng));</span><br><span class="line">            min = (<span class="keyword">int</span>) (<span class="number">60</span> * (rise / <span class="number">15</span> + zone(lng) - (<span class="keyword">int</span>) (rise / <span class="number">15</span> + zone(lng))));</span><br><span class="line">            sunrise = hour + <span class="string">&quot;:&quot;</span> + min;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">int</span>) (<span class="number">60</span> * (set / <span class="number">15</span> + zone(lng) - (<span class="keyword">int</span>) (set / <span class="number">15</span> + zone(lng)))) &lt; <span class="number">10</span>) &#123;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; &quot;the sun sets is &quot; &lt;&lt; (int) (set / 15 + zone(lng)) &lt;&lt; &quot;: &quot;</span></span><br><span class="line"><span class="comment">//             &lt;&lt; (int) (60 * (set / 15 + zone(lng) - (int) (set / 15 + zone(lng)))) &lt;&lt; &quot; .\n&quot;;</span></span><br><span class="line">            hour = (<span class="keyword">int</span>) (set / <span class="number">15</span> + zone(lng));</span><br><span class="line">            min = (<span class="keyword">int</span>) (<span class="number">60</span> * (set / <span class="number">15</span> + zone(lng) - (<span class="keyword">int</span>) (set / <span class="number">15</span> + zone(lng))));</span><br><span class="line">            sunset = hour + <span class="string">&quot;: &quot;</span> + min;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; &quot;the sun sets is &quot; &lt;&lt; (int) (set / 15 + zone(lng)) &lt;&lt; &quot;:&quot;</span></span><br><span class="line"><span class="comment">//             &lt;&lt; (int) (60 * (set / 15 + zone(lng) - (int) (set / 15 + zone(lng)))) &lt;&lt; &quot; .\n&quot;;</span></span><br><span class="line">            hour = (<span class="keyword">int</span>) (set / <span class="number">15</span> + zone(lng));</span><br><span class="line">            min = (<span class="keyword">int</span>) (<span class="number">60</span> * (set / <span class="number">15</span> + zone(lng) - (<span class="keyword">int</span>) (set / <span class="number">15</span> + zone(lng))));</span><br><span class="line">            sunset = hour + <span class="string">&quot;:&quot;</span> + min;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTimeAndLoc</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">int</span> date, <span class="keyword">double</span> lat, <span class="keyword">double</span> lng)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> uto = <span class="number">180.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] c = &#123;year, month, date&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span> rise, set;</span><br><span class="line">        rise = resultRise(utRise(uto, gha(uto, gSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                eclipticLongitude(</span><br><span class="line">                        lSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                        gSun(tCentury(days(year, month, date), uto)))),</span><br><span class="line">                lng, e(h, lat, sunDeviation(</span><br><span class="line">                        earthTilt(tCentury(days(year, month, date), uto)),</span><br><span class="line">                        eclipticLongitude(lSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                                gSun(tCentury(days(year, month, date), uto)))))), uto, lng,</span><br><span class="line">                lat, year, month, date);</span><br><span class="line">        set = resultSet(utSet(uto, gha(uto, gSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                eclipticLongitude(</span><br><span class="line">                        lSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                        gSun(tCentury(days(year, month, date), uto)))), lng,</span><br><span class="line">                e(h, lat,</span><br><span class="line">                        sunDeviation(earthTilt(tCentury(days(year, month, date), uto)),</span><br><span class="line">                                eclipticLongitude(</span><br><span class="line">                                        lSun(tCentury(days(year, month, date), uto)),</span><br><span class="line">                                        gSun(tCentury(days(year, month, date),</span><br><span class="line">                                                uto)))))), uto, lng, lat, year,</span><br><span class="line">                month, date);</span><br><span class="line"></span><br><span class="line">        output(rise, set, lng);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="android-5-新-UI"><a href="#android-5-新-UI" class="headerlink" title="android 5 新 UI"></a>android 5 新 UI</h3><details>
<summary>点我展开</summary>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;ljt.appbarlayout.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:layout_editor_absoluteY</span>=<span class="string">&quot;81dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 对LinearLayout的封装，方向为垂直方向 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- android.support.v7.widget.Toolbar 的扩展，layout_scrollFlags设置滚动样式 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">             CollapsingToolbarLayout是用来对Toolbar进行再次包装的ViewGroup，主要是用于实现折叠（其实就是看起来像伸缩~）的App Bar效果。它需要放在AppBarLayout布局里面，并且作为AppBarLayout的直接子View。CollapsingToolbarLayout主要包括几个功能（参照了官方网站上内容，略加自己的理解进行解释）：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            (1) 折叠Title（Collapsing title）：当布局内容全部显示出来时，title是最大的，但是随着View逐步移出屏幕顶部，title变得越来越小。你可以通过调用setTitle函数来设置title。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            (2)内容纱布（Content scrim）：根据滚动的位置是否到达一个阀值，来决定是否对View“盖上纱布”。可以通过setContentScrim(Drawable)来设置纱布的图片.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            (3)状态栏纱布（Status bar scrim)：根据滚动位置是否到达一个阀值决定是否对状态栏“盖上纱布”，你可以通过setStatusBarScrim(Drawable)来设置纱布图片，但是只能在LOLLIPOP设备上面有作用。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            (4)视差滚动子View(Parallax scrolling children):子View可以选择在当前的布局当时是否以“视差”的方式来跟随滚动。（PS:其实就是让这个View的滚动的速度比其他正常滚动的View速度稍微慢一点）。将布局参数app:layout_collapseMode设为parallax</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            (5)将子View位置固定(Pinned position children)：子View可以选择是否在全局空间上固定位置，这对于Toolbar来说非常有用，因为当布局在移动时，可以将Toolbar固定位置而不受移动的影响。 将app:layout_collapseMode设为pin。</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        app:layout_scrollFlags：</span></span><br><span class="line"><span class="comment">        （1） scroll:值设为scroll的View会跟随滚动事件一起发生移动。</span></span><br><span class="line"><span class="comment">        （2） enterAlways:值设为enterAlways的View,当ScrollView往下滚动时，该View会直接往下滚动。而不用考虑ScrollView是否在滚动。</span></span><br><span class="line"><span class="comment">        （3） exitUntilCollapsed：值设为exitUntilCollapsed的View，当这个View要往上逐渐“消逝”时，会一直往上滑动，直到剩下的的高度达到它的最小高度后，再响应ScrollView的内部滑动事件。</span></span><br><span class="line"><span class="comment">        （4） enterAlwaysCollapsed：是enterAlways的附加选项，一般跟enterAlways一起使用，它是指，View在往下“出现”的时候，首先是enterAlways效果，当View的高度达到最小高度时，View就暂时不去往下滚动，直到ScrollView滑动到顶部不再滑动时，View再继续往下滑动，直到滑到View的顶部结束。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:expandedTitleMarginEnd</span>=<span class="string">&quot;64dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:expandedTitleMarginStart</span>=<span class="string">&quot;48dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">&quot;scroll|enterAlways|enterAlwaysCollapsed&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:statusBarScrim</span>=<span class="string">&quot;@android:color/transparent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 头部差值滚动图片 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;300dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:scaleType</span>=<span class="string">&quot;centerCrop&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:src</span>=<span class="string">&quot;@mipmap/title_bar&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;parallax&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 真实的toolbar --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;pin&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     把ScrollView和AppBarLayout作为CoordinateLayout的子View，然后编写一个Behavior，在这个Behavior里面判断当前的操作是应该让ScrollView时刻保持在AppBarLayout之下（即只要改变AppBarLayout的位置就可以一起滑动），还是应该让ScrollView内部滚动而不让AppBarLayout位置发生变化等等这些需求，都是可以在Behavior里面处理的。你可以去针对你的ScrollView编写Behavior。然而，我们看到我们的AppBarLayout事先的功能比较复杂，如果我们自己去定义这样的效果，代码非常复杂，还要考虑很多方面，好在Android帮我们写好啦，我们直接用就是了，这个ScrollView就是NestedScrollView，请注意，它并没有继承ScrollView，它继承的是FrameLayout，但是它实现的效果把它可以看成是ScrollView。</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">&quot;@string/appbar_scrolling_view_behavior&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@string/test_str&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

</details>

<h3 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MD5计算工具</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Md5CaculateUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取一个文件的md5值(可处理大文件)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> md5 value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMD5</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        FileInputStream fileInputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MessageDigest MD5 = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            fileInputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">102400</span>];</span><br><span class="line">            <span class="keyword">int</span> length;</span><br><span class="line">            <span class="keyword">while</span> ((length = fileInputStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                MD5.update(buffer, <span class="number">0</span>, length);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(Hex.encodeHex(MD5.digest()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fileInputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    fileInputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 求一个字符串的md5值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target 字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> md5 value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">MD5</span><span class="params">(String target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DigestUtils.md5Hex(target);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> beginTime = System.currentTimeMillis();</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;D:/1/pdi-ce-7.0.0.0-24.zip&quot;</span>);</span><br><span class="line">        String md5 = getMD5(file);</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;MD5:&quot;</span> + md5 + <span class="string">&quot;\n 耗时:&quot;</span> + ((endTime - beginTime) / <span class="number">1000</span>) + <span class="string">&quot;s&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="文件重命名"><a href="#文件重命名" class="headerlink" title="文件重命名"></a>文件重命名</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChangeFileName</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] getFileName(String path) &#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(path);</span><br><span class="line">        String[] fileName = file.list();</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">renameFile</span><span class="params">(String path, String oldname)</span> </span>&#123;</span><br><span class="line">        System.out.println(path + <span class="string">&quot;\\&quot;</span> + oldname);</span><br><span class="line">        String newname = oldname;</span><br><span class="line">        newname = newname.replace(<span class="string">&quot;[在线]&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        newname = newname.replace(<span class="string">&quot;+&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        newname = newname.replace(<span class="string">&quot;~&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!oldname.equals(newname)) &#123;<span class="comment">//新的文件名和以前文件名不同时,才有必要进行重命名</span></span><br><span class="line">            File oldfile = <span class="keyword">new</span> File(path + <span class="string">&quot;\\&quot;</span> + oldname);</span><br><span class="line">            File newfile = <span class="keyword">new</span> File(path + <span class="string">&quot;\\&quot;</span> + newname);</span><br><span class="line">            <span class="keyword">if</span> (!oldfile.exists()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;<span class="comment">//重命名文件不存在</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (newfile.exists())<span class="comment">//若在该目录下已经有一个文件和新文件名相同，则不允许重命名</span></span><br><span class="line">                System.out.println(newname + <span class="string">&quot;已经存在！&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">boolean</span> b = oldfile.renameTo(newfile);</span><br><span class="line">                <span class="keyword">if</span> (b) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;更名成功&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;更名失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;新文件名和旧文件名相同...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> page = <span class="number">111</span>;</span><br><span class="line">        <span class="keyword">while</span> (page &lt;= <span class="number">130</span>) &#123;</span><br><span class="line"></span><br><span class="line">            String[] fileName = getFileName(<span class="string">&quot;G:\\slb\\&quot;</span> + page);<span class="comment">//&lt;span style=&quot;font-family: Arial, Helvetica, sans-serif;&quot;&gt;此处修改为你的本地路径&lt;/span&gt;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fileName.length; i++) &#123;</span><br><span class="line">                renameFile(<span class="string">&quot;G:\\slb\\&quot;</span> + page, fileName[i]);<span class="comment">//cx修改为你要修改的文件名格式</span></span><br><span class="line">            &#125;</span><br><span class="line">            page++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="okhttp3上传图片"><a href="#okhttp3上传图片" class="headerlink" title="okhttp3上传图片"></a>okhttp3上传图片</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.Message;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.Headers;</span><br><span class="line"><span class="keyword">import</span> okhttp3.MediaType;</span><br><span class="line"><span class="keyword">import</span> okhttp3.MultipartBody;</span><br><span class="line"><span class="keyword">import</span> okhttp3.OkHttpClient;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Request;</span><br><span class="line"><span class="keyword">import</span> okhttp3.RequestBody;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Response;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by jiangtao on 2019/8/26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpLoadImgThread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> UpLoadImgThread sImgThread;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">UpLoadImgThread</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mContext = context.getApplicationContext();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> UpLoadImgThread <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sImgThread == <span class="keyword">null</span>) &#123;</span><br><span class="line">            sImgThread = <span class="keyword">new</span> UpLoadImgThread(context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sImgThread;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upLoad</span><span class="params">(String url, String fileKey, List&lt;String&gt; pathList, Map&lt;String, String&gt; header, Map&lt;String, Object&gt; params, <span class="keyword">final</span> CallBackListener mCallBackListener)</span> </span>&#123;</span><br><span class="line">        MyHandler handler = <span class="keyword">new</span> MyHandler();</span><br><span class="line">        handler.setCallBackListener(mCallBackListener, pathList.size());</span><br><span class="line">        ExecutorService singlePool = Executors.newSingleThreadExecutor();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pathList.size(); i++) &#123;</span><br><span class="line">            singlePool.execute(<span class="keyword">new</span> UploadTask(url, fileKey, pathList.get(i), header, params, handler));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upLoadNet</span><span class="params">(String url, String fileKey, List&lt;String&gt; pathList, List&lt;Boolean&gt; isNet, Map&lt;String, Object&gt; params, <span class="keyword">final</span> CallBackListener mCallBackListener)</span> </span>&#123;</span><br><span class="line">        MyHandler handler = <span class="keyword">new</span> MyHandler();</span><br><span class="line">        handler.setCallBackListener(mCallBackListener, pathList.size());</span><br><span class="line">        ExecutorService singlePool = Executors.newSingleThreadExecutor();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pathList.size(); i++) &#123;</span><br><span class="line">            singlePool.execute(<span class="keyword">new</span> UploadNetTask(url, fileKey, pathList.get(i), isNet.get(i), params, handler));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片上传线程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String fileKey;</span><br><span class="line">        <span class="keyword">private</span> String filePath;</span><br><span class="line">        <span class="keyword">private</span> String url;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String, String&gt; header;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String, Object&gt; params;</span><br><span class="line">        <span class="keyword">private</span> String[] values;</span><br><span class="line">        <span class="keyword">private</span> MyHandler mMyHandler;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">UploadTask</span><span class="params">(String url, String fileKey, String filepath, Map&lt;String, String&gt; header, Map&lt;String, Object&gt; params, MyHandler handler)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.fileKey = fileKey;</span><br><span class="line">            <span class="keyword">this</span>.filePath = filepath;</span><br><span class="line">            <span class="keyword">this</span>.url = url;</span><br><span class="line">            <span class="keyword">this</span>.header = header;</span><br><span class="line">            <span class="keyword">this</span>.params = params;</span><br><span class="line">            mMyHandler = handler;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发送返回的数据</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            String[] values = upload(url, fileKey, filePath, header, params);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;1&quot;</span>.equals(values[<span class="number">0</span>])) &#123;</span><br><span class="line">                Message message = Message.obtain();</span><br><span class="line">                Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">                bundle.putString(<span class="string">&quot;info&quot;</span>, values[<span class="number">1</span>]);</span><br><span class="line">                message.setData(bundle);</span><br><span class="line">                message.what = <span class="number">0</span>;</span><br><span class="line">                mMyHandler.sendMessage(message);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Message message = Message.obtain();</span><br><span class="line">                Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">                bundle.putString(<span class="string">&quot;info&quot;</span>, values[<span class="number">1</span>]);</span><br><span class="line">                message.setData(bundle);</span><br><span class="line">                message.what = <span class="number">1</span>;</span><br><span class="line">                mMyHandler.sendMessage(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//上传图片并返回服务器返回的数据</span></span><br><span class="line">        <span class="keyword">private</span> String[] upload(String url, String fileKey, String filepath, Map&lt;String, String&gt; header, Map&lt;String, Object&gt; params) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">                Headers headers = Headers.of(header);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// form 表单形式上传</span></span><br><span class="line">                MultipartBody.Builder requestBody = <span class="keyword">new</span> MultipartBody.Builder().setType(MultipartBody.FORM);</span><br><span class="line">                <span class="keyword">if</span> (filepath != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// MediaType.parse() 里面是上传的文件类型。</span></span><br><span class="line">                    File file = <span class="keyword">new</span> File(filepath);</span><br><span class="line">                    RequestBody body = RequestBody.create(file, MediaType.parse(<span class="string">&quot;image/*&quot;</span>));</span><br><span class="line">                    String filename = file.getName();</span><br><span class="line">                    <span class="comment">// 参数分别为， 请求key ，文件名称 ， RequestBody</span></span><br><span class="line">                    requestBody.addFormDataPart(fileKey, filename, body);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (params != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// map 里面是请求中所需要的 key 和 value</span></span><br><span class="line">                    <span class="keyword">for</span> (Map.Entry entry : params.entrySet()) &#123;</span><br><span class="line">                        requestBody.addFormDataPart(String.valueOf(entry.getKey()), String.valueOf(entry.getValue()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//创建RequestBody</span></span><br><span class="line">                RequestBody body = requestBody.build();</span><br><span class="line">                <span class="comment">//创建Request</span></span><br><span class="line">                <span class="keyword">final</span> Request request = <span class="keyword">new</span> Request.Builder().url(url).headers(headers).post(body).build();</span><br><span class="line">                <span class="keyword">try</span> (Response response = okHttpClient.newCall(request).execute()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (response.body() != <span class="keyword">null</span> &amp;&amp; response.isSuccessful()) &#123;</span><br><span class="line">                        String jsonData = Objects.requireNonNull(response.body()).string();</span><br><span class="line">                        values = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;1&quot;</span>, jsonData&#125;;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        values = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;0&quot;</span>, <span class="string">&quot;网络请求失败: &quot;</span> + response.toString()&#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                values = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;0&quot;</span>, <span class="string">&quot;网络请求失败:&quot;</span> + e.toString()&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> values;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 网络图片上传线程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadNetTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String fileKey;</span><br><span class="line">        <span class="keyword">private</span> String filePath;</span><br><span class="line">        <span class="keyword">private</span> String url;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String, Object&gt; params;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isNetPic;</span><br><span class="line">        <span class="keyword">private</span> String[] values;</span><br><span class="line">        <span class="keyword">private</span> MyHandler mMyHandler;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">UploadNetTask</span><span class="params">(String url, String fileKey, String filepath, <span class="keyword">boolean</span> isNetPic, Map&lt;String, Object&gt; params, MyHandler handler)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.fileKey = fileKey;</span><br><span class="line">            <span class="keyword">this</span>.filePath = filepath;</span><br><span class="line">            <span class="keyword">this</span>.isNetPic = isNetPic;</span><br><span class="line">            <span class="keyword">this</span>.url = url;</span><br><span class="line">            <span class="keyword">this</span>.params = params;</span><br><span class="line">            mMyHandler = handler;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发送返回的数据</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            String[] values = upload(url, fileKey, filePath, isNetPic, params);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;1&quot;</span>.equals(values[<span class="number">0</span>])) &#123;</span><br><span class="line">                Message message = Message.obtain();</span><br><span class="line">                Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">                bundle.putString(<span class="string">&quot;info&quot;</span>, values[<span class="number">1</span>]);</span><br><span class="line">                message.setData(bundle);</span><br><span class="line">                message.what = <span class="number">0</span>;</span><br><span class="line">                mMyHandler.sendMessage(message);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Message message = Message.obtain();</span><br><span class="line">                Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">                bundle.putString(<span class="string">&quot;info&quot;</span>, values[<span class="number">1</span>]);</span><br><span class="line">                message.setData(bundle);</span><br><span class="line">                message.what = <span class="number">1</span>;</span><br><span class="line">                mMyHandler.sendMessage(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//上传图片并返回服务器返回的数据</span></span><br><span class="line">        <span class="keyword">public</span> String[] upload(String url, String fileKey, String filepath, <span class="keyword">boolean</span> isNetPic, Map&lt;String, Object&gt; params) &#123;</span><br><span class="line"><span class="comment">//            try &#123;</span></span><br><span class="line"><span class="comment">//                final StringRequest request = new StringRequest(url, RequestMethod.POST);</span></span><br><span class="line"><span class="comment">//                File glidePath = new File(filepath);</span></span><br><span class="line"><span class="comment">//                if (isNetPic) &#123;</span></span><br><span class="line"><span class="comment">//                    glidePath = Glide.with(mContext).load(filepath).downloadOnly(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL).get();</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//                File tempPath = new Compressor(mContext).compressToFile(glidePath);</span></span><br><span class="line"><span class="comment">//                request.add(params).add(fileKey, tempPath);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                Response&lt;String&gt; response = SyncRequestExecutor.INSTANCE.execute(request);</span></span><br><span class="line"><span class="comment">//                Log.e(&quot;返回值&quot;, response.toString());</span></span><br><span class="line"><span class="comment">//                if (response.isSucceed()) &#123;</span></span><br><span class="line"><span class="comment">//                    Log.e(&quot;返回值&quot;, response.get());</span></span><br><span class="line"><span class="comment">//                    values = new String[]&#123;&quot;1&quot;, response.get()&#125;;</span></span><br><span class="line"><span class="comment">//                &#125; else &#123;</span></span><br><span class="line"><span class="comment">//                    // 请求失败，拿到错误：</span></span><br><span class="line"><span class="comment">//                    Exception e = response.getException();</span></span><br><span class="line"><span class="comment">//                    values = new String[]&#123;&quot;0&quot;, &quot;网络请求失败:&quot; + e.toString()&#125;;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">//                Log.e(&quot;try：&quot;, e.toString());</span></span><br><span class="line"><span class="comment">//                values = new String[]&#123;&quot;0&quot;, &quot;图片上传失败&quot;&#125;;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">            <span class="keyword">return</span> values;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 回调接口</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CallBackListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onFinish</span><span class="params">(List&lt;String&gt; values)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onError</span><span class="params">(String e)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handler传递消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> CallBackListener mCallBackListener;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> temp;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> total;</span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; values;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCallBackListener</span><span class="params">(CallBackListener callBackListener, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">            mCallBackListener = callBackListener;</span><br><span class="line">            temp = <span class="number">0</span>;</span><br><span class="line">            values = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            total = size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">            String info = msg.getData().getString(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            temp++;</span><br><span class="line">            <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    values.add(info);</span><br><span class="line">                    <span class="keyword">if</span> (temp == total) &#123;</span><br><span class="line">                        mCallBackListener.onFinish(values);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    Log.e(<span class="string">&quot;图片上传失败&quot;</span>, <span class="string">&quot;第&quot;</span> + temp + <span class="string">&quot;张照片上传失败&quot;</span> + info);</span><br><span class="line">                    mCallBackListener.onError(info);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="权限申请"><a href="#权限申请" class="headerlink" title="权限申请"></a>权限申请</h3><details>
<summary>点我展开</summary>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.Activity</span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageManager</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.ActivityCompat</span><br><span class="line"><span class="keyword">import</span> androidx.core.content.ContextCompat</span><br><span class="line"><span class="keyword">import</span> java.util.*</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kavan jiangtao on 2019/8/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">object</span> PermissionUtils &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> REQUEST_CODE = <span class="number">10</span></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">applyPermission</span><span class="params">(activity: <span class="type">Activity</span>, permissions: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> permissionList: MutableList&lt;String&gt; = ArrayList()</span><br><span class="line">        <span class="keyword">for</span> (permission <span class="keyword">in</span> permissions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ContextCompat.checkSelfPermission(activity, permission) != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                permissionList.add(permission)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> permissionArray = permissionList.toTypedArray()</span><br><span class="line">        <span class="keyword">if</span> (permissionArray.isNotEmpty()) &#123;</span><br><span class="line">            ActivityCompat.requestPermissions(activity, permissionArray, REQUEST_CODE)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">hasPermission</span><span class="params">(activity: <span class="type">Activity</span>, permissions: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (permission <span class="keyword">in</span> permissions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ContextCompat.checkSelfPermission(activity, permission) != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">isGrantedAll</span><span class="params">(grantResults: <span class="type">IntArray</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> isGranted = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">for</span> (grantResult <span class="keyword">in</span> grantResults) &#123;</span><br><span class="line">            <span class="keyword">if</span> (grantResult == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                isGranted = <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                isGranted = <span class="literal">false</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isGranted</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>implementation ‘com.afollestad.assent:core:3.0.0-RC4’</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.Activity</span><br><span class="line"><span class="keyword">import</span> com.afollestad.assent.Permission</span><br><span class="line"><span class="keyword">import</span> com.afollestad.assent.askForPermissions</span><br><span class="line"><span class="keyword">import</span> com.afollestad.assent.isAllGranted</span><br><span class="line"><span class="keyword">import</span> com.afollestad.assent.runWithPermissions</span><br><span class="line"></span><br><span class="line"><span class="keyword">typealias</span> PermissionListener = () -&gt; <span class="built_in">Unit</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Activity.<span class="title">checkPermissions</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">vararg</span> permissions: <span class="type">Permission</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    permissionListener: <span class="type">PermissionListener</span>? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isAllGranted(*permissions)) &#123;</span><br><span class="line">        runWithPermissions(*permissions) &#123;</span><br><span class="line">            permissionListener?.invoke()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        askForPermissions(*permissions) &#123; result -&gt;</span><br><span class="line">            <span class="keyword">if</span> (result.isAllGranted()) &#123;</span><br><span class="line">                permissionListener?.invoke()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                checkPermissions(*permissions, permissionListener = permissionListener)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h3 id="content映射到文件路径"><a href="#content映射到文件路径" class="headerlink" title="content映射到文件路径"></a>content映射到文件路径</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</span><br><span class="line"><span class="keyword">import</span> android.content.ContentUris;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.Cursor;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"><span class="keyword">import</span> android.provider.DocumentsContract;</span><br><span class="line"><span class="keyword">import</span> android.provider.MediaStore;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Admin on 2018/11/27</span></span><br><span class="line"><span class="comment"> * Describe:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUriUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRealPathFromURI</span><span class="params">(Context context, Uri contentUri)</span> </span>&#123;</span><br><span class="line">        String res = <span class="keyword">null</span>;</span><br><span class="line">        String[] proj = &#123;MediaStore.Images.Media.DATA&#125;;</span><br><span class="line">        Cursor cursor = context.getContentResolver().query(contentUri, proj, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != cursor &amp;&amp; cursor.moveToFirst()) &#123;</span><br><span class="line">            ;</span><br><span class="line">            <span class="keyword">int</span> column_index = cursor.getColumnIndexOrThrow(MediaStore.Images.Media.DATA);</span><br><span class="line">            res = cursor.getString(column_index);</span><br><span class="line">            cursor.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 专为Android4.4设计的从Uri获取文件绝对路径，以前的方法已不好使</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressLint(&quot;NewApi&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPath</span><span class="params">(<span class="keyword">final</span> Context context, <span class="keyword">final</span> Uri uri)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> isKitKat = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// DocumentProvider</span></span><br><span class="line">        <span class="keyword">if</span> (isKitKat &amp;&amp; DocumentsContract.isDocumentUri(context, uri)) &#123;</span><br><span class="line">            <span class="comment">// ExternalStorageProvider</span></span><br><span class="line">            <span class="keyword">if</span> (isExternalStorageDocument(uri)) &#123;</span><br><span class="line">                <span class="keyword">final</span> String docId = DocumentsContract.getDocumentId(uri);</span><br><span class="line">                <span class="keyword">final</span> String[] split = docId.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">                <span class="keyword">final</span> String type = split[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;primary&quot;</span>.equalsIgnoreCase(type)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> Environment.getExternalStorageDirectory() + <span class="string">&quot;/&quot;</span> + split[<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// DownloadsProvider</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (isDownloadsDocument(uri)) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">final</span> String id = DocumentsContract.getDocumentId(uri);</span><br><span class="line">                <span class="keyword">final</span> Uri contentUri = ContentUris.withAppendedId(</span><br><span class="line">                        Uri.parse(<span class="string">&quot;content://downloads/public_downloads&quot;</span>), Long.valueOf(id));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> getDataColumn(context, contentUri, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// MediaProvider</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (isMediaDocument(uri)) &#123;</span><br><span class="line">                <span class="keyword">final</span> String docId = DocumentsContract.getDocumentId(uri);</span><br><span class="line">                <span class="keyword">final</span> String[] split = docId.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">                <span class="keyword">final</span> String type = split[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">                Uri contentUri = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;image&quot;</span>.equals(type)) &#123;</span><br><span class="line">                    contentUri = MediaStore.Images.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;video&quot;</span>.equals(type)) &#123;</span><br><span class="line">                    contentUri = MediaStore.Video.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;audio&quot;</span>.equals(type)) &#123;</span><br><span class="line">                    contentUri = MediaStore.Audio.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">final</span> String selection = <span class="string">&quot;_id=?&quot;</span>;</span><br><span class="line">                <span class="keyword">final</span> String[] selectionArgs = <span class="keyword">new</span> String[]&#123;split[<span class="number">1</span>]&#125;;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> getDataColumn(context, contentUri, selection, selectionArgs);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// MediaStore (and general)</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;content&quot;</span>.equalsIgnoreCase(uri.getScheme())) &#123;</span><br><span class="line">            <span class="keyword">return</span> getDataColumn(context, uri, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// File</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;file&quot;</span>.equalsIgnoreCase(uri.getScheme())) &#123;</span><br><span class="line">            <span class="keyword">return</span> uri.getPath();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the value of the data column for this Uri. This is useful for</span></span><br><span class="line"><span class="comment">     * MediaStore Uris, and other file-based ContentProviders.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context       The context.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uri           The Uri to query.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> selection     (Optional) Filter used in the query.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> selectionArgs (Optional) Selection arguments used in the query.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The value of the _data column, which is typically a file path.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getDataColumn</span><span class="params">(Context context, Uri uri, String selection,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       String[] selectionArgs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Cursor cursor = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">final</span> String column = <span class="string">&quot;_data&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> String[] projection = &#123;column&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            cursor = context.getContentResolver().query(uri, projection, selection, selectionArgs,</span><br><span class="line">                    <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; cursor.moveToFirst()) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> column_index = cursor.getColumnIndexOrThrow(column);</span><br><span class="line">                <span class="keyword">return</span> cursor.getString(column_index);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (cursor != <span class="keyword">null</span>)</span><br><span class="line">                cursor.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uri The Uri to check.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Whether the Uri authority is ExternalStorageProvider.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isExternalStorageDocument</span><span class="params">(Uri uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;com.android.externalstorage.documents&quot;</span>.equals(uri.getAuthority());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uri The Uri to check.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Whether the Uri authority is DownloadsProvider.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isDownloadsDocument</span><span class="params">(Uri uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;com.android.providers.downloads.documents&quot;</span>.equals(uri.getAuthority());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uri The Uri to check.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Whether the Uri authority is MediaProvider.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMediaDocument</span><span class="params">(Uri uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;com.android.providers.media.documents&quot;</span>.equals(uri.getAuthority());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>


<h3 id="圆角图片"><a href="#圆角图片" class="headerlink" title="圆角图片"></a>圆角图片</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.res.TypedArray;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapShader;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Matrix;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint;</span><br><span class="line"><span class="keyword">import</span> android.graphics.RectF;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Shader;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.BitmapDrawable;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.ColorDrawable;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2016/10/19.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleImageView</span> <span class="keyword">extends</span> <span class="title">ImageView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ScaleType SCALE_TYPE = ScaleType.CENTER_CROP;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Bitmap.Config BITMAP_CONFIG = Bitmap.Config.ARGB_8888;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COLORDRAWABLE_DIMENSION = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_BORDER_WIDTH = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_BORDER_COLOR = Color.BLACK;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RectF mDrawableRect = <span class="keyword">new</span> RectF();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RectF mBorderRect = <span class="keyword">new</span> RectF();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Matrix mShaderMatrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Paint mBitmapPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Paint mBorderPaint = <span class="keyword">new</span> Paint();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mBorderColor = DEFAULT_BORDER_COLOR;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mBorderWidth = DEFAULT_BORDER_WIDTH;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Bitmap mBitmap;</span><br><span class="line">    <span class="keyword">private</span> BitmapShader mBitmapShader;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mBitmapWidth;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mBitmapHeight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mDrawableRadius;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mBorderRadius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mReady;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mSetupPending;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleImageView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line"></span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleImageView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleImageView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.CircleImageView, defStyle, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        mBorderWidth = a.getDimensionPixelSize(R.styleable.CircleImageView_border_width, DEFAULT_BORDER_WIDTH);</span></span><br><span class="line"><span class="comment">//        mBorderColor = a.getColor(R.styleable.CircleImageView_border_color, DEFAULT_BORDER_COLOR);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        a.recycle();</span></span><br><span class="line"></span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setScaleType(SCALE_TYPE);</span><br><span class="line">        mReady = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mSetupPending) &#123;</span><br><span class="line">            setup();</span><br><span class="line">            mSetupPending = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ScaleType <span class="title">getScaleType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SCALE_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScaleType</span><span class="params">(ScaleType scaleType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (scaleType != SCALE_TYPE) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(String.format(<span class="string">&quot;ScaleType %s not supported.&quot;</span>, scaleType));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (getDrawable() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        canvas.drawCircle(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>, mDrawableRadius, mBitmapPaint);</span><br><span class="line">        <span class="keyword">if</span> (mBorderWidth != <span class="number">0</span>) &#123;</span><br><span class="line">            canvas.drawCircle(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>, mBorderRadius, mBorderPaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSizeChanged</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> oldw, <span class="keyword">int</span> oldh)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh);</span><br><span class="line">        setup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBorderColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mBorderColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBorderColor</span><span class="params">(<span class="keyword">int</span> borderColor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (borderColor == mBorderColor) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mBorderColor = borderColor;</span><br><span class="line">        mBorderPaint.setColor(mBorderColor);</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBorderWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mBorderWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBorderWidth</span><span class="params">(<span class="keyword">int</span> borderWidth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (borderWidth == mBorderWidth) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mBorderWidth = borderWidth;</span><br><span class="line">        setup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImageBitmap</span><span class="params">(Bitmap bm)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setImageBitmap(bm);</span><br><span class="line">        mBitmap = bm;</span><br><span class="line">        setup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImageDrawable</span><span class="params">(Drawable drawable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setImageDrawable(drawable);</span><br><span class="line">        mBitmap = getBitmapFromDrawable(drawable);</span><br><span class="line">        setup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImageResource</span><span class="params">(<span class="keyword">int</span> resId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setImageResource(resId);</span><br><span class="line">        mBitmap = getBitmapFromDrawable(getDrawable());</span><br><span class="line">        setup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImageURI</span><span class="params">(Uri uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setImageURI(uri);</span><br><span class="line">        mBitmap = getBitmapFromDrawable(getDrawable());</span><br><span class="line">        setup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Bitmap <span class="title">getBitmapFromDrawable</span><span class="params">(Drawable drawable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (drawable == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (drawable <span class="keyword">instanceof</span> BitmapDrawable) &#123;</span><br><span class="line">            <span class="keyword">return</span> ((BitmapDrawable) drawable).getBitmap();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Bitmap bitmap;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (drawable <span class="keyword">instanceof</span> ColorDrawable) &#123;</span><br><span class="line">                bitmap = Bitmap.createBitmap(COLORDRAWABLE_DIMENSION, COLORDRAWABLE_DIMENSION, BITMAP_CONFIG);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                bitmap = Bitmap.createBitmap(drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight(), BITMAP_CONFIG);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Canvas canvas = <span class="keyword">new</span> Canvas(bitmap);</span><br><span class="line">            drawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, canvas.getWidth(), canvas.getHeight());</span><br><span class="line">            drawable.draw(canvas);</span><br><span class="line">            <span class="keyword">return</span> bitmap;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (OutOfMemoryError e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!mReady) &#123;</span><br><span class="line">            mSetupPending = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mBitmap == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mBitmapShader = <span class="keyword">new</span> BitmapShader(mBitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class="line"></span><br><span class="line">        mBitmapPaint.setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">        mBitmapPaint.setShader(mBitmapShader);</span><br><span class="line"></span><br><span class="line">        mBorderPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        mBorderPaint.setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">        mBorderPaint.setColor(mBorderColor);</span><br><span class="line">        mBorderPaint.setStrokeWidth(mBorderWidth);</span><br><span class="line"></span><br><span class="line">        mBitmapHeight = mBitmap.getHeight();</span><br><span class="line">        mBitmapWidth = mBitmap.getWidth();</span><br><span class="line"></span><br><span class="line">        mBorderRect.set(<span class="number">0</span>, <span class="number">0</span>, getWidth(), getHeight());</span><br><span class="line">        mBorderRadius = Math.min((mBorderRect.height() - mBorderWidth) / <span class="number">2</span>, (mBorderRect.width() - mBorderWidth) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        mDrawableRect.set(mBorderWidth, mBorderWidth, mBorderRect.width() - mBorderWidth, mBorderRect.height() - mBorderWidth);</span><br><span class="line">        mDrawableRadius = Math.min(mDrawableRect.height() / <span class="number">2</span>, mDrawableRect.width() / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        updateShaderMatrix();</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateShaderMatrix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> scale;</span><br><span class="line">        <span class="keyword">float</span> dx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">float</span> dy = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        mShaderMatrix.set(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mBitmapWidth * mDrawableRect.height() &gt; mDrawableRect.width() * mBitmapHeight) &#123;</span><br><span class="line">            scale = mDrawableRect.height() / (<span class="keyword">float</span>) mBitmapHeight;</span><br><span class="line">            dx = (mDrawableRect.width() - mBitmapWidth * scale) * <span class="number">0.5f</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            scale = mDrawableRect.width() / (<span class="keyword">float</span>) mBitmapWidth;</span><br><span class="line">            dy = (mDrawableRect.height() - mBitmapHeight * scale) * <span class="number">0.5f</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mShaderMatrix.setScale(scale, scale);</span><br><span class="line">        mShaderMatrix.postTranslate((<span class="keyword">int</span>) (dx + <span class="number">0.5f</span>) + mBorderWidth, (<span class="keyword">int</span>) (dy + <span class="number">0.5f</span>) + mBorderWidth);</span><br><span class="line"></span><br><span class="line">        mBitmapShader.setLocalMatrix(mShaderMatrix);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>


<h3 id="解决ScrollView滑动粘滞"><a href="#解决ScrollView滑动粘滞" class="headerlink" title="解决ScrollView滑动粘滞"></a>解决ScrollView滑动粘滞</h3><details>
<summary>点我展开</summary>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewConfiguration;</span><br><span class="line"><span class="keyword">import</span> android.widget.ScrollView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by jiangtao on 2017/2/12 16:10</span></span><br><span class="line"><span class="comment"> * E-mail：3305727299@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlideScrollview</span> <span class="keyword">extends</span> <span class="title">ScrollView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> downX;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> downY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTouchSlop;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlideScrollview</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        mTouchSlop = ViewConfiguration.get(context).getScaledTouchSlop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlideScrollview</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        mTouchSlop = ViewConfiguration.get(context).getScaledTouchSlop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlideScrollview</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        mTouchSlop = ViewConfiguration.get(context).getScaledTouchSlop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> action = e.getAction();</span><br><span class="line">        <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                downX = (<span class="keyword">int</span>) e.getRawX();</span><br><span class="line">                downY = (<span class="keyword">int</span>) e.getRawY();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                <span class="keyword">int</span> moveY = (<span class="keyword">int</span>) e.getRawY();</span><br><span class="line">                <span class="keyword">if</span> (Math.abs(moveY - downY) &gt; mTouchSlop) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>Code</tag>
      </tags>
  </entry>
</search>
